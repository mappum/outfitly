!function(a){a(function(){a.support.transition=(function(){var b=(function(){var f=document.createElement("bootstrap"),e={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"},c;for(c in e){if(f.style[c]!==undefined){return e[c]}}}());return b&&{end:b}})()})}(window.jQuery);!function(e){var b='[data-toggle="dropdown"]',a=function(g){var f=e(g).on("click.dropdown.data-api",this.toggle);e("html").on("click.dropdown.data-api",function(){f.parent().removeClass("open")})};a.prototype={constructor:a,toggle:function(l){var k=e(this),h,f,g;if(k.is(".disabled, :disabled")){return}f=k.attr("data-target");if(!f){f=k.attr("href");f=f&&f.replace(/.*(?=#[^\s]*$)/,"")}h=e(f);h.length||(h=k.parent());g=h.hasClass("open");c();if(!g){h.toggleClass("open")}return false}};function c(){e(b).parent().removeClass("open")}e.fn.dropdown=function(f){return this.each(function(){var h=e(this),g=h.data("dropdown");if(!g){h.data("dropdown",(g=new a(this)))}if(typeof f=="string"){g[f].call(h)}})};e.fn.dropdown.Constructor=a;e(function(){e("html").on("click.dropdown.data-api",c);e("body").on("click.dropdown",".dropdown form",function(f){f.stopPropagation()}).on("click.dropdown.data-api",b,a.prototype.toggle)})}(window.jQuery);!function(b){var a=function(e,c){this.init("tooltip",e,c)};a.prototype={constructor:a,init:function(g,f,e){var h,c;this.type=g;this.$element=b(f);this.options=this.getOptions(e);this.enabled=true;if(this.options.trigger!="manual"){h=this.options.trigger=="hover"?"mouseenter":"focus";c=this.options.trigger=="hover"?"mouseleave":"blur";this.$element.on(h,this.options.selector,b.proxy(this.enter,this));this.$element.on(c,this.options.selector,b.proxy(this.leave,this))}this.options.selector?(this._options=b.extend({},this.options,{trigger:"manual",selector:""})):this.fixTitle()},getOptions:function(c){c=b.extend({},b.fn[this.type].defaults,c,this.$element.data());if(c.delay&&typeof c.delay=="number"){c.delay={show:c.delay,hide:c.delay}}return c},enter:function(f){var c=b(f.currentTarget)[this.type](this._options).data(this.type);if(!c.options.delay||!c.options.delay.show){return c.show()}clearTimeout(this.timeout);c.hoverState="in";this.timeout=setTimeout(function(){if(c.hoverState=="in"){c.show()}},c.options.delay.show)},leave:function(f){var c=b(f.currentTarget)[this.type](this._options).data(this.type);if(!c.options.delay||!c.options.delay.hide){return c.hide()}clearTimeout(this.timeout);c.hoverState="out";this.timeout=setTimeout(function(){if(c.hoverState=="out"){c.hide()}},c.options.delay.hide)},show:function(){var h,c,l,f,k,e,g;if(this.hasContent()&&this.enabled){h=this.tip();this.setContent();if(this.options.animation){h.addClass("fade")}e=typeof this.options.placement=="function"?this.options.placement.call(this,h[0],this.$element[0]):this.options.placement;c=/in/.test(e);h.remove().css({top:0,left:0,display:"block"}).appendTo(c?this.$element:document.body);l=this.getPosition(c);f=h[0].offsetWidth;k=h[0].offsetHeight;switch(c?e.split(" ")[1]:e){case"bottom":g={top:l.top+l.height,left:l.left+l.width/2-f/2};break;case"top":g={top:l.top-k,left:l.left+l.width/2-f/2};break;case"left":g={top:l.top+l.height/2-k/2,left:l.left-f};break;case"right":g={top:l.top+l.height/2-k/2,left:l.left+l.width};break}h.css(g).addClass(e).addClass("in")}},isHTML:function(c){return typeof c!="string"||(c.charAt(0)==="<"&&c.charAt(c.length-1)===">"&&c.length>=3)||/^(?:[^<]*<[\w\W]+>[^>]*$)/.exec(c)},setContent:function(){var e=this.tip(),c=this.getTitle();e.find(".tooltip-inner")[this.isHTML(c)?"html":"text"](c);e.removeClass("fade in top bottom left right")},hide:function(){var c=this,e=this.tip();e.removeClass("in");function f(){var g=setTimeout(function(){e.off(b.support.transition.end).remove()},500);e.one(b.support.transition.end,function(){clearTimeout(g);e.remove()})}b.support.transition&&this.$tip.hasClass("fade")?f():e.remove()},fixTitle:function(){var c=this.$element;if(c.attr("title")||typeof(c.attr("data-original-title"))!="string"){c.attr("data-original-title",c.attr("title")||"").removeAttr("title")}},hasContent:function(){return this.getTitle()},getPosition:function(c){return b.extend({},(c?{top:0,left:0}:this.$element.offset()),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight})},getTitle:function(){var f,c=this.$element,e=this.options;f=c.attr("data-original-title")||(typeof e.title=="function"?e.title.call(c[0]):e.title);return f},tip:function(){return this.$tip=this.$tip||b(this.options.template)},validate:function(){if(!this.$element[0].parentNode){this.hide();this.$element=null;this.options=null}},enable:function(){this.enabled=true},disable:function(){this.enabled=false},toggleEnabled:function(){this.enabled=!this.enabled},toggle:function(){this[this.tip().hasClass("in")?"hide":"show"]()}};b.fn.tooltip=function(c){return this.each(function(){var g=b(this),f=g.data("tooltip"),e=typeof c=="object"&&c;if(!f){g.data("tooltip",(f=new a(this,e)))}if(typeof c=="string"){f[c]()}})};b.fn.tooltip.Constructor=a;b.fn.tooltip.defaults={animation:true,placement:"top",selector:false,template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover",title:"",delay:0}}(window.jQuery);!function(c){var b='[data-dismiss="alert"]',a=function(e){c(e).on("click",b,this.close)};a.prototype.close=function(l){var k=c(this),g=k.attr("data-target"),h;if(!g){g=k.attr("href");g=g&&g.replace(/.*(?=#[^\s]*$)/,"")}h=c(g);l&&l.preventDefault();h.length||(h=k.hasClass("alert")?k:k.parent());h.trigger(l=c.Event("close"));if(l.isDefaultPrevented()){return}h.removeClass("in");function f(){h.trigger("closed").remove()}c.support.transition&&h.hasClass("fade")?h.on(c.support.transition.end,f):f()};c.fn.alert=function(e){return this.each(function(){var g=c(this),f=g.data("alert");if(!f){g.data("alert",(f=new a(this)))}if(typeof e=="string"){f[e].call(g)}})};c.fn.alert.Constructor=a;c(function(){c("body").on("click.alert.data-api",b,a.prototype.close)})}(window.jQuery);!function(b){var a=function(e,c){this.$element=b(e);this.options=b.extend({},b.fn.button.defaults,c)};a.prototype.setState=function(f){var h="disabled",c=this.$element,e=c.data(),g=c.is("input")?"val":"html";f=f+"Text";e.resetText||c.data("resetText",c[g]());c[g](e[f]||this.options[f]);setTimeout(function(){f=="loadingText"?c.addClass(h).attr(h,h):c.removeClass(h).removeAttr(h)},0)};a.prototype.toggle=function(){var c=this.$element.parent('[data-toggle="buttons-radio"]');c&&c.find(".active").removeClass("active");this.$element.toggleClass("active")};b.fn.button=function(c){return this.each(function(){var g=b(this),f=g.data("button"),e=typeof c=="object"&&c;if(!f){g.data("button",(f=new a(this,e)))}if(c=="toggle"){f.toggle()}else{if(c){f.setState(c)}}})};b.fn.button.defaults={loadingText:"loading..."};b.fn.button.Constructor=a;b(function(){b("body").on("click.button.data-api","[data-toggle^=button]",function(f){var c=b(f.target);if(!c.hasClass("btn")){c=c.closest(".btn")}c.button("toggle")})})}(window.jQuery);!function(a){var b=function(e,c){this.$element=a(e);this.options=a.extend({},a.fn.collapse.defaults,c);if(this.options.parent){this.$parent=a(this.options.parent)}this.options.toggle&&this.toggle()};b.prototype={constructor:b,dimension:function(){var c=this.$element.hasClass("width");return c?"width":"height"},show:function(){var g,c,f,e;if(this.transitioning){return}g=this.dimension();c=a.camelCase(["scroll",g].join("-"));f=this.$parent&&this.$parent.find("> .accordion-group > .in");if(f&&f.length){e=f.data("collapse");if(e&&e.transitioning){return}f.collapse("hide");e||f.data("collapse",null)}this.$element[g](0);this.transition("addClass",a.Event("show"),"shown");this.$element[g](this.$element[0][c])},hide:function(){var c;if(this.transitioning){return}c=this.dimension();this.reset(this.$element[c]());this.transition("removeClass",a.Event("hide"),"hidden");this.$element[c](0)},reset:function(c){var e=this.dimension();this.$element.removeClass("collapse")[e](c||"auto")[0].offsetWidth;this.$element[c!==null?"addClass":"removeClass"]("collapse");return this},transition:function(h,e,f){var g=this,c=function(){if(e.type=="show"){g.reset()}g.transitioning=0;g.$element.trigger(f)};this.$element.trigger(e);if(e.isDefaultPrevented()){return}this.transitioning=1;this.$element[h]("in");a.support.transition&&this.$element.hasClass("collapse")?this.$element.one(a.support.transition.end,c):c()},toggle:function(){this[this.$element.hasClass("in")?"hide":"show"]()}};a.fn.collapse=function(c){return this.each(function(){var g=a(this),f=g.data("collapse"),e=typeof c=="object"&&c;if(!f){g.data("collapse",(f=new b(this,e)))}if(typeof c=="string"){f[c]()}})};a.fn.collapse.defaults={toggle:true};a.fn.collapse.Constructor=b;a(function(){a("body").on("click.collapse.data-api","[data-toggle=collapse]",function(k){var h=a(this),c,g=h.attr("data-target")||k.preventDefault()||(c=h.attr("href"))&&c.replace(/.*(?=#[^\s]+$)/,""),f=a(g).data("collapse")?"toggle":h.data();a(g).collapse(f)})})}(window.jQuery);!function(b){var a=function(e,c){this.init("tooltip",e,c)};a.prototype={constructor:a,init:function(g,f,e){var h,c;this.type=g;this.$element=b(f);this.options=this.getOptions(e);this.enabled=true;if(this.options.trigger!="manual"){h=this.options.trigger=="hover"?"mouseenter":"focus";c=this.options.trigger=="hover"?"mouseleave":"blur";this.$element.on(h,this.options.selector,b.proxy(this.enter,this));this.$element.on(c,this.options.selector,b.proxy(this.leave,this))}this.options.selector?(this._options=b.extend({},this.options,{trigger:"manual",selector:""})):this.fixTitle()},getOptions:function(c){c=b.extend({},b.fn[this.type].defaults,c,this.$element.data());if(c.delay&&typeof c.delay=="number"){c.delay={show:c.delay,hide:c.delay}}return c},enter:function(f){var c=b(f.currentTarget)[this.type](this._options).data(this.type);if(!c.options.delay||!c.options.delay.show){return c.show()}clearTimeout(this.timeout);c.hoverState="in";this.timeout=setTimeout(function(){if(c.hoverState=="in"){c.show()}},c.options.delay.show)},leave:function(f){var c=b(f.currentTarget)[this.type](this._options).data(this.type);if(this.timeout){clearTimeout(this.timeout)}if(!c.options.delay||!c.options.delay.hide){return c.hide()}c.hoverState="out";this.timeout=setTimeout(function(){if(c.hoverState=="out"){c.hide()}},c.options.delay.hide)},show:function(){var h,c,l,f,k,e,g;if(this.hasContent()&&this.enabled){h=this.tip();this.setContent();if(this.options.animation){h.addClass("fade")}e=typeof this.options.placement=="function"?this.options.placement.call(this,h[0],this.$element[0]):this.options.placement;c=/in/.test(e);h.remove().css({top:0,left:0,display:"block"}).appendTo(c?this.$element:document.body);l=this.getPosition(c);f=h[0].offsetWidth;k=h[0].offsetHeight;switch(c?e.split(" ")[1]:e){case"bottom":g={top:l.top+l.height,left:l.left+l.width/2-f/2};break;case"top":g={top:l.top-k,left:l.left+l.width/2-f/2};break;case"left":g={top:l.top+l.height/2-k/2,left:l.left-f};break;case"right":g={top:l.top+l.height/2-k/2,left:l.left+l.width};break}h.css(g).addClass(e).addClass("in")}},isHTML:function(c){return typeof c!="string"||(c.charAt(0)==="<"&&c.charAt(c.length-1)===">"&&c.length>=3)||/^(?:[^<]*<[\w\W]+>[^>]*$)/.exec(c)},setContent:function(){var e=this.tip(),c=this.getTitle();e.find(".tooltip-inner")[this.isHTML(c)?"html":"text"](c);e.removeClass("fade in top bottom left right")},hide:function(){var c=this,e=this.tip();e.removeClass("in");function f(){var g=setTimeout(function(){e.off(b.support.transition.end).remove()},500);e.one(b.support.transition.end,function(){clearTimeout(g);e.remove()})}b.support.transition&&this.$tip.hasClass("fade")?f():e.remove()},fixTitle:function(){var c=this.$element;if(c.attr("title")||typeof(c.attr("data-original-title"))!="string"){c.attr("data-original-title",c.attr("title")||"").removeAttr("title")}},hasContent:function(){return this.getTitle()},getPosition:function(c){return b.extend({},(c?{top:0,left:0}:this.$element.offset()),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight})},getTitle:function(){var f,c=this.$element,e=this.options;f=c.attr("data-original-title")||(typeof e.title=="function"?e.title.call(c[0]):e.title);return f},tip:function(){return this.$tip=this.$tip||b(this.options.template)},validate:function(){if(!this.$element[0].parentNode){this.hide();this.$element=null;this.options=null}},enable:function(){this.enabled=true},disable:function(){this.enabled=false},toggleEnabled:function(){this.enabled=!this.enabled},toggle:function(){this[this.tip().hasClass("in")?"hide":"show"]()}};b.fn.tooltip=function(c){return this.each(function(){var g=b(this),f=g.data("tooltip"),e=typeof c=="object"&&c;if(!f){g.data("tooltip",(f=new a(this,e)))}if(typeof c=="string"){f[c]()}})};b.fn.tooltip.Constructor=a;b.fn.tooltip.defaults={animation:true,placement:"top",selector:false,template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover",title:"",delay:0}}(window.jQuery);(function(){var y=this;var m=y._;var G={};var F=Array.prototype,g=Object.prototype,t=Function.prototype;var q=F.slice,C=F.unshift,c=g.toString,k=g.hasOwnProperty;var O=F.forEach,s=F.map,H=F.reduce,b=F.reduceRight,a=F.filter,D=F.every,r=F.some,o=F.indexOf,n=F.lastIndexOf,v=Array.isArray,f=Object.keys,I=t.bind;var P=function(p){return new w(p)};if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=P}exports._=P}else{y._=P}P.VERSION="1.3.3";var L=P.each=P.forEach=function(U,T,S){if(U==null){return}if(O&&U.forEach===O){U.forEach(T,S)}else{if(U.length===+U.length){for(var R=0,p=U.length;R<p;R++){if(R in U&&T.call(S,U[R],R,U)===G){return}}}else{for(var Q in U){if(P.has(U,Q)){if(T.call(S,U[Q],Q,U)===G){return}}}}}};P.map=P.collect=function(S,R,Q){var p=[];if(S==null){return p}if(s&&S.map===s){return S.map(R,Q)}L(S,function(V,T,U){p[p.length]=R.call(Q,V,T,U)});if(S.length===+S.length){p.length=S.length}return p};P.reduce=P.foldl=P.inject=function(T,S,p,R){var Q=arguments.length>2;if(T==null){T=[]}if(H&&T.reduce===H){if(R){S=P.bind(S,R)}return Q?T.reduce(S,p):T.reduce(S)}L(T,function(W,U,V){if(!Q){p=W;Q=true}else{p=S.call(R,p,W,U,V)}});if(!Q){throw new TypeError("Reduce of empty array with no initial value")}return p};P.reduceRight=P.foldr=function(T,S,p,R){var Q=arguments.length>2;if(T==null){T=[]}if(b&&T.reduceRight===b){if(R){S=P.bind(S,R)}return Q?T.reduceRight(S,p):T.reduceRight(S)}var U=P.toArray(T).reverse();if(R&&!Q){S=P.bind(S,R)}return Q?P.reduce(U,S,p,R):P.reduce(U,S)};P.find=P.detect=function(S,R,Q){var p;B(S,function(V,T,U){if(R.call(Q,V,T,U)){p=V;return true}});return p};P.filter=P.select=function(S,R,Q){var p=[];if(S==null){return p}if(a&&S.filter===a){return S.filter(R,Q)}L(S,function(V,T,U){if(R.call(Q,V,T,U)){p[p.length]=V}});return p};P.reject=function(S,R,Q){var p=[];if(S==null){return p}L(S,function(V,T,U){if(!R.call(Q,V,T,U)){p[p.length]=V}});return p};P.every=P.all=function(S,R,Q){var p=true;if(S==null){return p}if(D&&S.every===D){return S.every(R,Q)}L(S,function(V,T,U){if(!(p=p&&R.call(Q,V,T,U))){return G}});return !!p};var B=P.some=P.any=function(S,R,Q){R||(R=P.identity);var p=false;if(S==null){return p}if(r&&S.some===r){return S.some(R,Q)}L(S,function(V,T,U){if(p||(p=R.call(Q,V,T,U))){return G}});return !!p};P.include=P.contains=function(R,Q){var p=false;if(R==null){return p}if(o&&R.indexOf===o){return R.indexOf(Q)!=-1}p=B(R,function(S){return S===Q});return p};P.invoke=function(Q,R){var p=q.call(arguments,2);return P.map(Q,function(S){return(P.isFunction(R)?R||S:S[R]).apply(S,p)})};P.pluck=function(Q,p){return P.map(Q,function(R){return R[p]})};P.max=function(S,R,Q){if(!R&&P.isArray(S)&&S[0]===+S[0]){return Math.max.apply(Math,S)}if(!R&&P.isEmpty(S)){return -Infinity}var p={computed:-Infinity};L(S,function(W,T,V){var U=R?R.call(Q,W,T,V):W;U>=p.computed&&(p={value:W,computed:U})});return p.value};P.min=function(S,R,Q){if(!R&&P.isArray(S)&&S[0]===+S[0]){return Math.min.apply(Math,S)}if(!R&&P.isEmpty(S)){return Infinity}var p={computed:Infinity};L(S,function(W,T,V){var U=R?R.call(Q,W,T,V):W;U<p.computed&&(p={value:W,computed:U})});return p.value};P.shuffle=function(R){var p=[],Q;L(R,function(U,S,T){Q=Math.floor(Math.random()*(S+1));p[S]=p[Q];p[Q]=U});return p};P.sortBy=function(R,S,p){var Q=P.isFunction(S)?S:function(T){return T[S]};return P.pluck(P.map(R,function(V,T,U){return{value:V,criteria:Q.call(p,V,T,U)}}).sort(function(W,V){var U=W.criteria,T=V.criteria;if(U===void 0){return 1}if(T===void 0){return -1}return U<T?-1:U>T?1:0}),"value")};P.groupBy=function(R,S){var p={};var Q=P.isFunction(S)?S:function(T){return T[S]};L(R,function(V,T){var U=Q(V,T);(p[U]||(p[U]=[])).push(V)});return p};P.sortedIndex=function(U,T,R){R||(R=P.identity);var p=0,S=U.length;while(p<S){var Q=(p+S)>>1;R(U[Q])<R(T)?p=Q+1:S=Q}return p};P.toArray=function(p){if(!p){return[]}if(P.isArray(p)){return q.call(p)}if(P.isArguments(p)){return q.call(p)}if(p.toArray&&P.isFunction(p.toArray)){return p.toArray()}return P.values(p)};P.size=function(p){return P.isArray(p)?p.length:P.keys(p).length};P.first=P.head=P.take=function(R,Q,p){return(Q!=null)&&!p?q.call(R,0,Q):R[0]};P.initial=function(R,Q,p){return q.call(R,0,R.length-((Q==null)||p?1:Q))};P.last=function(R,Q,p){if((Q!=null)&&!p){return q.call(R,Math.max(R.length-Q,0))}else{return R[R.length-1]}};P.rest=P.tail=function(R,p,Q){return q.call(R,(p==null)||Q?1:p)};P.compact=function(p){return P.filter(p,function(Q){return !!Q})};P.flatten=function(Q,p){return P.reduce(Q,function(R,S){if(P.isArray(S)){return R.concat(p?S:P.flatten(S))}R[R.length]=S;return R},[])};P.without=function(p){return P.difference(p,q.call(arguments,1))};P.uniq=P.unique=function(T,S,R){var p=R?P.map(T,R):T;var Q=[];if(T.length<3){S=true}P.reduce(p,function(U,W,V){if(S?P.last(U)!==W||!U.length:!P.include(U,W)){U.push(W);Q.push(T[V])}return U},[]);return Q};P.union=function(){return P.uniq(P.flatten(arguments,true))};P.intersection=P.intersect=function(Q){var p=q.call(arguments,1);return P.filter(P.uniq(Q),function(R){return P.every(p,function(S){return P.indexOf(S,R)>=0})})};P.difference=function(Q){var p=P.flatten(q.call(arguments,1),true);return P.filter(Q,function(R){return !P.include(p,R)})};P.zip=function(){var p=q.call(arguments);var S=P.max(P.pluck(p,"length"));var R=new Array(S);for(var Q=0;Q<S;Q++){R[Q]=P.pluck(p,""+Q)}return R};P.indexOf=function(T,R,S){if(T==null){return -1}var Q,p;if(S){Q=P.sortedIndex(T,R);return T[Q]===R?Q:-1}if(o&&T.indexOf===o){return T.indexOf(R)}for(Q=0,p=T.length;Q<p;Q++){if(Q in T&&T[Q]===R){return Q}}return -1};P.lastIndexOf=function(R,Q){if(R==null){return -1}if(n&&R.lastIndexOf===n){return R.lastIndexOf(Q)}var p=R.length;while(p--){if(p in R&&R[p]===Q){return p}}return -1};P.range=function(U,S,T){if(arguments.length<=1){S=U||0;U=0}T=arguments[2]||1;var Q=Math.max(Math.ceil((S-U)/T),0);var p=0;var R=new Array(Q);while(p<Q){R[p++]=U;U+=T}return R};var J=function(){};P.bind=function e(S,Q){var R,p;if(S.bind===I&&I){return I.apply(S,q.call(arguments,1))}if(!P.isFunction(S)){throw new TypeError}p=q.call(arguments,2);return R=function(){if(!(this instanceof R)){return S.apply(Q,p.concat(q.call(arguments)))}J.prototype=S.prototype;var U=new J;var T=S.apply(U,p.concat(q.call(arguments)));if(Object(T)===T){return T}return U}};P.bindAll=function(Q){var p=q.call(arguments,1);if(p.length==0){p=P.functions(Q)}L(p,function(R){Q[R]=P.bind(Q[R],Q)});return Q};P.memoize=function(R,Q){var p={};Q||(Q=P.identity);return function(){var S=Q.apply(this,arguments);return P.has(p,S)?p[S]:(p[S]=R.apply(this,arguments))}};P.delay=function(Q,R){var p=q.call(arguments,2);return setTimeout(function(){return Q.apply(null,p)},R)};P.defer=function(p){return P.delay.apply(P,[p,1].concat(q.call(arguments,1)))};P.throttle=function(R,S){var Q,U,V,W,T,X;var p=P.debounce(function(){T=W=false},S);return function(){Q=this;U=arguments;var Y=function(){V=null;if(T){R.apply(Q,U)}p()};if(!V){V=setTimeout(Y,S)}if(W){T=true}else{X=R.apply(Q,U)}p();W=true;return X}};P.debounce=function(Q,S,p){var R;return function(){var V=this,U=arguments;var T=function(){R=null;if(!p){Q.apply(V,U)}};if(p&&!R){Q.apply(V,U)}clearTimeout(R);R=setTimeout(T,S)}};P.once=function(R){var p=false,Q;return function(){if(p){return Q}p=true;return Q=R.apply(this,arguments)}};P.wrap=function(p,Q){return function(){var R=[p].concat(q.call(arguments,0));return Q.apply(this,R)}};P.compose=function(){var p=arguments;return function(){var Q=arguments;for(var R=p.length-1;R>=0;R--){Q=[p[R].apply(this,Q)]}return Q[0]}};P.after=function(Q,p){if(Q<=0){return p()}return function(){if(--Q<1){return p.apply(this,arguments)}}};P.keys=f||function(R){if(R!==Object(R)){throw new TypeError("Invalid object")}var Q=[];for(var p in R){if(P.has(R,p)){Q[Q.length]=p}}return Q};P.values=function(p){return P.map(p,P.identity)};P.functions=P.methods=function(R){var Q=[];for(var p in R){if(P.isFunction(R[p])){Q.push(p)}}return Q.sort()};P.extend=function(p){L(q.call(arguments,1),function(Q){for(var R in Q){p[R]=Q[R]}});return p};P.pick=function(Q){var p={};L(P.flatten(q.call(arguments,1)),function(R){if(R in Q){p[R]=Q[R]}});return p};P.defaults=function(p){L(q.call(arguments,1),function(Q){for(var R in Q){if(p[R]==null){p[R]=Q[R]}}});return p};P.clone=function(p){if(!P.isObject(p)){return p}return P.isArray(p)?p.slice():P.extend({},p)};P.tap=function(Q,p){p(Q);return Q};function M(S,R,Q){if(S===R){return S!==0||1/S==1/R}if(S==null||R==null){return S===R}if(S._chain){S=S._wrapped}if(R._chain){R=R._wrapped}if(S.isEqual&&P.isFunction(S.isEqual)){return S.isEqual(R)}if(R.isEqual&&P.isFunction(R.isEqual)){return R.isEqual(S)}var V=c.call(S);if(V!=c.call(R)){return false}switch(V){case"[object String]":return S==String(R);case"[object Number]":return S!=+S?R!=+R:(S==0?1/S==1/R:S==+R);case"[object Date]":case"[object Boolean]":return +S==+R;case"[object RegExp]":return S.source==R.source&&S.global==R.global&&S.multiline==R.multiline&&S.ignoreCase==R.ignoreCase}if(typeof S!="object"||typeof R!="object"){return false}var W=Q.length;while(W--){if(Q[W]==S){return true}}Q.push(S);var U=0,p=true;if(V=="[object Array]"){U=S.length;p=U==R.length;if(p){while(U--){if(!(p=U in S==U in R&&M(S[U],R[U],Q))){break}}}}else{if("constructor" in S!="constructor" in R||S.constructor!=R.constructor){return false}for(var T in S){if(P.has(S,T)){U++;if(!(p=P.has(R,T)&&M(S[T],R[T],Q))){break}}}if(p){for(T in R){if(P.has(R,T)&&!(U--)){break}}p=!U}}Q.pop();return p}P.isEqual=function(Q,p){return M(Q,p,[])};P.isEmpty=function(Q){if(Q==null){return true}if(P.isArray(Q)||P.isString(Q)){return Q.length===0}for(var p in Q){if(P.has(Q,p)){return false}}return true};P.isElement=function(p){return !!(p&&p.nodeType==1)};P.isArray=v||function(p){return c.call(p)=="[object Array]"};P.isObject=function(p){return p===Object(p)};P.isArguments=function(p){return c.call(p)=="[object Arguments]"};if(!P.isArguments(arguments)){P.isArguments=function(p){return !!(p&&P.has(p,"callee"))}}P.isFunction=function(p){return c.call(p)=="[object Function]"};P.isString=function(p){return c.call(p)=="[object String]"};P.isNumber=function(p){return c.call(p)=="[object Number]"};P.isFinite=function(p){return P.isNumber(p)&&isFinite(p)};P.isNaN=function(p){return p!==p};P.isBoolean=function(p){return p===true||p===false||c.call(p)=="[object Boolean]"};P.isDate=function(p){return c.call(p)=="[object Date]"};P.isRegExp=function(p){return c.call(p)=="[object RegExp]"};P.isNull=function(p){return p===null};P.isUndefined=function(p){return p===void 0};P.has=function(Q,p){return k.call(Q,p)};P.noConflict=function(){y._=m;return this};P.identity=function(p){return p};P.times=function(S,R,Q){for(var p=0;p<S;p++){R.call(Q,p)}};P.escape=function(p){return(""+p).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")};P.result=function(p,R){if(p==null){return null}var Q=p[R];return P.isFunction(Q)?Q.call(p):Q};P.mixin=function(p){L(P.functions(p),function(Q){z(Q,P[Q]=p[Q])})};var A=0;P.uniqueId=function(p){var Q=A++;return p?p+Q:Q};P.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var x=/.^/;var h={"\\":"\\","'":"'",r:"\r",n:"\n",t:"\t",u2028:"\u2028",u2029:"\u2029"};for(var K in h){h[h[K]]=K}var l=/\\|'|\r|\n|\t|\u2028|\u2029/g;var E=/\\(\\|'|r|n|t|u2028|u2029)/g;var N=function(p){return p.replace(E,function(Q,R){return h[R]})};P.template=function(U,T,R){R=P.defaults(R||{},P.templateSettings);var S="__p+='"+U.replace(l,function(V){return"\\"+h[V]}).replace(R.escape||x,function(V,W){return"'+\n_.escape("+N(W)+")+\n'"}).replace(R.interpolate||x,function(V,W){return"'+\n("+N(W)+")+\n'"}).replace(R.evaluate||x,function(V,W){return"';\n"+N(W)+"\n;__p+='"})+"';\n";if(!R.variable){S="with(obj||{}){\n"+S+"}\n"}S="var __p='';var print=function(){__p+=Array.prototype.join.call(arguments, '')};\n"+S+"return __p;\n";var Q=new Function(R.variable||"obj","_",S);if(T){return Q(T,P)}var p=function(V){return Q.call(this,V,P)};p.source="function("+(R.variable||"obj")+"){\n"+S+"}";return p};P.chain=function(p){return P(p).chain()};var w=function(p){this._wrapped=p};P.prototype=w.prototype;var u=function(Q,p){return p?P(Q).chain():Q};var z=function(p,Q){w.prototype[p]=function(){var R=q.call(arguments);C.call(R,this._wrapped);return u(Q.apply(P,R),this._chain)}};P.mixin(P);L(["pop","push","reverse","shift","sort","splice","unshift"],function(p){var Q=F[p];w.prototype[p]=function(){var R=this._wrapped;Q.apply(R,arguments);var S=R.length;if((p=="shift"||p=="splice")&&S===0){delete R[0]}return u(R,this._chain)}});L(["concat","join","slice"],function(p){var Q=F[p];w.prototype[p]=function(){return u(Q.apply(this._wrapped,arguments),this._chain)}});w.prototype.chain=function(){this._chain=true;return this};w.prototype.value=function(){return this._wrapped}}).call(this);(function(){var t=this;var r=t.Backbone;var s=Array.prototype.slice;var B=Array.prototype.splice;var c;if(typeof exports!=="undefined"){c=exports}else{c=t.Backbone={}}c.VERSION="0.9.2";var D=t._;if(!D&&(typeof require!=="undefined")){D=require("underscore")}var h=t.jQuery||t.Zepto||t.ender;c.setDomLibrary=function(F){h=F};c.noConflict=function(){t.Backbone=r;return this};c.emulateHTTP=false;c.emulateJSON=false;var a=/\s+/;var q=c.Events={on:function(I,M,H){var G,K,J,F,L;if(!M){return this}I=I.split(a);G=this._callbacks||(this._callbacks={});while(K=I.shift()){L=G[K];J=L?L.tail:{};J.next=F={};J.context=H;J.callback=M;G[K]={tail:F,next:L?L.next:J}}return this},off:function(M,K,G){var F,N,H,J,I,L;if(!(N=this._callbacks)){return}if(!(M||K||G)){delete this._callbacks;return this}M=M?M.split(a):D.keys(N);while(F=M.shift()){H=N[F];delete N[F];if(!H||!(K||G)){continue}J=H.tail;while((H=H.next)!==J){I=H.callback;L=H.context;if((K&&I!==K)||(G&&L!==G)){this.on(F,I,L)}}}return this},trigger:function(I){var M,L,H,G,F,K,J;if(!(H=this._callbacks)){return this}K=H.all;I=I.split(a);J=s.call(arguments,1);while(M=I.shift()){if(L=H[M]){G=L.tail;while((L=L.next)!==G){L.callback.apply(L.context||this,J)}}if(L=K){G=L.tail;F=[M].concat(J);while((L=L.next)!==G){L.callback.apply(L.context||this,F)}}}return this}};q.bind=q.on;q.unbind=q.off;var n=c.Model=function(F,G){var H;F||(F={});if(G&&G.parse){F=this.parse(F)}if(H=e(this,"defaults")){F=D.extend({},H,F)}if(G&&G.collection){this.collection=G.collection}this.attributes={};this._escapedAttributes={};this.cid=D.uniqueId("c");this.changed={};this._silent={};this._pending={};this.set(F,{silent:true});this.changed={};this._silent={};this._pending={};this._previousAttributes=D.clone(this.attributes);this.initialize.apply(this,arguments)};D.extend(n.prototype,q,{changed:null,_silent:null,_pending:null,idAttribute:"id",initialize:function(){},toJSON:function(F){return D.clone(this.attributes)},get:function(F){return this.attributes[F]},escape:function(F){var G;if(G=this._escapedAttributes[F]){return G}var H=this.get(F);return this._escapedAttributes[F]=D.escape(H==null?"":""+H)},has:function(F){return this.get(F)!=null},set:function(M,L,O){var N,J,H;if(D.isObject(M)||M==null){N=M;O=L}else{N={};N[M]=L}O||(O={});if(!N){return this}if(N instanceof n){N=N.attributes}if(O.unset){for(J in N){N[J]=void 0}}if(!this._validate(N,O)){return false}if(this.idAttribute in N){this.id=N[this.idAttribute]}var K=O.changes={};var G=this.attributes;var F=this._escapedAttributes;var I=this._previousAttributes||{};for(J in N){H=N[J];if(!D.isEqual(G[J],H)||(O.unset&&D.has(G,J))){delete F[J];(O.silent?this._silent:K)[J]=true}O.unset?delete G[J]:G[J]=H;if(!D.isEqual(I[J],H)||(D.has(G,J)!=D.has(I,J))){this.changed[J]=H;if(!O.silent){this._pending[J]=true}}else{delete this.changed[J];delete this._pending[J]}}if(!O.silent){this.change(O)}return this},unset:function(F,G){(G||(G={})).unset=true;return this.set(F,null,G)},clear:function(F){(F||(F={})).unset=true;return this.set(D.clone(this.attributes),F)},fetch:function(G){G=G?D.clone(G):{};var F=this;var H=G.success;G.success=function(K,I,J){if(!F.set(F.parse(K,J),G)){return false}if(H){H(F,K)}};G.error=c.wrapError(G.error,F,G);return(this.sync||c.sync).call(this,"read",this,G)},save:function(K,J,O){var L,I;if(D.isObject(K)||K==null){L=K;O=J}else{L={};L[K]=J}O=O?D.clone(O):{};if(O.wait){if(!this._validate(L,O)){return false}I=D.clone(this.attributes)}var G=D.extend({},O,{silent:true});if(L&&!this.set(L,O.wait?G:O)){return false}var H=this;var M=O.success;O.success=function(S,P,R){var Q=H.parse(S,R);if(O.wait){delete O.wait;Q=D.extend(L||{},Q)}if(!H.set(Q,O)){return false}if(M){M(H,S)}else{H.trigger("sync",H,S,O)}};O.error=c.wrapError(O.error,H,O);var F=this.isNew()?"create":"update";var N=(this.sync||c.sync).call(this,F,this,O);if(O.wait){this.set(I,G)}return N},destroy:function(G){G=G?D.clone(G):{};var F=this;var J=G.success;var I=function(){F.trigger("destroy",F,F.collection,G)};if(this.isNew()){I();return false}G.success=function(K){if(G.wait){I()}if(J){J(F,K)}else{F.trigger("sync",F,K,G)}};G.error=c.wrapError(G.error,F,G);var H=(this.sync||c.sync).call(this,"delete",this,G);if(!G.wait){I()}return H},url:function(){var F=e(this,"urlRoot")||e(this.collection,"url")||w();if(this.isNew()){return F}return F+(F.charAt(F.length-1)=="/"?"":"/")+encodeURIComponent(this.id)},parse:function(G,F){return G},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},change:function(G){G||(G={});var I=this._changing;this._changing=true;for(var F in this._silent){this._pending[F]=true}var H=D.extend({},G.changes,this._silent);this._silent={};for(var F in H){this.trigger("change:"+F,this,this.get(F),G)}if(I){return this}while(!D.isEmpty(this._pending)){this._pending={};this.trigger("change",this,G);for(var F in this.changed){if(this._pending[F]||this._silent[F]){continue}delete this.changed[F]}this._previousAttributes=D.clone(this.attributes)}this._changing=false;return this},hasChanged:function(F){if(!arguments.length){return !D.isEmpty(this.changed)}return D.has(this.changed,F)},changedAttributes:function(H){if(!H){return this.hasChanged()?D.clone(this.changed):false}var J,I=false,G=this._previousAttributes;for(var F in H){if(D.isEqual(G[F],(J=H[F]))){continue}(I||(I={}))[F]=J}return I},previous:function(F){if(!arguments.length||!this._previousAttributes){return null}return this._previousAttributes[F]},previousAttributes:function(){return D.clone(this._previousAttributes)},isValid:function(){return !this.validate(this.attributes)},_validate:function(H,G){if(G.silent||!this.validate){return true}H=D.extend({},this.attributes,H);var F=this.validate(H,G);if(!F){return true}if(G&&G.error){G.error(this,F,G)}else{this.trigger("error",this,F,G)}return false}});var E=c.Collection=function(G,F){F||(F={});if(F.model){this.model=F.model}if(F.comparator){this.comparator=F.comparator}this._reset();this.initialize.apply(this,arguments);if(G){this.reset(G,{silent:true,parse:F.parse})}};D.extend(E.prototype,q,{model:n,initialize:function(){},toJSON:function(F){return this.map(function(G){return G.toJSON(F)})},add:function(G,P){var L,N,I,M,O,H,J={},F={},K=[];P||(P={});G=D.isArray(G)?G.slice():[G];for(L=0,I=G.length;L<I;L++){if(!(M=G[L]=this._prepareModel(G[L],P))){throw new Error("Can't add an invalid model to a collection")}O=M.cid;H=M.id;if(J[O]||this._byCid[O]||((H!=null)&&(F[H]||this._byId[H]))){K.push(L);continue}J[O]=F[H]=M}L=K.length;while(L--){G.splice(K[L],1)}for(L=0,I=G.length;L<I;L++){(M=G[L]).on("all",this._onModelEvent,this);this._byCid[M.cid]=M;if(M.id!=null){this._byId[M.id]=M}}this.length+=I;N=P.at!=null?P.at:this.models.length;B.apply(this.models,[N,0].concat(G));if(this.comparator){this.sort({silent:true})}if(P.silent){return this}for(L=0,I=this.models.length;L<I;L++){if(!J[(M=this.models[L]).cid]){continue}P.index=L;M.trigger("add",M,this,P)}return this},remove:function(K,I){var J,F,H,G;I||(I={});K=D.isArray(K)?K.slice():[K];for(J=0,F=K.length;J<F;J++){G=this.getByCid(K[J])||this.get(K[J]);if(!G){continue}delete this._byId[G.id];delete this._byCid[G.cid];H=this.indexOf(G);this.models.splice(H,1);this.length--;if(!I.silent){I.index=H;G.trigger("remove",G,this,I)}this._removeReference(G)}return this},push:function(G,F){G=this._prepareModel(G,F);this.add(G,F);return G},pop:function(G){var F=this.at(this.length-1);this.remove(F,G);return F},unshift:function(G,F){G=this._prepareModel(G,F);this.add(G,D.extend({at:0},F));return G},shift:function(G){var F=this.at(0);this.remove(F,G);return F},get:function(F){if(F==null){return void 0}return this._byId[F.id!=null?F.id:F]},getByCid:function(F){return F&&this._byCid[F.cid||F]},at:function(F){return this.models[F]},where:function(F){if(D.isEmpty(F)){return[]}return this.filter(function(G){for(var H in F){if(F[H]!==G.get(H)){return false}}return true})},sort:function(G){G||(G={});if(!this.comparator){throw new Error("Cannot sort a set without a comparator")}var F=D.bind(this.comparator,this);if(this.comparator.length==1){this.models=this.sortBy(F)}else{this.models.sort(F)}if(!G.silent){this.trigger("reset",this,G)}return this},pluck:function(F){return D.map(this.models,function(G){return G.get(F)})},reset:function(I,G){I||(I=[]);G||(G={});for(var H=0,F=this.models.length;H<F;H++){this._removeReference(this.models[H])}this._reset();this.add(I,D.extend({silent:true},G));if(!G.silent){this.trigger("reset",this,G)}return this},fetch:function(F){F=F?D.clone(F):{};if(F.parse===undefined){F.parse=true}var H=this;var G=F.success;F.success=function(K,I,J){H[F.add?"add":"reset"](H.parse(K,J),F);if(G){G(H,K)}};F.error=c.wrapError(F.error,H,F);return(this.sync||c.sync).call(this,"read",this,F)},create:function(G,F){var H=this;F=F?D.clone(F):{};G=this._prepareModel(G,F);if(!G){return false}if(!F.wait){H.add(G,F)}var I=F.success;F.success=function(J,L,K){if(F.wait){H.add(J,F)}if(I){I(J,L)}else{J.trigger("sync",G,L,F)}};G.save(null,F);return G},parse:function(G,F){return G},chain:function(){return D(this.models).chain()},_reset:function(F){this.length=0;this.models=[];this._byId={};this._byCid={}},_prepareModel:function(H,G){G||(G={});if(!(H instanceof n)){var F=H;G.collection=this;H=new this.model(F,G);if(!H._validate(H.attributes,G)){H=false}}else{if(!H.collection){H.collection=this}}return H},_removeReference:function(F){if(this==F.collection){delete F.collection}F.off("all",this._onModelEvent,this)},_onModelEvent:function(H,G,I,F){if((H=="add"||H=="remove")&&I!=this){return}if(H=="destroy"){this.remove(G,F)}if(G&&H==="change:"+G.idAttribute){delete this._byId[G.previous(G.idAttribute)];this._byId[G.id]=G}this.trigger.apply(this,arguments)}});var z=["forEach","each","map","reduce","reduceRight","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","sortBy","sortedIndex","toArray","size","first","initial","rest","last","without","indexOf","shuffle","lastIndexOf","isEmpty","groupBy"];D.each(z,function(F){E.prototype[F]=function(){return D[F].apply(D,[this.models].concat(D.toArray(arguments)))}});var C=c.Router=function(F){F||(F={});if(F.routes){this.routes=F.routes}this._bindRoutes();this.initialize.apply(this,arguments)};var l=/:\w+/g;var A=/\*\w+/g;var f=/[-[\]{}()+?.,\\^$|#\s]/g;D.extend(C.prototype,q,{initialize:function(){},route:function(F,G,H){c.history||(c.history=new b);if(!D.isRegExp(F)){F=this._routeToRegExp(F)}if(!H){H=this[G]}c.history.route(F,D.bind(function(J){var I=this._extractParameters(F,J);H&&H.apply(this,I);this.trigger.apply(this,["route:"+G].concat(I));c.history.trigger("route",this,G,I)},this));return this},navigate:function(G,F){c.history.navigate(G,F)},_bindRoutes:function(){if(!this.routes){return}var G=[];for(var H in this.routes){G.unshift([H,this.routes[H]])}for(var I=0,F=G.length;I<F;I++){this.route(G[I][0],G[I][1],this[G[I][1]])}},_routeToRegExp:function(F){F=F.replace(f,"\\$&").replace(l,"([^/]+)").replace(A,"(.*?)");return new RegExp("^"+F+"$")},_extractParameters:function(F,G){return F.exec(G).slice(1)}});var b=c.History=function(){this.handlers=[];D.bindAll(this,"checkUrl")};var p=/^[#\/]/;var m=/msie [\w.]+/;b.started=false;D.extend(b.prototype,q,{interval:50,getHash:function(H){var G=H?H.location:window.location;var F=G.href.match(/#(.*)$/);return F?F[1]:""},getFragment:function(G,F){if(G==null){if(this._hasPushState||F){G=window.location.pathname;var H=window.location.search;if(H){G+=H}}else{G=this.getHash()}}if(!G.indexOf(this.options.root)){G=G.substr(this.options.root.length)}return G.replace(p,"")},start:function(H){if(b.started){throw new Error("Backbone.history has already been started")}b.started=true;this.options=D.extend({},{root:"/"},this.options,H);this._wantsHashChange=this.options.hashChange!==false;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.options.pushState&&window.history&&window.history.pushState);var G=this.getFragment();var F=document.documentMode;var J=(m.exec(navigator.userAgent.toLowerCase())&&(!F||F<=7));if(J){this.iframe=h('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow;this.navigate(G)}if(this._hasPushState){h(window).bind("popstate",this.checkUrl)}else{if(this._wantsHashChange&&("onhashchange" in window)&&!J){h(window).bind("hashchange",this.checkUrl)}else{if(this._wantsHashChange){this._checkUrlInterval=setInterval(this.checkUrl,this.interval)}}}this.fragment=G;var K=window.location;var I=K.pathname==this.options.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!I){this.fragment=this.getFragment(null,true);window.location.replace(this.options.root+"#"+this.fragment);return true}else{if(this._wantsPushState&&this._hasPushState&&I&&K.hash){this.fragment=this.getHash().replace(p,"");window.history.replaceState({},document.title,K.protocol+"//"+K.host+this.options.root+this.fragment)}}if(!this.options.silent){return this.loadUrl()}},stop:function(){h(window).unbind("popstate",this.checkUrl).unbind("hashchange",this.checkUrl);clearInterval(this._checkUrlInterval);b.started=false},route:function(F,G){this.handlers.unshift({route:F,callback:G})},checkUrl:function(G){var F=this.getFragment();if(F==this.fragment&&this.iframe){F=this.getFragment(this.getHash(this.iframe))}if(F==this.fragment){return false}if(this.iframe){this.navigate(F)}this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(H){var G=this.fragment=this.getFragment(H);var F=D.any(this.handlers,function(I){if(I.route.test(G)){I.callback(G);return true}});return F},navigate:function(G,F){if(!b.started){return false}if(!F||F===true){F={trigger:F}}var H=(G||"").replace(p,"");if(this.fragment==H){return}if(this._hasPushState){if(H.indexOf(this.options.root)!=0){H=this.options.root+H}this.fragment=H;window.history[F.replace?"replaceState":"pushState"]({},document.title,H)}else{if(this._wantsHashChange){this.fragment=H;this._updateHash(window.location,H,F.replace);if(this.iframe&&(H!=this.getFragment(this.getHash(this.iframe)))){if(!F.replace){this.iframe.document.open().close()}this._updateHash(this.iframe.location,H,F.replace)}}else{window.location.assign(this.options.root+G)}}if(F.trigger){this.loadUrl(G)}},_updateHash:function(F,G,H){if(H){F.replace(F.toString().replace(/(javascript:|#).*$/,"")+"#"+G)}else{F.hash=G}}});var v=c.View=function(F){this.cid=D.uniqueId("view");this._configure(F||{});this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents()};var g=/^(\S+)\s*(.*)$/;var x=["model","collection","el","id","attributes","className","tagName"];D.extend(v.prototype,q,{tagName:"div",$:function(F){return this.$el.find(F)},initialize:function(){},render:function(){return this},remove:function(){this.$el.remove();return this},make:function(G,F,I){var H=document.createElement(G);if(F){h(H).attr(F)}if(I){h(H).html(I)}return H},setElement:function(F,G){if(this.$el){this.undelegateEvents()}this.$el=(F instanceof h)?F:h(F);this.el=this.$el[0];if(G!==false){this.delegateEvents()}return this},delegateEvents:function(J){if(!(J||(J=e(this,"events")))){return}this.undelegateEvents();for(var I in J){var K=J[I];if(!D.isFunction(K)){K=this[J[I]]}if(!K){throw new Error('Method "'+J[I]+'" does not exist')}var H=I.match(g);var G=H[1],F=H[2];K=D.bind(K,this);G+=".delegateEvents"+this.cid;if(F===""){this.$el.bind(G,K)}else{this.$el.delegate(F,G,K)}}},undelegateEvents:function(){this.$el.unbind(".delegateEvents"+this.cid)},_configure:function(H){if(this.options){H=D.extend({},this.options,H)}for(var I=0,G=x.length;I<G;I++){var F=x[I];if(H[F]){this[F]=H[F]}}this.options=H},_ensureElement:function(){if(!this.el){var F=e(this,"attributes")||{};if(this.id){F.id=this.id}if(this.className){F["class"]=this.className}this.setElement(this.make(this.tagName,F),false)}else{this.setElement(this.el,false)}}});var y=function(F,G){var H=o(this,F,G);H.extend=this.extend;return H};n.extend=E.extend=C.extend=v.extend=y;var u={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};c.sync=function(J,G,F){var H=u[J];F||(F={});var I={type:H,dataType:"json"};if(!F.url){I.url=e(G,"url")||w()}if(!F.data&&G&&(J=="create"||J=="update")){I.contentType="application/json";I.data=JSON.stringify(G.toJSON())}if(c.emulateJSON){I.contentType="application/x-www-form-urlencoded";I.data=I.data?{model:I.data}:{}}if(c.emulateHTTP){if(H==="PUT"||H==="DELETE"){if(c.emulateJSON){I.data._method=H}I.type="POST";I.beforeSend=function(K){K.setRequestHeader("X-HTTP-Method-Override",H)}}}if(I.type!=="GET"&&!c.emulateJSON){I.processData=false}return h.ajax(D.extend(I,F))};c.wrapError=function(G,H,F){return function(I,J){J=I===H?J:I;if(G){G(H,J,F)}else{H.trigger("error",H,J,F)}}};var k=function(){};var o=function(G,F,H){var I;if(F&&F.hasOwnProperty("constructor")){I=F.constructor}else{I=function(){G.apply(this,arguments)}}D.extend(I,G);k.prototype=G.prototype;I.prototype=new k();if(F){D.extend(I.prototype,F)}if(H){D.extend(I,H)}I.prototype.constructor=I;I.__super__=G.prototype;return I};var e=function(F,G){if(!(F&&F[G])){return null}return D.isFunction(F[G])?F[G]():F[G]};var w=function(){throw new Error('A "url" property or function must be specified')}}).call(this);window.Torso={};(function(a){a.View=Backbone.View.extend({template:_.template(""),initialize:function(b){_.bindAll(this,"setup","render");this.render(b)},render:function(b){this.$el.html(this.template(b));this.setup(b)},setup:function(){}});a.Screen=a.View.extend({_isScreen:true,modal:false,initialize:function(b){_.bindAll(this,"setup","render");this.session=b.session;this.render(b)}});a.Router=Backbone.Router.extend({initialize:function(b){this.app=b.app;this.routes=b.routes||{};this.on("all",function(e){if(e.indexOf("route:"===0)){var c=Array.prototype.slice.call(arguments,1);this.app.navigate(e.substr("route:".length),c)}}.bind(this));Backbone.history.start()}});a.App=Backbone.View.extend({initialize:function(c){_.bindAll(this,"display","clear","navigate");this.session=c.session||new Backbone.Model();this.defaults=c.defaults||{};this.containers=c.containers||{};this.screens=c.screens||{};this.initialized=false;for(var b in this.defaults){this.navigate(this.defaults[b],null,b)}},display:function(c,b){b=b||((c.modal&&this.initialized)?"modal":"main");var f=this.containers[b];if(typeof f!=="undefined"){f.empty();if(c){f.addClass("populated").append(c.$el);var g=this.containers.modal;if(b==="main"&&typeof g!=="undefined"){this.clear("modal")}var h={container:b,el:f,screen:c};this.trigger("display",h);this.trigger("display:"+b,h)}else{if(f.hasClass("populated")){f.removeClass("populated");var h={container:b,el:f};this.trigger("clear",h);this.trigger("clear:"+b,h)}}if(b==="main"){this.initialized=true}}else{throw new Error('Invalid container "'+b+'"')}},clear:function(b){this.display(null,b)},navigate:function(c,g,b){var f;if(typeof c==="string"){f=c;c=this.screens[f]}if(typeof c!=="undefined"){var e=new c({session:this.session,args:g});this.display(e,b)}else{throw new Error('No Screen was defined for id "'+f+'"')}}})})(window.Torso);(function(J,q){var N,u="1.6.2",S=Math.round,T,G={},y="en",F=(typeof module!=="undefined"),p="months|monthsShort|monthsParse|weekdays|weekdaysShort|longDateFormat|calendar|relativeTime|ordinal|meridiem".split("|"),t=/^\/?Date\((\-?\d+)/i,m=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|dddd?|do?|w[o|w]?|YYYY|YY|a|A|hh?|HH?|mm?|ss?|SS?S?|zz?|ZZ?|LT|LL?L?L?)/g,U=/([0-9a-zA-Z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+)/gi,h=/\d\d?/,H=/\d{1,3}/,I=/\d{3}/,A=/\d{4}/,B=/[0-9a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+/i,b=/Z|[\+\-]\d\d:?\d\d/i,r=/T/i,C=/^\s*\d{4}-\d\d-\d\d(T(\d\d(:\d\d(:\d\d(\.\d\d?\d?)?)?)?)?([\+\-]\d\d:?\d\d)?)?/,e="YYYY-MM-DDTHH:mm:ssZ",k=[["HH:mm:ss.S",/T\d\d:\d\d:\d\d\.\d{1,3}/],["HH:mm:ss",/T\d\d:\d\d:\d\d/],["HH:mm",/T\d\d:\d\d/],["HH",/T\d\d/]],w=/([\+\-]|\d\d)/gi,n="Month|Date|Hours|Minutes|Seconds|Milliseconds".split("|"),P={Milliseconds:1,Seconds:1000,Minutes:60000,Hours:3600000,Days:86400000,Months:2592000000,Years:31536000000};function s(X,W){this._d=X;this._isUTC=!!W}function O(W){if(W<0){return Math.ceil(W)}else{return Math.floor(W)}}function V(Z){var ab=this._data={},ac=Z.years||Z.y||0,X=Z.months||Z.M||0,W=Z.weeks||Z.w||0,af=Z.days||Z.d||0,ad=Z.hours||Z.h||0,aa=Z.minutes||Z.m||0,ae=Z.seconds||Z.s||0,Y=Z.milliseconds||Z.ms||0;this._milliseconds=Y+ae*1000+aa*60000+ad*3600000;this._days=af+W*7;this._months=X+ac*12;ab.milliseconds=Y%1000;ae+=O(Y/1000);ab.seconds=ae%60;aa+=O(ae/60);ab.minutes=aa%60;ad+=O(aa/60);ab.hours=ad%24;af+=O(ad/24);af+=W*7;ab.days=af%30;X+=O(af/30);ab.months=X%12;ac+=O(X/12);ab.years=ac}function R(Y,X){var W=Y+"";while(W.length<X){W="0"+W}return W}function L(Y,aa,Z){var X=aa._milliseconds,ab=aa._days,ac=aa._months,W;if(X){Y._d.setTime(+Y+X*Z)}if(ab){Y.date(Y.date()+ab*Z)}if(ac){W=Y.date();Y.date(1).month(Y.month()+ac*Z).date(Math.min(W,Y.daysInMonth()))}}function x(W){return Object.prototype.toString.call(W)==="[object Array]"}function l(W){return new J(W[0],W[1]||0,W[2]||1,W[3]||0,W[4]||0,W[5]||0,W[6]||0)}function E(Y,ag){var af=Y.month(),W=Y.date(),ab=Y.year(),ad=Y.day(),ai=Y.hours(),Z=Y.minutes(),X=Y.seconds(),ae=Y.milliseconds(),aa=-Y.zone(),ac=N.ordinal,aj=N.meridiem;function ah(am){var al,ak;switch(am){case"M":return af+1;case"Mo":return(af+1)+ac(af+1);case"MM":return R(af+1,2);case"MMM":return N.monthsShort[af];case"MMMM":return N.months[af];case"D":return W;case"Do":return W+ac(W);case"DD":return R(W,2);case"DDD":al=new J(ab,af,W);ak=new J(ab,0,1);return ~~(((al-ak)/86400000)+1.5);case"DDDo":al=ah("DDD");return al+ac(al);case"DDDD":return R(ah("DDD"),3);case"d":return ad;case"do":return ad+ac(ad);case"ddd":return N.weekdaysShort[ad];case"dddd":return N.weekdays[ad];case"w":al=new J(ab,af,W-ad+5);ak=new J(al.getFullYear(),0,4);return ~~((al-ak)/86400000/7+1.5);case"wo":al=ah("w");return al+ac(al);case"ww":return R(ah("w"),2);case"YY":return R(ab%100,2);case"YYYY":return ab;case"a":return aj?aj(ai,Z,false):(ai>11?"pm":"am");case"A":return aj?aj(ai,Z,true):(ai>11?"PM":"AM");case"H":return ai;case"HH":return R(ai,2);case"h":return ai%12||12;case"hh":return R(ai%12||12,2);case"m":return Z;case"mm":return R(Z,2);case"s":return X;case"ss":return R(X,2);case"S":return ~~(ae/100);case"SS":return R(~~(ae/10),2);case"SSS":return R(ae,3);case"Z":return(aa<0?"-":"+")+R(~~(Math.abs(aa)/60),2)+":"+R(~~(Math.abs(aa)%60),2);case"ZZ":return(aa<0?"-":"+")+R(~~(10*Math.abs(aa)/6),4);case"L":case"LL":case"LLL":case"LLLL":case"LT":return E(Y,N.longDateFormat[am]);default:return am.replace(/(^\[)|(\\)|\]$/g,"")}}return ag.replace(m,ah)}function g(W){switch(W){case"DDDD":return I;case"YYYY":return A;case"S":case"SS":case"SSS":case"DDD":return H;case"MMM":case"MMMM":case"ddd":case"dddd":case"a":case"A":return B;case"Z":case"ZZ":return b;case"T":return r;case"MM":case"DD":case"dd":case"YY":case"HH":case"hh":case"mm":case"ss":case"M":case"D":case"d":case"H":case"h":case"m":case"s":return h;default:return new RegExp(W.replace("\\",""))}}function f(aa,Y,X,Z){var W;switch(aa){case"M":case"MM":X[1]=(Y==null)?0:~~Y-1;break;case"MMM":case"MMMM":for(W=0;W<12;W++){if(N.monthsParse[W].test(Y)){X[1]=W;break}}break;case"D":case"DD":case"DDD":case"DDDD":X[2]=~~Y;break;case"YY":Y=~~Y;X[0]=Y+(Y>70?1900:2000);break;case"YYYY":X[0]=~~Math.abs(Y);break;case"a":case"A":Z.isPm=((Y+"").toLowerCase()==="pm");break;case"H":case"HH":case"h":case"hh":X[3]=~~Y;break;case"m":case"mm":X[4]=~~Y;break;case"s":case"ss":X[5]=~~Y;break;case"S":case"SS":case"SSS":X[6]=~~(("0."+Y)*1000);break;case"Z":case"ZZ":Z.isUTC=true;W=(Y+"").match(w);if(W&&W[1]){Z.tzh=~~W[1]}if(W&&W[2]){Z.tzm=~~W[2]}if(W&&W[0]==="+"){Z.tzh=-Z.tzh;Z.tzm=-Z.tzm}break}}function D(Y,ac){var W=[0,0,1,0,0,0,0],X={tzh:0,tzm:0},ab=ac.match(m),Z,aa;for(Z=0;Z<ab.length;Z++){aa=(g(ab[Z]).exec(Y)||[])[0];Y=Y.replace(g(ab[Z]),"");f(ab[Z],aa,W,X)}if(X.isPm&&W[3]<12){W[3]+=12}if(X.isPm===false&&W[3]===12){W[3]=0}W[3]+=X.tzh;W[4]+=X.tzm;return X.isUTC?new J(J.UTC.apply({},W)):l(W)}function K(aa,Z){var W=Math.min(aa.length,Z.length),X=Math.abs(aa.length-Z.length),ab=0,Y;for(Y=0;Y<W;Y++){if(~~aa[Y]!==~~Z[Y]){ab++}}return ab+X}function v(aa,ac){var X,ad=aa.match(U)||[],ab,ae=99,Z,W,Y;for(Z=0;Z<ac.length;Z++){W=D(aa,ac[Z]);ab=E(new s(W),ac[Z]).match(U)||[];Y=K(ad,ab);if(Y<ae){ae=Y;X=W}}return X}function Q(W){var Y="YYYY-MM-DDT",X;if(C.exec(W)){for(X=0;X<4;X++){if(k[X][1].exec(W)){Y+=k[X][0];break}}return b.exec(W)?D(W,Y+" Z"):D(W,Y)}return new J(W)}function M(X,Z,Y,aa){var W=N.relativeTime[X];return(typeof W==="function")?W(Z||1,!!Y,X,aa):W.replace(/%d/i,Z||1)}function z(Y,ab){var ac=S(Math.abs(Y)/1000),aa=S(ac/60),W=S(aa/60),ad=S(W/24),Z=S(ad/365),X=ac<45&&["s",ac]||aa===1&&["m"]||aa<45&&["mm",aa]||W===1&&["h"]||W<22&&["hh",W]||ad===1&&["d"]||ad<=25&&["dd",ad]||ad<=45&&["M"]||ad<345&&["MM",S(ad/30)]||Z===1&&["y"]||["yy",Z];X[2]=ab;X[3]=Y>0;return M.apply({},X)}N=function(Y,aa){if(Y===null||Y===""){return null}var Z,W,X;if(N.isMoment(Y)){Z=new J(+Y._d);X=Y._isUTC}else{if(aa){if(x(aa)){Z=v(Y,aa)}else{Z=D(Y,aa)}}else{W=t.exec(Y);Z=Y===q?new J():W?new J(+W[1]):Y instanceof J?Y:x(Y)?l(Y):typeof Y==="string"?Q(Y):new J(Y)}}return new s(Z,X)};N.utc=function(W,X){if(x(W)){return new s(new J(J.UTC.apply({},W)),true)}return(X&&W)?N(W+" +0000",X+" Z").utc():N(W&&!b.exec(W)?W+"+0000":W).utc()};N.unix=function(W){return N(W*1000)};N.duration=function(W,Z){var Y=N.isDuration(W),X=(typeof W==="number"),aa=(Y?W._data:(X?{}:W));if(X){if(Z){aa[Z]=W}else{aa.milliseconds=W}}return new V(aa)};N.humanizeDuration=function(W,X,Y){return N.duration(W,X===true?null:X).humanize(X===true?true:Y)};N.version=u;N.defaultFormat=e;N.lang=function(Y,W){var X,Z,aa=[];if(!Y){return y}if(W){for(X=0;X<12;X++){aa[X]=new RegExp("^"+W.months[X]+"|^"+W.monthsShort[X].replace(".",""),"i")}W.monthsParse=W.monthsParse||aa;G[Y]=W}if(G[Y]){for(X=0;X<p.length;X++){N[p[X]]=G[Y][p[X]]||G.en[p[X]]}y=Y}else{if(F){Z=require("./lang/"+Y);N.lang(Y,Z)}}};N.lang("en",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"dddd, MMMM D YYYY LT"},meridiem:false,calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},ordinal:function(X){var W=X%10;return(~~(X%100/10)===1)?"th":(W===1)?"st":(W===2)?"nd":(W===3)?"rd":"th"}});N.isMoment=function(W){return W instanceof s};N.isDuration=function(W){return W instanceof V};N.fn=s.prototype={clone:function(){return N(this)},valueOf:function(){return +this._d},unix:function(){return Math.floor(+this._d/1000)},toString:function(){return this._d.toString()},toDate:function(){return this._d},utc:function(){this._isUTC=true;return this},local:function(){this._isUTC=false;return this},format:function(W){return E(this,W?W:N.defaultFormat)},add:function(W,Y){var X=Y?N.duration(+Y,W):N.duration(W);L(this,X,1);return this},subtract:function(W,Y){var X=Y?N.duration(+Y,W):N.duration(W);L(this,X,-1);return this},diff:function(ad,Y,af){var W=this._isUTC?N(ad).utc():N(ad).local(),aa=(this.zone()-W.zone())*60000,ae=this._d-W._d-aa,ac=this.year()-W.year(),ab=this.month()-W.month(),Z=this.date()-W.date(),X;if(Y==="months"){X=ac*12+ab+Z/30}else{if(Y==="years"){X=ac+(ab+Z/30)/12}else{X=Y==="seconds"?ae/1000:Y==="minutes"?ae/60000:Y==="hours"?ae/3600000:Y==="days"?ae/86400000:Y==="weeks"?ae/604800000:ae}}return af?X:S(X)},from:function(X,W){return N.duration(this.diff(X)).humanize(!W)},fromNow:function(W){return this.from(N(),W)},calendar:function(){var Z=this.diff(N().sod(),"days",true),Y=N.calendar,X=Y.sameElse,W=Z<-6?X:Z<-1?Y.lastWeek:Z<0?Y.lastDay:Z<1?Y.sameDay:Z<2?Y.nextDay:Z<7?Y.nextWeek:X;return this.format(typeof W==="function"?W.apply(this):W)},isLeapYear:function(){var W=this.year();return(W%4===0&&W%100!==0)||W%400===0},isDST:function(){return(this.zone()<N([this.year()]).zone()||this.zone()<N([this.year(),5]).zone())},day:function(X){var W=this._isUTC?this._d.getUTCDay():this._d.getDay();return X==null?W:this.add({d:X-W})},sod:function(){return N(this).hours(0).minutes(0).seconds(0).milliseconds(0)},eod:function(){return this.sod().add({d:1,ms:-1})},zone:function(){return this._isUTC?0:this._d.getTimezoneOffset()},daysInMonth:function(){return N(this).month(this.month()+1).date(0).date()}};function o(W,X){N.fn[W]=function(Y){var Z=this._isUTC?"UTC":"";if(Y!=null){this._d["set"+Z+X](Y);return this}else{return this._d["get"+Z+X]()}}}for(T=0;T<n.length;T++){o(n[T].toLowerCase(),n[T])}o("year","FullYear");N.duration.fn=V.prototype={weeks:function(){return O(this.days()/7)},valueOf:function(){return this._milliseconds+this._days*86400000+this._months*2592000000},humanize:function(Y){var Z=+this,W=N.relativeTime,X=z(Z,!Y);if(Y){X=(Z<=0?W.past:W.future).replace(/%s/i,X)}return X}};function a(W){N.duration.fn[W]=function(){return this._data[W]}}function c(W,X){N.duration.fn["as"+W]=function(){return +this/X}}for(T in P){if(P.hasOwnProperty(T)){c(T,P[T]);a(T.toLowerCase())}}c("Weeks",604800000);if(F){module.exports=N}if(typeof window!=="undefined"&&typeof ender==="undefined"){window.moment=N}if(typeof define==="function"&&define.amd){define("moment",[],function(){return N})}})(Date);var filepicker=(function(){var apiKey;var setAPIKey=function(key){apiKey=key};var BASE_URL="https://www.filepicker.io";var MIMETYPES={ALL:"*/*",IMAGES:"image/*",JPG:"image/jpeg",GIF:"image/gif",PNG:"image/png",PDF:"application/pdf",AUDIO:"audio/*",MP3:"audio/mpeg",TEXT:"text/*",HTML:"text/html",XML:"text/xml",VCARD:"text/vcard",VIDEO:"video/*",MPEG:"video/mpeg",MP4:"video/mp4"};var SERVICES={BOX:0,COMPUTER:1,DROPBOX:2,FACEBOOK:3,GITHUB:4,GMAIL:5,IMAGE_SEARCH:6,URL:7,WEBCAM:8,GOOGLE_DRIVE:9,SEND_EMAIL:10};var NEW_WINDOW=false;var THIRD_PARTY_COOKIES;var MAX_RETRIES=5;var MAX_CHUNK_SIZE=1*1024*1024;var FilepickerException=function(text){this.text=text;this.toString=function(){return"FilepickerException: "+this.text}};var isArray=function(o){return Object.prototype.toString.call(o)==="[object Array]"};var DIALOG_TYPES={OPEN:"/dialog/open/",SAVEAS:"/dialog/save/"};var URL_REGEX=/^(http|https)\:.*\/\//i;var pickerWindowProperties="left=100,top=100,height=600,width=800,menubar=no,toolbar=no,location=no,personalbar=no,status=no,resizable=yes,scrollbars=yes,dependent=yes,dialog=yes";var WINDOW_NAME="filepicker_dialog";var WINDOW_CONTAINER_NAME="filepicker_dialog_container";var SHADE_NAME="filepicker_shade";var IFRAME_NAME="filepicker_iframe";var COMM_IFRAME_NAME="filepicker_comm_iframe";var endpoints={};endpoints.tempStorage=BASE_URL+"/api/path/storage/";endpoints.commUrl=BASE_URL+"/dialog/comm_iframe/";endpoints.open=BASE_URL+DIALOG_TYPES.OPEN;endpoints.saveas=BASE_URL+DIALOG_TYPES.SAVEAS;var constructOpenURL=function(mimetypes,id,options){return endpoints.open+"?m="+mimetypes.join(",")+"&key="+apiKey+"&id="+id+"&referrer="+window.location.hostname+"&modal="+(options.container=="modal")+(options.services?"&s="+options.services.join(","):"")+(options.multiple?"&multi="+options.multiple:"")+(options.location!==undefined?"&loc="+options.location:"")+(options.metadata?"&meta="+options.metadata:"")+(options.maxsize?"&maxsize="+options.maxsize:"")+(options.persist?"&p="+options.persist:"")+(options.auth_tokens?"&auth_tokens="+options.auth_tokens:"")};var constructSaveAsURL=function(fileurl,mimetype,id,options){return endpoints.saveas+"?url="+fileurl+"&m="+mimetype+"&key="+apiKey+"&id="+id+"&referrer="+window.location.hostname+"&modal="+(options.container=="modal")+(options.services?"&s="+options.services:"")+(options.location!==undefined?"&loc="+options.location:"")};var openCommIframe=function(){if(window.frames[COMM_IFRAME_NAME]===undefined){openCommunicationsChannel();var commIFrame;commIFrame=document.createElement("iframe");commIFrame.name=COMM_IFRAME_NAME;commIFrame.src=endpoints.commUrl;commIFrame.style.display="none";document.body.appendChild(commIFrame)}};var openCommunicationsChannel=function(){if(openCommunicationsChannel.set){return}else{openCommunicationsChannel.set=true}var communicationsHandler=function(event){if(event.origin!=BASE_URL){return}var data=JSON.parse(event.data);handlers.run(data)};if(window.addEventListener){window.addEventListener("message",communicationsHandler,false)}else{if(window.attachEvent){window.attachEvent("onmessage",communicationsHandler)}else{throw new FilepickerException("Unsupported browser")}}};var getReceiveUrlMessage=function(callback,multiple){var handler=function(data){if(data.type!=="filepickerUrl"){return}if(isArray(data.payload)){callback(data.payload)}else{if(multiple){callback([data.payload])}else{callback(data.payload.url,data.payload.data)}}closeModal()};return handler};var getReceiveCookiesMessage=function(callback){var handler=function(data){if(data.type!=="ThirdPartyCookies"){return}THIRD_PARTY_COOKIES=!!data.payload;if(callback&&typeof callback==="function"){callback(!!data.payload)}};return handler};var handlers={};handlers._storage={cookies:getReceiveCookiesMessage()};handlers.attachHandler=function(id,handler){handlers._storage[id]=handler;return handler};handlers.detachHandler=function(id){return delete (handlers._storage[id])};handlers.run=function(data){var callerId=data.id;if(handlers._storage.hasOwnProperty(callerId)){handlers._storage[callerId](data);return true}return false};var generateModal=function(modalUrl){var shade=createModalShade();var container=createModalContainer();var close=createModalClose();var modal=document.createElement("iframe");modal.name=WINDOW_NAME;modal.id=WINDOW_NAME;var size=getWindowSize();var height=Math.min(size[1]-40,500);modal.style.width="100%";modal.style.height=height-32+"px";modal.style.border="none";modal.style.position="relative";modal.setAttribute("frameborder",0);modal.setAttribute("marginwidth",0);modal.setAttribute("marginheight",0);modal.src=modalUrl;document.body.appendChild(shade);container.appendChild(close);container.appendChild(modal);document.body.appendChild(container);return modal};var createModalShade=function(){var shade=document.createElement("div");shade.id=SHADE_NAME;shade.style.position="fixed";shade.style.top=0;shade.style.bottom=0;shade.style.right=0;shade.style.left=0;shade.style.backgroundColor="#000000";shade.style.opacity="0.5";shade.style.filter="alpha(opacity=50)";shade.style.zIndex=10000;shade.onclick=filepicker.closeModal;return shade};var createModalContainer=function(){var modalcontainer=document.createElement("div");modalcontainer.id=WINDOW_CONTAINER_NAME;modalcontainer.style.position="fixed";modalcontainer.style.padding="10px";modalcontainer.style.background="white";modalcontainer.style.top="10px";modalcontainer.style.bottom="auto";modalcontainer.style.right="auto";var size=getWindowSize();var height=Math.min(size[1]-40,500);var width=Math.min(size[0]-40,800);var leftspacing=(size[0]-width-40)/2;modalcontainer.style.left=leftspacing+"px";modalcontainer.style.height=height+"px";modalcontainer.style.width=width+"px";modalcontainer.style.overflow="auto";modalcontainer.style.webkitOverflowScrolling="touch";modalcontainer.style.border="1px solid #999";modalcontainer.style.webkitBorderRadius="6px";modalcontainer.style.borderRadius="6px";modalcontainer.style.margin="0";modalcontainer.style.webkitBoxShadow="0 3px 7px rgba(0, 0, 0, 0.3)";modalcontainer.style.boxShadow="0 3px 7px rgba(0, 0, 0, 0.3)";modalcontainer.style.zIndex=10001;return modalcontainer};var createModalClose=function(){var close=document.createElement("a");close.appendChild(document.createTextNode("\u00D7"));close.onclick=filepicker.closeModal;close.style["float"]="right";close.style.cursor="default";close.style.padding="0 5px 0 0px";close.style.fontSize="1.5em";close.style.color="#000000";close.style.textDecoration="none";return close};var closeModal=function(){var shade=document.getElementById(SHADE_NAME);if(shade){document.body.removeChild(shade)}var container=document.getElementById(WINDOW_CONTAINER_NAME);if(container){document.body.removeChild(container)}};var getID=function(){d=new Date();return d.getTime().toString()};var getFile=function(mimetype,options,callback){return openFilepickerWindow(DIALOG_TYPES.OPEN,{mimetype:mimetype,options:options,callback:callback})};var saveFileAs=function(file_url,mimetype,options,callback){return openFilepickerWindow(DIALOG_TYPES.SAVEAS,{file_url:file_url,mimetype:mimetype,options:options,callback:callback})};var openFilepickerWindow=function(dialogType,args){var picker;var handler;var file_url;if(!apiKey){throw new FilepickerException("API Key not found")}if(dialogType!=DIALOG_TYPES.OPEN&&dialogType!=DIALOG_TYPES.SAVEAS){return null}if(dialogType==DIALOG_TYPES.SAVEAS){file_url=args.file_url;if(!file_url||typeof file_url!="string"){throw new FilepickerException("The provided File URL ('"+file_url+"') is not valid")}if(!file_url.match(URL_REGEX)){throw new FilepickerException(file_url+" is not a valid url. Make sure it starts with http or https")}}var mimetype=args.mimetype;var options=args.options;var callback=args.callback;mimetype=mimetype||MIMETYPES.ALL;if(!isArray(mimetype)){mimetype=[mimetype]}if(options.services&&!isArray(options.services)){options.services=[options.services]}if(typeof options==="function"){callback=options;options={}}callback=callback||function(){};if(options.debug){dummy_url="https://www.filepicker.io/api/file/-nBq2onTSemLBxlcBWn1";data={filename:"test.png",type:"image/png",size:58979};window.setTimeout(function(){if(options.multiple){callback([{url:dummy_url,data:data},{url:dummy_url,data:data}])}else{callback(dummy_url,data)}},100);return window}if(options.container===undefined){if(options.modal===undefined){options.container=NEW_WINDOW?"window":"modal"}else{options.container=options.modal?"modal":"window"}}if(options.container=="modal"){if(utilities.isIOS()||utilities.isAndroid()){options.container="window"}}var iframe=options.container!="window";var smallScreen=(getWindowSize()[0]<768);iframe=iframe&&!smallScreen;if(THIRD_PARTY_COOKIES!==undefined){iframe=iframe&&THIRD_PARTY_COOKIES;openCommIframe()}else{if(iframe){var cookie_callback=function(){if(dialogType==DIALOG_TYPES.OPEN){getFile(mimetype,options,callback)}else{if(dialogType==DIALOG_TYPES.SAVEAS){saveFileAs(file_url,mimetype,options,callback)}}};determineThirdPartyCookies(cookie_callback);return null}}if(options.auth_tokens!==undefined){var auth_tokens=JSON.stringify(options.auth_tokens);options.auth_tokens=encodeURIComponent(auth_tokens)}var id=getID();var url;if(dialogType==DIALOG_TYPES.OPEN){url=constructOpenURL(mimetype,id,options)}else{if(dialogType==DIALOG_TYPES.SAVEAS){url=constructSaveAsURL(file_url,mimetype,id,options)}}if(options.container=="window"){picker=window.open(url,WINDOW_NAME,pickerWindowProperties)}else{if(options.container=="modal"){picker=generateModal(url)}else{var container_iframe=document.getElementById(options.container);if(!iframe){throw new FilepickerException("Container '"+options.container+"' not found. This should either be set to 'window','modal', or the ID of an iframe that is currently in the document.")}container_iframe.src=url}}handlers.attachHandler(id,getReceiveUrlMessage(callback,!!options.multiple));return picker};var determineThirdPartyCookies=function(callback){handler=getReceiveCookiesMessage(callback);handlers.attachHandler("cookies",handler);openCommIframe()};var Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(input){var output="";var chr1,chr2,chr3,enc1,enc2,enc3,enc4;var i=0;input=Base64._utf8_encode(input);while(i<input.length){chr1=input.charCodeAt(i);chr2=input.charCodeAt(i+1);chr3=input.charCodeAt(i+2);i+=3;enc1=chr1>>2;enc2=((chr1&3)<<4)|(chr2>>4);enc3=((chr2&15)<<2)|(chr3>>6);enc4=chr3&63;if(isNaN(chr2)){enc3=enc4=64}else{if(isNaN(chr3)){enc4=64}}output=output+this._keyStr.charAt(enc1)+this._keyStr.charAt(enc2)+this._keyStr.charAt(enc3)+this._keyStr.charAt(enc4)}return output},decode:function(input){var output="";var chr1,chr2,chr3;var enc1,enc2,enc3,enc4;var i=0;input=input.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(i<input.length){enc1=this._keyStr.indexOf(input.charAt(i));enc2=this._keyStr.indexOf(input.charAt(i+1));enc3=this._keyStr.indexOf(input.charAt(i+2));enc4=this._keyStr.indexOf(input.charAt(i+3));i+=4;chr1=(enc1<<2)|(enc2>>4);chr2=((enc2&15)<<4)|(enc3>>2);chr3=((enc3&3)<<6)|enc4;output=output+String.fromCharCode(chr1);if(enc3!=64){output=output+String.fromCharCode(chr2)}if(enc4!=64){output=output+String.fromCharCode(chr3)}}output=Base64._utf8_decode(output);return output},_utf8_encode:function(string){string=string.replace(/\r\n/g,"\n");var utftext="";for(var n=0;n<string.length;n++){var c=string.charCodeAt(n);if(c<128){utftext+=String.fromCharCode(c)}else{if((c>127)&&(c<2048)){utftext+=String.fromCharCode((c>>6)|192);utftext+=String.fromCharCode((c&63)|128)}else{utftext+=String.fromCharCode((c>>12)|224);utftext+=String.fromCharCode(((c>>6)&63)|128);utftext+=String.fromCharCode((c&63)|128)}}}return utftext},_utf8_decode:function(utftext){var string="";var i=0;var c=c1=c2=0;while(i<utftext.length){c=utftext.charCodeAt(i);if(c<128){string+=String.fromCharCode(c);i++}else{if((c>191)&&(c<224)){c2=utftext.charCodeAt(i+1);string+=String.fromCharCode(((c&31)<<6)|(c2&63));i+=2}else{c2=utftext.charCodeAt(i+1);c3=utftext.charCodeAt(i+2);string+=String.fromCharCode(((c&15)<<12)|((c2&63)<<6)|(c3&63));i+=3}}}return string}};var getWindowSize=function(){if(document.body&&document.body.offsetWidth){winW=document.body.offsetWidth;winH=document.body.offsetHeight}if(document.compatMode=="CSS1Compat"&&document.documentElement&&document.documentElement.offsetWidth){winW=document.documentElement.offsetWidth;winH=document.documentElement.offsetHeight}if(window.innerWidth&&window.innerHeight){winW=window.innerWidth;winH=window.innerHeight}return[winW,winH]};var getUrlFromData=function(fileContents,filename,callback){if(typeof filename==="function"){callback=filename;filename=""}callback=callback||function(){};if(!fileContents){throw new FilepickerException("Error: no contents given")}var returnData;var base64contents=Base64.encode(fileContents);var request=utilities.ajax({method:"POST",url:endpoints.tempStorage+filename,data:{fileContents:base64contents,apikey:apiKey},json:true,success:function(returnJson){returnData=returnJson;if(returnData.result=="ok"){callback(returnData.url,returnData.data)}else{callback(null,returnData)}},error:function(msg){callback(null)}})};var getContents=function(file_url,base64encode,callback){if(typeof base64encode==="function"){callback=base64encode;base64encode=false}base64encode=!!base64encode;utilities.ajax({method:"GET",url:file_url,data:{base64encode:base64encode},success:function(responseText){callback(responseText)}})};var revokeFile=function(file_url,callback){if(!apiKey){throw new FilepickerException("API Key not found")}file_url+="/revoke";var request=utilities.ajax({method:"POST",url:file_url,success:function(responseText){callback(true,"success")},error:function(responseText){callback(false,responseText)},data:{key:apiKey}})};var utilities={};utilities.addOnLoad=function(func){if(window.jQuery){window.jQuery(function(){func()})}else{var evnt="load";if(window.addEventListener){window.addEventListener(evnt,func,false)}else{if(window.attachEvent){window.attachEvent("on"+evnt,func)}else{if(window.onload){var curr=window.onload;window.onload=function(){curr();func()}}else{window.onload=func}}}}};utilities.typeOf=function(value){if(value===null){return"null"}else{if(Object.prototype.toString.apply(value)==="[object Array]"){return"array"}}return typeof value};utilities.JSON=(function(){if(typeof JSON=="undefined"){this.JSON={}}var special={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};var escape=function(chr){return special[chr]||"\\u"+("0000"+chr.charCodeAt(0).toString(16)).slice(-4)};var validate=function(string){string=string.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"");return(/^[\],:{}\s]*$/).test(string)};var encode=JSON.stringify?function(obj){return JSON.stringify(obj)}:function(obj){if(obj&&obj.toJSON){obj=obj.toJSON()}switch(utilities.typeOf(obj)){case"string":return'"'+obj.replace(/[\x00-\x1f\\"]/g,escape)+'"';case"array":return"["+obj.map(encode).clean()+"]";case"object":case"hash":var string=[];Object.each(obj,function(value,key){var json=encode(value);if(json){string.push(encode(key)+":"+json)}});return"{"+string+"}";case"number":case"boolean":return""+obj;case"null":return"null";default:return"null"}return null};var decode=function(string,secure){if(!string||utilities.typeOf(string)!="string"){return null}if(JSON.parse){return JSON.parse(string)}else{if(secure){if(!validate(string)){throw new Error("JSON could not decode the input; security is enabled and the value is not secure.")}}return eval("("+string+")")}};return{validate:validate,encode:encode,decode:decode}})();utilities.isIOS=function(){if(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/iPad/i)){return true}else{return false}};utilities.isIOS=function(){if(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/iPad/i)){return true}else{return false}};utilities.isAndroid=function(){if(navigator.userAgent.match(/Android/i)){return true}else{return false}};utilities.ajax=(function(){var toQueryString=function(object,base){var queryString=[];for(var key in object){var value=object[key];if(base){key=base+"["+key+"]"}var result;switch(utilities.typeOf(value)){case"object":result=toQueryString(value,key);break;case"array":var qs={};value.each(function(val,i){qs[i]=val});result=toQueryString(qs,key);break;default:result=key+"="+encodeURIComponent(value);break}if(value!==null){queryString.push(result)}}return queryString.join("&")};var ajax=function(options){var url=options.url||null;var method=options.method?options.method.toUpperCase():"POST";var success=options.success||function(){};var error=options.error||function(){};var async=options.async===undefined?true:options.async;var data=options.data||null;var processData=options.processData===undefined?true:options.processData;if(data&&processData){data=toQueryString(options.data)}if(window.XDomainRequest){return XDomainAjax(options)}var xhr;if(options.xhr){xhr=options.xhr}else{try{xhr=new XMLHttpRequest()}catch(e){try{xhr=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{xhr=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){throw"Your browser does not support AJAX and so cannot excecute this method"}}}}var onStateChange=function(){if(xhr.readyState==4){if(xhr.status>=200&&xhr.status<300){var resp=xhr.responseText;if(options.json){resp=utilities.JSON.decode(resp)}success(resp,xhr)}else{error(xhr.responseText,xhr)}}xhr.onreadystatechage=function(){}};xhr.onreadystatechange=onStateChange;if(data&&method=="GET"){url+=(url.indexOf("?")!=-1?"&":"?")+data;data=null}xhr.open(method,url,async);if(options.json){xhr.setRequestHeader("Accept","application/json")}else{xhr.setRequestHeader("Accept","text/javascript, text/html, application/xml, text/xml, */*")}if(data&&processData&&(method=="POST"||method=="PUT")){xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=utf-8")}xhr.send(data);return xhr};var XDomainAjax=function(options){if(!window.XDomainRequest){return null}var url=options.url||null;var method=options.method?options.method.toUpperCase():"POST";var success=options.success||function(){};var error=options.error||function(){};var data=options.data||{};if(window.location.protocol=="http:"){url=url.replace("https:","http:")}else{if(window.location.protocol=="https:"){url=url.replace("http:","https:")}}if(options.async){throw new FilepickerException("Asyncronous Cross-domain requests are not supported")}if(method!="GET"&&method!="POST"){data._method=method;method="POST"}data=data?toQueryString(data):null;if(data&&method=="GET"){url+=(url.contains("?")?"&":"?")+data;data=null}var xdr=new window.XDomainRequest();xdr.onload=function(){var resp=xdr.responseText;if(options.json){resp=utilities.JSON.decode(resp)}success(resp,xdr)};xdr.onerror=function(){var resp=xdr.responseText||"error";error(resp,xdr)};xdr.open(method,url,true);xdr.send(data);return xdr};return ajax})();utilities.matchesMimetype=function(test,against){if(!test){return false}test=test.trim();against=against.trim();test_parts=test.split("/");against_parts=against.split("/");if(against_parts[0]=="*"){return true}if(against_parts[0]!=test_parts[0]){return false}if(against_parts[1]=="*"){return true}return against_parts[1]==test_parts[1]};utilities.addOnLoad(function(e){determineThirdPartyCookies()});var constructOpenWidgets=function(){var open_base=document.querySelectorAll('input[type="filepicker"]');var i;var j;var base;var ow;var holder;var mtypes;var fpoptions;var apikey;var services;var container;for(i=0;i<open_base.length;i++){base=open_base[i];ow=document.createElement("button");ow.innerHTML=base.getAttribute("data-fp-text")||"Pick File";ow.className=base.getAttribute("data-fp-class")||base.className;base.setAttribute("type","hidden");mtypes=(base.getAttribute("data-fp-mimetypes")||MIMETYPES.ALL).split(",");fpoptions={};container=base.getAttribute("data-fp-option-container");if(container){fpoptions.container=container}else{modal=(base.getAttribute("data-fp-option-modal")||"true")!="false";fpoptions.container=modal?"modal":"window"}fpoptions.multiple=(base.getAttribute("data-fp-option-multiple")||"false")!="false";fpoptions.persist=(base.getAttribute("data-fp-option-persist")||"false")!="false";if(base.getAttribute("data-fp-option-maxsize")){fpoptions.maxsize=base.getAttribute("data-fp-option-maxsize")}services=base.getAttribute("data-fp-option-services");if(services){services=services.split(",");for(j=0;j<services.length;j++){services[j]=SERVICES[services[j].replace(" ","")]}fpoptions.services=services}apikey=base.getAttribute("data-fp-apikey");if(apikey){setAPIKey(apikey)}ow.onclick=(function(input,mimetypes,options){return function(){getFile(mimetypes,options,function(data,metadata){var e;if(options.multiple){var urls=[];for(j=0;j<data.length;j++){urls.push(data[j]["url"])}input.value=urls.join();e=createOnChangeEvent(input,data);input.dispatchEvent(e)}else{input.value=data;e=createOnChangeEvent(input,[{url:data,data:metadata}]);input.dispatchEvent(e)}});return false}})(base,mtypes,fpoptions);base.parentNode.insertBefore(ow,base)}};var constructSaveWidgets=function(){var save_base=[];var tmp=document.querySelectorAll("button[data-fp-url]");for(i=0;i<tmp.length;i++){save_base.push(tmp[i])}tmp=document.querySelectorAll("a[data-fp-url]");for(i=0;i<tmp.length;i++){save_base.push(tmp[i])}tmp=document.querySelectorAll('input[type="button"][data-fp-url]');for(i=0;i<tmp.length;i++){save_base.push(tmp[i])}for(i=0;i<save_base.length;i++){base=save_base[i];base.onclick=(function(base){return function(){var mimetype=base.getAttribute("data-fp-mimetype");var url=base.getAttribute("data-fp-url");if(!mimetype||!url){return true}var options={};var container=base.getAttribute("data-fp-option-container");if(container){options.container=container}else{modal=(base.getAttribute("data-fp-option-modal")||"true")!="false";options.container=modal?"modal":"window"}var services=base.getAttribute("data-fp-option-services");if(services){services=services.split(",");for(j=0;j<services.length;j++){services[j]=SERVICES[services[j].replace(" ","")]}options.services=services}apikey=base.getAttribute("data-fp-apikey");if(apikey){setAPIKey(apikey)}saveFileAs(url,mimetype,options);return false}})(base)}};var constructDragWidgets=function(){var drag_widgets=document.querySelectorAll('input[type="filepicker-dragdrop"]');var pane;var i;var j;var base;var ob;var holder;var mtypes;var fpoptions;var apikey;var services;var container;for(i=0;i<drag_widgets.length;i++){base=drag_widgets[i];pane=document.createElement("div");pane.className=base.getAttribute("data-fp-class")||base.className;pane.style.padding="1px";pane.style.display="inline-block";base.setAttribute("type","hidden");base.parentNode.insertBefore(pane,base);ob=document.createElement("button");ob.innerHTML=base.getAttribute("data-fp-button-text")||"Pick File";ob.className=base.getAttribute("data-fp-button-class")||"";pane.appendChild(ob);var odrag=document.createElement("div");setupDragContainer(odrag);var dragWidth=pane.offsetWidth-ob.offsetWidth-20;dragWidth=Math.min(dragWidth,220);odrag.style.width=dragWidth+"px";odrag.innerHTML=base.getAttribute("data-fp-drag-text")||"Or drop files here";odrag.className=base.getAttribute("data-fp-drag-class")||"";pane.appendChild(odrag);mtypes=(base.getAttribute("data-fp-mimetypes")||MIMETYPES.ALL).split(",");fpoptions={};container=base.getAttribute("data-fp-option-container");if(container){fpoptions.container=container}else{modal=(base.getAttribute("data-fp-option-modal")||"true")!="false";fpoptions.container=modal?"modal":"window"}fpoptions.multiple=(base.getAttribute("data-fp-option-multiple")||"false")!="false";fpoptions.persist=(base.getAttribute("data-fp-option-persist")||"false")!="false";fpoptions.mimetypes=mtypes;if(base.getAttribute("data-fp-option-maxsize")){fpoptions.maxsize=base.getAttribute("data-fp-option-maxsize")}services=base.getAttribute("data-fp-option-services");if(services){services=services.split(",");for(j=0;j<services.length;j++){services[j]=SERVICES[services[j].replace(" ","")]}fpoptions.services=services}apikey=base.getAttribute("data-fp-apikey");if(apikey){setAPIKey(apikey)}var dragdrop=(!!window.FileReader||navigator.userAgent.indexOf("Safari")>=0)&&("draggable" in odrag);if(dragdrop){setupDropPane(odrag,fpoptions,base)}else{odrag.innerHTML="&nbsp;"}odrag.onclick=ob.onclick=(function(input,drop,mimetypes,options){return function(){getFile(mimetypes,options,function(data,metadata){var e;if(options.multiple){var urls=[];var filenames=[];for(j=0;j<data.length;j++){urls.push(data[j]["url"]);filenames.push(data[j]["data"]["filename"])}input.value=urls.join();onFilesUploaded(input,drop,filenames.join(", "));e=createOnChangeEvent(input,data);input.dispatchEvent(e)}else{input.value=data;onFilesUploaded(input,drop,metadata.filename);e=createOnChangeEvent(input,[{url:data,data:metadata}]);input.dispatchEvent(e)}});return false}})(base,odrag,mtypes,fpoptions)}};var onFilesUploaded=function(input,odrag,text){odrag.innerHTML=text;odrag.style.width=(odrag.offsetWidth-10)+"px";odrag.style.padding="2px 4px";odrag.style.cursor="default";var cancel=document.createElement("span");cancel.innerHTML="X";cancel.style.borderRadius="8px";cancel.style.fontSize="14px";cancel.style["float"]="right";cancel.style.padding="0 3px";cancel.style.color="#600";cancel.style.cursor="pointer";cancel.onclick=function(e){e.cancelBubble=true;e.stopPropagation();setupDragContainer(odrag);var canDragDrop=(!!window.FileReader||navigator.userAgent.indexOf("Safari")>=0)&&("draggable" in odrag);if(!canDragDrop){odrag.innerHTML="&nbsp;"}else{odrag.innerHTML=input.getAttribute("data-fp-drag-text")||"Or drop files here"}input.value="";var ev=createOnChangeEvent(input);input.dispatchEvent(ev);return false};odrag.appendChild(cancel)};var setupDragContainer=function(odrag){odrag.style.border="1px dashed #AAA";odrag.style.display="inline-block";odrag.style.margin="0 0 0 4px";odrag.style.borderRadius="3px";odrag.style.backgroundColor="#F3F3F3";odrag.style.color="#333";odrag.style.fontSize="14px";odrag.style.lineHeight="22px";odrag.style.padding="2px 4px";odrag.style.verticalAlign="middle";odrag.style.cursor="pointer";odrag.style.overflow="hidden"};var setupDropPane=function(odrag,fpoptions,input){var text=odrag.innerHTML;var pbar;makeDropPane(odrag,{multiple:fpoptions.multiple,persist:fpoptions.persist,maxsize:fpoptions.maxsize,mimetypes:fpoptions.mimetypes,dragEnter:function(){odrag.innerHTML="Drop to upload";odrag.style.backgroundColor="#E0E0E0";odrag.style.border="1px solid #000"},dragLeave:function(){odrag.innerHTML=text;odrag.style.backgroundColor="#F3F3F3";odrag.style.border="1px dashed #AAA"},error:function(type,msg){if(type=="TooManyFiles"){odrag.innerHTML=msg}else{if(type=="WrongType"){odrag.innerHTML=msg}else{if(type=="NoFilesFound"){odrag.innerHTML=msg}else{if(type=="UploadError"){odrag.innerHTML="Oops! Had trouble uploading."}}}}},begin:function(files){pbar=setupProgress(odrag)},progress:function(percentage){if(pbar){pbar.style.width=percentage+"%"}},done:function(data){var vals=[];var filenames=[];for(var i=0;i<data.length;i++){var obj=data[i];vals.push(obj.url);filenames.push(obj.data["filename"])}input.value=vals.join();onFilesUploaded(input,odrag,filenames.join(", "));var e=createOnChangeEvent(input,data);input.dispatchEvent(e)}})};var uploadFileAjax=function(file,success,error,progress){var xhr=new XMLHttpRequest();xhr.upload.addEventListener("progress",progress,false);var filename=file.name||file.fileName;var url=endpoints.tempStorage+filename+"?apikey="+apiKey;data=new FormData();data.append("fileUpload",file);utilities.ajax({xhr:xhr,method:"POST",url:url,json:true,success:success,error:error,processData:false,data:data})};var setupProgress=function(odrag){var pbar=document.createElement("div");var height=odrag.offsetHeight-2;pbar.style.height=height+"px";pbar.style.backgroundColor="#0E90D2";pbar.style.width="2%";pbar.style.borderRadius="3px";odrag.style.padding="0";odrag.style.width=(odrag.offsetWidth+6)+"px";odrag.style.border="1px solid #AAA";odrag.style.backgroundColor="#F3F3F3";odrag.style.boxShadow="inset 0 1px 2px rgba(0, 0, 0, 0.1)";odrag.innerHTML="";odrag.appendChild(pbar);return pbar};var createOnChangeEvent=function(input,files){var e=document.createEvent("Event");e.initEvent("change",true,false);e.eventPhase=2;e.currentTarget=e.srcElement=e.target=input;e.files=files;return e};var chunkedUpload=function(file,success,error,progress){var urls={};urls.startMultipart=BASE_URL+"/api/path/storage/?multipart=start";urls.sendMultipart=BASE_URL+"/api/path/storage/?multipart=upload";urls.finishMultipart=BASE_URL+"/api/path/storage/?multipart=end";var count=0;var chunksizeMB=MAX_CHUNK_SIZE;var total=Math.ceil(file.size/chunksizeMB);var data={name:file.name||file.fileName,size:file.size};utilities.ajax({method:"POST",url:urls.startMultipart,json:true,data:{apikey:apiKey,name:file.name||file.fileName,size:file.size},success:function(response){if(response.result!="ok"){error(response);return}var uploadId=response.id;var onChunkComplete=function(e){count++;progress({loaded:count,total:total,lengthComputable:true});if(count===total){utilities.ajax({method:"POST",url:urls.finishMultipart,data:{id:uploadId,total:total,apikey:apiKey},success:function(resp,xhr){var data={};data.error=resp.error;data.result=resp.result;data.data=resp.data;data.url=resp.data["url"];delete data.data["url"];success(data)},json:true})}};var retries={};var onChunkError=function(index,part){return function(e){if(!retries[index]){retries[index]=0}retries[index]++;if(retries[index]>opts.maxretries){error.call(this)}attemptChunk(index,part)}};var attemptChunk=function(index,part){var url=urls.sendMultipart+"&id="+uploadId+"&index="+index+"&apikey="+apiKey;data=new FormData();data.append("fileUpload",part);utilities.ajax({method:"POST",url:url,json:true,success:onChunkComplete,error:onChunkError(index,part),processData:false,data:data})};var onEach=function(index,part){attemptChunk(index,part)};var i;if(file.mozSlice){for(i=0;i<total;i++){onEach(i,file.mozSlice(i*chunksizeMB,(i+1)*chunksizeMB))}}else{if(file.webkitSlice){for(i=0;i<total;i++){onEach(i,file.webkitSlice(i*chunksizeMB,(i+1)*chunksizeMB))}}else{if(file.slice){var mozilla_version=/(mozilla)(?:.*? rv:([\w.]+))?/;var match=mozilla_version.exec(navigator.userAgent);if(match[2]&&parseInt(match[2],10)>=13){for(i=0;i<total;i++){onEach(i,file.slice(i*chunksizeMB,(i+1)*chunksizeMB))}}else{for(i=0;i<total;i++){onEach(i,file.slice(i*chunksizeMB,chunksizeMB))}}}else{total=1;onEach(0,file)}}}}})};var uploadFileWrapper=function(fileinput,success,failure,progress,retries){retries=retries||MAX_RETRIES;failure=failure||function(){};if(!fileinput.value){throw new FilepickerException("File input is empty")}var ajax_progress=function(e){if(e.lengthComputable){progress(Math.round((e.loaded*95)/e.total))}};var num_tries=0;var ajax_error=function(text){num_tries++;if(num_tries>MAX_RETRIES){failure(text)}else{uploadFileAjax(file,success,error,progress)}};var ajax_success=function(response){if(response.error){ajax_error(response.error);return}progress(100);success(response)}};var makeDropPane=function(div,options){if(!div){throw new FilepickerException("No DOM element found to create drop pane")}if(div.jquery){if(div.length===0){throw new FilepickerException("No DOM element found to create drop pane")}div=div[0]}options=options||{};var dragEnter=options.dragEnter||function(){};var dragLeave=options.dragLeave||function(){};var begin=options.begin||function(){};var done=options.done||function(){};var error=options.error||function(){};var progress=options.progress||function(){};var mimetypes=options.mimetypes||"*/*";div.addEventListener("dragenter",function(e){dragEnter();e.stopPropagation();e.preventDefault();return false},false);div.addEventListener("dragleave",function(e){dragLeave();e.stopPropagation();e.preventDefault();return false},false);div.addEventListener("dragover",function(e){e.preventDefault();return false},false);div.addEventListener("drop",function(e){e.stopPropagation();e.preventDefault();var files=e.dataTransfer.files;if(verifyUpload(files)){begin(files);uploadFiles(files,done,error,progress)}});var verifyUpload=function(files){if(files.length>0){if(files.length>1&&!options.multiple){error("TooManyFiles","Only one file at a time");return false}var found;var file;for(var i=0;i<files.length;i++){found=false;file=files[i];for(var j=0;j<mimetypes.length;j++){found=found||utilities.matchesMimetype(file.type,mimetypes[j])}if(!found){error("WrongType",(file.name||file.fileName)+" isn't the right type of file");break}}if(found){return true}}else{error("NoFilesFound","No files uploaded")}return false}};var uploadFiles=function(files,done,error,progressFn){var progresses={};var finished=0;var out=[];var updateProgress=function(){var total=0;for(i in progresses){total+=progresses[i]}percentage=total/files.length;progressFn(percentage)};var getProgressUpdateFn=function(i){return function(progress){progresses[i]=progress;updateProgress()}};var getOnDoneFn=function(i){return function(response){var filename=files[i].name||files[i].fileName;var size=files[i].size;var type=files[i].type;out=out||[];fileitem={url:response.url,data:{filename:filename,size:size,type:type}};if(response.data&&response.data.key){fileitem.data.key=response.data.key}out.push(fileitem);finished++;if(finished>=files.length){done(out)}}};for(var i=0;i<files.length;i++){uploadSingleFile(files[i],getOnDoneFn(i),error,getProgressUpdateFn(i))}};var uploadSingleFile=function(file,done,error,updateProgress){var progress=function(e){if(e.lengthComputable){updateProgress(Math.round((e.loaded*95)/e.total))}};var filename=file.name||file.fileName;var retries=0;var onError=function(text){retries++;if(retries>MAX_RETRIES){error("UploadError")}else{uploadFileAjax(file,success,error,progress)}};var onSuccess=function(response){if(response.error){onError(response.error);return}updateProgress(100);done(response)};var canSlice=!!(file.mozSlice||file.webkitSlice||file.slice);if(file.size>MAX_CHUNK_SIZE&&canSlice){chunkedUpload(file,onSuccess,onError,progress)}else{uploadFileAjax(file,onSuccess,onError,progress)}};var defaultTo=function(map,key,def){if(map[key]===undefined){return def}return map[key]};if(document.querySelectorAll){var func=function(){constructOpenWidgets();constructSaveWidgets();constructDragWidgets()};utilities.addOnLoad(func)}return{closeModal:closeModal,uploadFile:uploadFileWrapper,makeDropPane:makeDropPane,getFile:getFile,saveAs:saveFileAs,MIMETYPES:MIMETYPES,SERVICES:SERVICES,setKey:setAPIKey,getUrlFromData:getUrlFromData,revokeFile:revokeFile,getContents:getContents,_oci:openCommIframe}})();function since(a){return moment.duration(moment(a).diff(Date.now())).humanize()}function truncate(b,c){if(b.length<c){return b}var a=b.substr(0,c-3);a=a.substr(0,a.lastIndexOf(" "));return a+"..."}(function(){var g={login:function(u,v){var t=function(){if(!u.find("button").hasClass("disabled")){u.find("button").addClass("disabled").text("Signing in...");v.login(u.find(".user").val(),u.find(".password").val(),null,function(){u.find("button").removeClass("disabled").text("Sign in");u.find("label").html("Invalid login or password.")})}};u.keypress(function(w){if(w.which===13){t();return false}});u.find("button").click(t)},register:function(t,v){var u=function(){if(!t.find("button").hasClass("disabled")){t.find("button").addClass("disabled").text("Signing up...");v.register({name:t.find(".name").val(),email:t.find(".email").val(),password:t.find(".password").val()},null,function(w){t.find("button").removeClass("disabled").text("Sign up");t.find("label").html("An error occurred.")})}};t.keypress(function(w){if(w.which===13){u();return false}});t.find("button").click(u)},"register-2":function(t,v){var u=function(){if(!t.find("button").hasClass("disabled")){t.find("button").addClass("disabled").text("Submitting...");$.ajax({type:"PUT",url:"/users/"+v.get("userId"),data:{username:t.find(".username").val()},success:function(){var w=function(x){if(typeof x.get("username")!=="undefined"){window.location="/#/"}v.off("loaded",w)};v.on("loaded",w);v.loadUser()}})}};t.keypress(function(w){if(w.which===13){u();return false}});t.keyup(function(w){$.ajax({url:"/users/exists",data:{username:t.find(".username").val()},type:"PUT",error:function(x){t.find("label").html("");t.find("button").removeClass("disabled")},success:function(x){t.find("label").html("That username is not available.");t.find("button").addClass("disabled")}})});t.find("button").click(u)},actions:function(u,t){u.find(".like").click(function(x){var w=_.clone(t.model.get("stats"));w.likes++;var v=_.clone(t.model.get("likes"));v.push(t.session.get("user").get("person"));t.model.set({stats:w,likes:v});$.ajax({url:"/outfits/"+t.model.get("_id")+"/likes",success:function(y){t.model.fetch()}.bind(this),type:"POST"});x.preventDefault();return false}.bind(this));u.find(".unlike").click(function(x){var w=_.clone(t.model.get("stats"));w.likes--;var v=_.reject(_.clone(t.model.get("likes")),function(y){return y._id===t.session.get("userId")});t.model.set({stats:w,likes:v});$.ajax({url:"/outfits/"+t.model.get("_id")+"/likes",success:function(y){t.model.fetch()}.bind(this),type:"DELETE"});x.preventDefault();return false}.bind(this));u.find(".repost").click(function(w){var v=_.clone(t.model.get("stats"));v.reposts++;var x=_.clone(t.model.get("reposts"));x.push(t.session.get("user").get("person"));t.model.set({stats:v,reposts:x});$.ajax({url:"/outfits/"+t.model.get("_id"),success:function(y){t.model.fetch()}.bind(this),type:"POST"});w.preventDefault();return false})},"scroll-up":function(t){t.click(function(){$("html, body").animate({scrollTop:"0"},800)})},comment:function(u,t){var v=function(){var w=u.find(".body").val();if(w.length>0){var x=_.clone(t.model.get("comments"));x.push({author:t.session.get("user").get("person"),date:Date.now(),body:w});t.model.set("comments",x);$.ajax({url:"/outfits/"+t.model.get("_id")+"/comments",data:{body:w},success:function(y){t.model.fetch()}.bind(this),type:"POST"});u.find(".body").val("")}};u.find("button").click(v);u.keypress(function(w){if(w.which===13&&!w.shiftKey){v();return false}})},post:function(u,t){u.find("button.next").click(function(){if(!$(this).hasClass("disabled")){$(this).addClass("disabled");t.view.forward()}});u.find("button.back").click(function(){if(!$(this).hasClass("disabled")){$(this).addClass("disabled");t.view.back()}});u.find("button.submit").click(function(){if(!$(this).hasClass("disabled")){$(this).addClass("disabled").text("Posting outfit...");t.model.save(null,{success:function(){window.location="/#/"}})}})},"post-0":function(u,t){setTimeout(function(){filepicker.getFile("image/*",{multiple:false,container:"filepicker-iframe",services:[filepicker.SERVICES.COMPUTER,filepicker.SERVICES.WEBCAM,filepicker.SERVICES.FACEBOOK],persist:true},function(v){t.model.set("image",v);u.find("button.next").removeClass("disabled")})},0)},"post-1":function(u,t){var v=u.find("button.next");v.click(function(){t.model.set("caption",u.find("textarea").val())});u.find("textarea").keyup(function(w){if($(this).val().length>0){v.removeClass("disabled")}else{v.addClass("disabled")}})},"post-2":function(u,t){}};var n=function(v,u){var t=v.find('[class^="form-"], [class*="form-"]');t.each(function(x,y){var w=$(y);for(var z in g){if(w.hasClass("form-"+z)){g[z](w,u)}}})};var l=Backbone.Model.extend({initialize:function(){_.bindAll(this,"url")},idAttribute:"_id",collectionPath:"",url:function(){return"/"+this.collectionPath+"/"+(this.id||"")}});var m=l.extend({collectionPath:"users",defaults:{_id:"",date:Date.now()}});var k=l.extend({collectionPath:"outfits",defaults:{caption:""},likedBy:function(u){var t=this.get("likes");return !t.every(function(v){if(v._id===u){return false}return true})},repostedBy:function(u){var t=this.get("reposts");return !t.every(function(v){if(v._id===u){return false}return true})}});var h=Backbone.Model.extend({initialize:function(t){_.bindAll(this,"loggedIn","loadUser","login","register","toJSON");this.loadUser()},loggedIn:function(){return Boolean(this.get("userId"))},loadUser:function(){var t=this;$.ajax({url:"/auth/info",success:function(u){u.person={_id:u._id,name:u.name,username:u.username,avatar:u.avatar};t.set("userId",u._id);t.set("user",new m(u));t.trigger("loaded",t.get("user"));if(!u.username){window.location="/#/register"}},error:function(){t.set("userId",null);t.set("user",null);t.trigger("loaded",null)}})},login:function(t,v,x,u){var w=this;$.ajax("/auth",{type:"POST",data:{user:t,password:v},success:function(y){y.person={_id:y._id,name:y.name,username:y.username,avatar:y.avatar};w.set("userId",y._id);w.set("user",new m(y));if(typeof y.username!=="undefined"){window.location="/#/"}else{window.location="/#/register"}if(x){x(y)}},error:function(y){w.set("userId",null);w.set("user",null);if(u){u(y)}}})},register:function(v,w,t){var u=this;$.ajax("/users",{type:"POST",data:v}).success(function(x){x.person={_id:x._id,name:x.name,username:x.username,avatar:x.avatar};u.set("userId",x._id);u.set("user",new m(x));if(w){w(x)}}).error(function(x){if(t){t(x)}})},toJSON:function(){var t=_.clone(this.attributes);t.loggedIn=this.loggedIn;if(t.user){t.user=t.user.toJSON()}return t}});var q=Backbone.Collection.extend({model:k,url:"/outfits"});var r=Torso.View.extend({tagName:"li",className:"box outfit summary hover-parent",template:_.template($("#template-outfit-summary").html()),initialize:function(t){_.bindAll(this,"setup","render");this.model.on("change",this.render);this.session=t.session;this.render()},setup:function(){n(this.$el,{model:this.model,session:this.session})}});var s=Torso.View.extend({tagName:"li",className:"box user summary hover-parent span4",template:_.template($("#template-user-summary").html()),initialize:function(){_.bindAll(this,"setup","render");this.model.on("change",this.render);this.render()}});var f=Torso.Screen.extend({className:"box span5 centered",template:_.template($("#template-login").html()),initialize:function(t){_.bindAll(this,"setup","render");this.session=t.session;this.render(t)},setup:function(){n(this.$el,this.session)}});var b=Torso.Screen.extend({className:"container-fluid",template:_.template($("#template-navbar").html()),initialize:function(t){_.bindAll(this,"setup","render");this.session=t.session;this.session.on("change:user",this.render);this.render(t)},setup:function(){this.$el.find(".login").click(function(){return false});n(this.$el,this.session);return this}});var p=Torso.Screen.extend({className:"box span6 centered",template:_.template($("#template-register").html()),initialize:function(t){_.bindAll(this,"setup","render");this.session=t.session;this.session.on("change:user",this.render);this.render(t)},setup:function(){n(this.$el,this.session)}});var a=Torso.Screen.extend({className:"box span6 centered",template:_.template($("#template-link").html()),setup:function(){n(this.$el,this.session)}});var e=Torso.Screen.extend({className:"box centered outfit span6",template:_.template($("#template-outfit").html()),modal:true,initialize:function(t){_.bindAll(this,"setup","render");this.session=t.session;this.model=new k({_id:t.args[0]});this.model.bind("change",this.render);this.model.fetch()},setup:function(){n(this.$el,{session:this.session,model:this.model});this.$el.find('[rel="tooltip"]').tooltip()}});var o=Torso.Screen.extend({className:"",template:_.template($("#template-feed").html()),initialize:function(t){_.bindAll(this,"setup","render","loadNextPage");this.session=t.session;this.page=-1;this.pageSize=12;this.initialized=false;this.collection=new q();this.loadNextPage()},render:function(){if(!this.initialized){this.$el.html(this.template())}this.collection.each(function(v,u){if(u<this.page*this.pageSize){return}var t=new r({model:v,session:this.session});this.$el.find(".outfits").append(t.$el)}.bind(this));this.$el.find("div.more").removeClass("loading").find("span").html("Load more posts");if(!this.initialized){this.initialized=true;this.setup()}},setup:function(){n(this.$el,this.session);$(window).on("scrollBottom",function(u){this.loadNextPage()}.bind(this)).on("scrollDown",function(u){this.$el.find(".scroll-up").removeClass("collapsed-horizontal")}.bind(this)).on("scrollTop",function(u){this.$el.find(".scroll-up").addClass("collapsed-horizontal")}.bind(this));var t=this.$el.find("div.more");t.click(function(u){if(!t.hasClass("loading")){this.loadNextPage()}}.bind(this))},loadNextPage:function(){this.page++;this.collection.fetch({add:true,success:this.render,data:{limit:this.pageSize,skip:this.page*this.pageSize}});this.$el.find("div.more").addClass("loading").find("span").html("Loading more posts...")}});var c=Torso.Screen.extend({className:"box centered span10 post",template:_.template($("#template-post").html()),initialize:function(t){_.bindAll(this,"setup","render","back","forward");this.session=t.session;this.page=-1;this.model=new k({author:this.session.get("user").get("person")});this.forward()},setup:function(){n(this.$el,{session:this.session,model:this.model,view:this})},back:function(){this.page--;this.render()},forward:function(){this.page++;this.render()}});$(function(){filepicker.setKey("A6D_8Iy0zQe2YTFBlSOA5z");var x=false,v=false,y=false,u=250;$(window).scroll(function(A){var z=$(window);if(z.scrollTop()+z.innerHeight()+200>A.target.height){if(!x){x=true;z.trigger("scrollBottom",A)}}else{x=false}if(z.scrollTop()>u){if(!y){y=true;z.trigger("scrollDown",A)}}else{y=false}if(z.scrollTop()<u){if(!v){v=true;z.trigger("scrollTop",A)}}else{v=false}});var w=new Torso.App({session:new h(),containers:{navbar:$("#navbar"),main:$("#main"),modal:$("#overlay")},screens:{login:f,register:p,link:a,outfit:e,feed:o,post:c},defaults:{navbar:b}});w.on("display:modal",function(z){$("#main").css("position","fixed");$("#overlay").click(function(A){if(A.target==document.getElementById("overlay")){window.history.back()}});$(window).keydown(function(A){if(A.which===27){window.history.back()}})});w.on("display:main",function(z){$("#main").css("position","static")});var t=function(){var z=new Torso.Router({app:w,routes:{login:"login",register:"register","link/:service":"link","user/:id":"user","@:id":"user","outfit/:id":"outfit","/":"feed","":"feed",post:"post","*_":"404"}});w.session.off("loaded",t)};w.session.on("loaded",t)})})();