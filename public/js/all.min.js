!function(a){a(function(){a.support.transition=(function(){var b=(function(){var e=document.createElement("bootstrap"),d={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"},c;for(c in d){if(e.style[c]!==undefined){return d[c]}}}());return b&&{end:b}})()})}(window.jQuery);!function(d){var b='[data-toggle="dropdown"]',a=function(f){var e=d(f).on("click.dropdown.data-api",this.toggle);d("html").on("click.dropdown.data-api",function(){e.parent().removeClass("open")})};a.prototype={constructor:a,toggle:function(j){var i=d(this),h,f,g;if(i.is(".disabled, :disabled")){return}f=i.attr("data-target");if(!f){f=i.attr("href");f=f&&f.replace(/.*(?=#[^\s]*$)/,"")}h=d(f);h.length||(h=i.parent());g=h.hasClass("open");c();if(!g){h.toggleClass("open")}return false}};function c(){d(b).parent().removeClass("open")}d.fn.dropdown=function(e){return this.each(function(){var g=d(this),f=g.data("dropdown");if(!f){g.data("dropdown",(f=new a(this)))}if(typeof e=="string"){f[e].call(g)}})};d.fn.dropdown.Constructor=a;d(function(){d("html").on("click.dropdown.data-api",c);d("body").on("click.dropdown",".dropdown form",function(f){f.stopPropagation()}).on("click.dropdown.data-api",b,a.prototype.toggle)})}(window.jQuery);!function(b){var a=function(d,c){this.init("tooltip",d,c)};a.prototype={constructor:a,init:function(f,e,d){var g,c;this.type=f;this.$element=b(e);this.options=this.getOptions(d);this.enabled=true;if(this.options.trigger!="manual"){g=this.options.trigger=="hover"?"mouseenter":"focus";c=this.options.trigger=="hover"?"mouseleave":"blur";this.$element.on(g,this.options.selector,b.proxy(this.enter,this));this.$element.on(c,this.options.selector,b.proxy(this.leave,this))}this.options.selector?(this._options=b.extend({},this.options,{trigger:"manual",selector:""})):this.fixTitle()},getOptions:function(c){c=b.extend({},b.fn[this.type].defaults,c,this.$element.data());if(c.delay&&typeof c.delay=="number"){c.delay={show:c.delay,hide:c.delay}}return c},enter:function(d){var c=b(d.currentTarget)[this.type](this._options).data(this.type);if(!c.options.delay||!c.options.delay.show){return c.show()}clearTimeout(this.timeout);c.hoverState="in";this.timeout=setTimeout(function(){if(c.hoverState=="in"){c.show()}},c.options.delay.show)},leave:function(d){var c=b(d.currentTarget)[this.type](this._options).data(this.type);if(!c.options.delay||!c.options.delay.hide){return c.hide()}clearTimeout(this.timeout);c.hoverState="out";this.timeout=setTimeout(function(){if(c.hoverState=="out"){c.hide()}},c.options.delay.hide)},show:function(){var g,c,i,e,h,d,f;if(this.hasContent()&&this.enabled){g=this.tip();this.setContent();if(this.options.animation){g.addClass("fade")}d=typeof this.options.placement=="function"?this.options.placement.call(this,g[0],this.$element[0]):this.options.placement;c=/in/.test(d);g.remove().css({top:0,left:0,display:"block"}).appendTo(c?this.$element:document.body);i=this.getPosition(c);e=g[0].offsetWidth;h=g[0].offsetHeight;switch(c?d.split(" ")[1]:d){case"bottom":f={top:i.top+i.height,left:i.left+i.width/2-e/2};break;case"top":f={top:i.top-h,left:i.left+i.width/2-e/2};break;case"left":f={top:i.top+i.height/2-h/2,left:i.left-e};break;case"right":f={top:i.top+i.height/2-h/2,left:i.left+i.width};break}g.css(f).addClass(d).addClass("in")}},isHTML:function(c){return typeof c!="string"||(c.charAt(0)==="<"&&c.charAt(c.length-1)===">"&&c.length>=3)||/^(?:[^<]*<[\w\W]+>[^>]*$)/.exec(c)},setContent:function(){var d=this.tip(),c=this.getTitle();d.find(".tooltip-inner")[this.isHTML(c)?"html":"text"](c);d.removeClass("fade in top bottom left right")},hide:function(){var c=this,d=this.tip();d.removeClass("in");function e(){var f=setTimeout(function(){d.off(b.support.transition.end).remove()},500);d.one(b.support.transition.end,function(){clearTimeout(f);d.remove()})}b.support.transition&&this.$tip.hasClass("fade")?e():d.remove()},fixTitle:function(){var c=this.$element;if(c.attr("title")||typeof(c.attr("data-original-title"))!="string"){c.attr("data-original-title",c.attr("title")||"").removeAttr("title")}},hasContent:function(){return this.getTitle()},getPosition:function(c){return b.extend({},(c?{top:0,left:0}:this.$element.offset()),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight})},getTitle:function(){var e,c=this.$element,d=this.options;e=c.attr("data-original-title")||(typeof d.title=="function"?d.title.call(c[0]):d.title);return e},tip:function(){return this.$tip=this.$tip||b(this.options.template)},validate:function(){if(!this.$element[0].parentNode){this.hide();this.$element=null;this.options=null}},enable:function(){this.enabled=true},disable:function(){this.enabled=false},toggleEnabled:function(){this.enabled=!this.enabled},toggle:function(){this[this.tip().hasClass("in")?"hide":"show"]()}};b.fn.tooltip=function(c){return this.each(function(){var f=b(this),e=f.data("tooltip"),d=typeof c=="object"&&c;if(!e){f.data("tooltip",(e=new a(this,d)))}if(typeof c=="string"){e[c]()}})};b.fn.tooltip.Constructor=a;b.fn.tooltip.defaults={animation:true,placement:"top",selector:false,template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover",title:"",delay:0}}(window.jQuery);!function(c){var b='[data-dismiss="alert"]',a=function(d){c(d).on("click",b,this.close)};a.prototype.close=function(i){var h=c(this),f=h.attr("data-target"),g;if(!f){f=h.attr("href");f=f&&f.replace(/.*(?=#[^\s]*$)/,"")}g=c(f);i&&i.preventDefault();g.length||(g=h.hasClass("alert")?h:h.parent());g.trigger(i=c.Event("close"));if(i.isDefaultPrevented()){return}g.removeClass("in");function d(){g.trigger("closed").remove()}c.support.transition&&g.hasClass("fade")?g.on(c.support.transition.end,d):d()};c.fn.alert=function(d){return this.each(function(){var f=c(this),e=f.data("alert");if(!e){f.data("alert",(e=new a(this)))}if(typeof d=="string"){e[d].call(f)}})};c.fn.alert.Constructor=a;c(function(){c("body").on("click.alert.data-api",b,a.prototype.close)})}(window.jQuery);!function(b){var a=function(d,c){this.$element=b(d);this.options=b.extend({},b.fn.button.defaults,c)};a.prototype.setState=function(f){var h="disabled",c=this.$element,e=c.data(),g=c.is("input")?"val":"html";f=f+"Text";e.resetText||c.data("resetText",c[g]());c[g](e[f]||this.options[f]);setTimeout(function(){f=="loadingText"?c.addClass(h).attr(h,h):c.removeClass(h).removeAttr(h)},0)};a.prototype.toggle=function(){var c=this.$element.parent('[data-toggle="buttons-radio"]');c&&c.find(".active").removeClass("active");this.$element.toggleClass("active")};b.fn.button=function(c){return this.each(function(){var f=b(this),e=f.data("button"),d=typeof c=="object"&&c;if(!e){f.data("button",(e=new a(this,d)))}if(c=="toggle"){e.toggle()}else{if(c){e.setState(c)}}})};b.fn.button.defaults={loadingText:"loading..."};b.fn.button.Constructor=a;b(function(){b("body").on("click.button.data-api","[data-toggle^=button]",function(d){var c=b(d.target);if(!c.hasClass("btn")){c=c.closest(".btn")}c.button("toggle")})})}(window.jQuery);!function(a){var b=function(d,c){this.$element=a(d);this.options=a.extend({},a.fn.collapse.defaults,c);if(this.options.parent){this.$parent=a(this.options.parent)}this.options.toggle&&this.toggle()};b.prototype={constructor:b,dimension:function(){var c=this.$element.hasClass("width");return c?"width":"height"},show:function(){var f,c,e,d;if(this.transitioning){return}f=this.dimension();c=a.camelCase(["scroll",f].join("-"));e=this.$parent&&this.$parent.find("> .accordion-group > .in");if(e&&e.length){d=e.data("collapse");if(d&&d.transitioning){return}e.collapse("hide");d||e.data("collapse",null)}this.$element[f](0);this.transition("addClass",a.Event("show"),"shown");this.$element[f](this.$element[0][c])},hide:function(){var c;if(this.transitioning){return}c=this.dimension();this.reset(this.$element[c]());this.transition("removeClass",a.Event("hide"),"hidden");this.$element[c](0)},reset:function(c){var d=this.dimension();this.$element.removeClass("collapse")[d](c||"auto")[0].offsetWidth;this.$element[c!==null?"addClass":"removeClass"]("collapse");return this},transition:function(g,d,e){var f=this,c=function(){if(d.type=="show"){f.reset()}f.transitioning=0;f.$element.trigger(e)};this.$element.trigger(d);if(d.isDefaultPrevented()){return}this.transitioning=1;this.$element[g]("in");a.support.transition&&this.$element.hasClass("collapse")?this.$element.one(a.support.transition.end,c):c()},toggle:function(){this[this.$element.hasClass("in")?"hide":"show"]()}};a.fn.collapse=function(c){return this.each(function(){var f=a(this),e=f.data("collapse"),d=typeof c=="object"&&c;if(!e){f.data("collapse",(e=new b(this,d)))}if(typeof c=="string"){e[c]()}})};a.fn.collapse.defaults={toggle:true};a.fn.collapse.Constructor=b;a(function(){a("body").on("click.collapse.data-api","[data-toggle=collapse]",function(h){var g=a(this),c,f=g.attr("data-target")||h.preventDefault()||(c=g.attr("href"))&&c.replace(/.*(?=#[^\s]+$)/,""),d=a(f).data("collapse")?"toggle":g.data();a(f).collapse(d)})})}(window.jQuery);!function(b){var a=function(d,c){this.init("tooltip",d,c)};a.prototype={constructor:a,init:function(f,e,d){var g,c;this.type=f;this.$element=b(e);this.options=this.getOptions(d);this.enabled=true;if(this.options.trigger!="manual"){g=this.options.trigger=="hover"?"mouseenter":"focus";c=this.options.trigger=="hover"?"mouseleave":"blur";this.$element.on(g,this.options.selector,b.proxy(this.enter,this));this.$element.on(c,this.options.selector,b.proxy(this.leave,this))}this.options.selector?(this._options=b.extend({},this.options,{trigger:"manual",selector:""})):this.fixTitle()},getOptions:function(c){c=b.extend({},b.fn[this.type].defaults,c,this.$element.data());if(c.delay&&typeof c.delay=="number"){c.delay={show:c.delay,hide:c.delay}}return c},enter:function(d){var c=b(d.currentTarget)[this.type](this._options).data(this.type);if(!c.options.delay||!c.options.delay.show){return c.show()}clearTimeout(this.timeout);c.hoverState="in";this.timeout=setTimeout(function(){if(c.hoverState=="in"){c.show()}},c.options.delay.show)},leave:function(d){var c=b(d.currentTarget)[this.type](this._options).data(this.type);if(this.timeout){clearTimeout(this.timeout)}if(!c.options.delay||!c.options.delay.hide){return c.hide()}c.hoverState="out";this.timeout=setTimeout(function(){if(c.hoverState=="out"){c.hide()}},c.options.delay.hide)},show:function(){var g,c,i,e,h,d,f;if(this.hasContent()&&this.enabled){g=this.tip();this.setContent();if(this.options.animation){g.addClass("fade")}d=typeof this.options.placement=="function"?this.options.placement.call(this,g[0],this.$element[0]):this.options.placement;c=/in/.test(d);g.remove().css({top:0,left:0,display:"block"}).appendTo(c?this.$element:document.body);i=this.getPosition(c);e=g[0].offsetWidth;h=g[0].offsetHeight;switch(c?d.split(" ")[1]:d){case"bottom":f={top:i.top+i.height,left:i.left+i.width/2-e/2};break;case"top":f={top:i.top-h,left:i.left+i.width/2-e/2};break;case"left":f={top:i.top+i.height/2-h/2,left:i.left-e};break;case"right":f={top:i.top+i.height/2-h/2,left:i.left+i.width};break}g.css(f).addClass(d).addClass("in")}},isHTML:function(c){return typeof c!="string"||(c.charAt(0)==="<"&&c.charAt(c.length-1)===">"&&c.length>=3)||/^(?:[^<]*<[\w\W]+>[^>]*$)/.exec(c)},setContent:function(){var d=this.tip(),c=this.getTitle();d.find(".tooltip-inner")[this.isHTML(c)?"html":"text"](c);d.removeClass("fade in top bottom left right")},hide:function(){var c=this,d=this.tip();d.removeClass("in");function e(){var f=setTimeout(function(){d.off(b.support.transition.end).remove()},500);d.one(b.support.transition.end,function(){clearTimeout(f);d.remove()})}b.support.transition&&this.$tip.hasClass("fade")?e():d.remove()},fixTitle:function(){var c=this.$element;if(c.attr("title")||typeof(c.attr("data-original-title"))!="string"){c.attr("data-original-title",c.attr("title")||"").removeAttr("title")}},hasContent:function(){return this.getTitle()},getPosition:function(c){return b.extend({},(c?{top:0,left:0}:this.$element.offset()),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight})},getTitle:function(){var e,c=this.$element,d=this.options;e=c.attr("data-original-title")||(typeof d.title=="function"?d.title.call(c[0]):d.title);return e},tip:function(){return this.$tip=this.$tip||b(this.options.template)},validate:function(){if(!this.$element[0].parentNode){this.hide();this.$element=null;this.options=null}},enable:function(){this.enabled=true},disable:function(){this.enabled=false},toggleEnabled:function(){this.enabled=!this.enabled},toggle:function(){this[this.tip().hasClass("in")?"hide":"show"]()}};b.fn.tooltip=function(c){return this.each(function(){var f=b(this),e=f.data("tooltip"),d=typeof c=="object"&&c;if(!e){f.data("tooltip",(e=new a(this,d)))}if(typeof c=="string"){e[c]()}})};b.fn.tooltip.Constructor=a;b.fn.tooltip.defaults={animation:true,placement:"top",selector:false,template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover",title:"",delay:0}}(window.jQuery);(function(){var v=this;var j=v._;var D={};var C=Array.prototype,f=Object.prototype,q=Function.prototype;var m=C.slice,z=C.unshift,c=f.toString,h=f.hasOwnProperty;var L=C.forEach,o=C.map,E=C.reduce,b=C.reduceRight,a=C.filter,A=C.every,n=C.some,l=C.indexOf,k=C.lastIndexOf,s=Array.isArray,e=Object.keys,F=q.bind;var M=function(p){return new t(p)};if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=M}exports._=M}else{v._=M}M.VERSION="1.3.3";var I=M.each=M.forEach=function(R,Q,P){if(R==null){return}if(L&&R.forEach===L){R.forEach(Q,P)}else{if(R.length===+R.length){for(var O=0,p=R.length;O<p;O++){if(O in R&&Q.call(P,R[O],O,R)===D){return}}}else{for(var N in R){if(M.has(R,N)){if(Q.call(P,R[N],N,R)===D){return}}}}}};M.map=M.collect=function(P,O,N){var p=[];if(P==null){return p}if(o&&P.map===o){return P.map(O,N)}I(P,function(S,Q,R){p[p.length]=O.call(N,S,Q,R)});if(P.length===+P.length){p.length=P.length}return p};M.reduce=M.foldl=M.inject=function(Q,P,p,O){var N=arguments.length>2;if(Q==null){Q=[]}if(E&&Q.reduce===E){if(O){P=M.bind(P,O)}return N?Q.reduce(P,p):Q.reduce(P)}I(Q,function(T,R,S){if(!N){p=T;N=true}else{p=P.call(O,p,T,R,S)}});if(!N){throw new TypeError("Reduce of empty array with no initial value")}return p};M.reduceRight=M.foldr=function(Q,P,p,O){var N=arguments.length>2;if(Q==null){Q=[]}if(b&&Q.reduceRight===b){if(O){P=M.bind(P,O)}return N?Q.reduceRight(P,p):Q.reduceRight(P)}var R=M.toArray(Q).reverse();if(O&&!N){P=M.bind(P,O)}return N?M.reduce(R,P,p,O):M.reduce(R,P)};M.find=M.detect=function(P,O,N){var p;y(P,function(S,Q,R){if(O.call(N,S,Q,R)){p=S;return true}});return p};M.filter=M.select=function(P,O,N){var p=[];if(P==null){return p}if(a&&P.filter===a){return P.filter(O,N)}I(P,function(S,Q,R){if(O.call(N,S,Q,R)){p[p.length]=S}});return p};M.reject=function(P,O,N){var p=[];if(P==null){return p}I(P,function(S,Q,R){if(!O.call(N,S,Q,R)){p[p.length]=S}});return p};M.every=M.all=function(P,O,N){var p=true;if(P==null){return p}if(A&&P.every===A){return P.every(O,N)}I(P,function(S,Q,R){if(!(p=p&&O.call(N,S,Q,R))){return D}});return !!p};var y=M.some=M.any=function(P,O,N){O||(O=M.identity);var p=false;if(P==null){return p}if(n&&P.some===n){return P.some(O,N)}I(P,function(S,Q,R){if(p||(p=O.call(N,S,Q,R))){return D}});return !!p};M.include=M.contains=function(O,N){var p=false;if(O==null){return p}if(l&&O.indexOf===l){return O.indexOf(N)!=-1}p=y(O,function(P){return P===N});return p};M.invoke=function(N,O){var p=m.call(arguments,2);return M.map(N,function(P){return(M.isFunction(O)?O||P:P[O]).apply(P,p)})};M.pluck=function(N,p){return M.map(N,function(O){return O[p]})};M.max=function(P,O,N){if(!O&&M.isArray(P)&&P[0]===+P[0]){return Math.max.apply(Math,P)}if(!O&&M.isEmpty(P)){return -Infinity}var p={computed:-Infinity};I(P,function(T,Q,S){var R=O?O.call(N,T,Q,S):T;R>=p.computed&&(p={value:T,computed:R})});return p.value};M.min=function(P,O,N){if(!O&&M.isArray(P)&&P[0]===+P[0]){return Math.min.apply(Math,P)}if(!O&&M.isEmpty(P)){return Infinity}var p={computed:Infinity};I(P,function(T,Q,S){var R=O?O.call(N,T,Q,S):T;R<p.computed&&(p={value:T,computed:R})});return p.value};M.shuffle=function(O){var p=[],N;I(O,function(R,P,Q){N=Math.floor(Math.random()*(P+1));p[P]=p[N];p[N]=R});return p};M.sortBy=function(O,P,p){var N=M.isFunction(P)?P:function(Q){return Q[P]};return M.pluck(M.map(O,function(S,Q,R){return{value:S,criteria:N.call(p,S,Q,R)}}).sort(function(T,S){var R=T.criteria,Q=S.criteria;if(R===void 0){return 1}if(Q===void 0){return -1}return R<Q?-1:R>Q?1:0}),"value")};M.groupBy=function(O,P){var p={};var N=M.isFunction(P)?P:function(Q){return Q[P]};I(O,function(S,Q){var R=N(S,Q);(p[R]||(p[R]=[])).push(S)});return p};M.sortedIndex=function(R,Q,O){O||(O=M.identity);var p=0,P=R.length;while(p<P){var N=(p+P)>>1;O(R[N])<O(Q)?p=N+1:P=N}return p};M.toArray=function(p){if(!p){return[]}if(M.isArray(p)){return m.call(p)}if(M.isArguments(p)){return m.call(p)}if(p.toArray&&M.isFunction(p.toArray)){return p.toArray()}return M.values(p)};M.size=function(p){return M.isArray(p)?p.length:M.keys(p).length};M.first=M.head=M.take=function(O,N,p){return(N!=null)&&!p?m.call(O,0,N):O[0]};M.initial=function(O,N,p){return m.call(O,0,O.length-((N==null)||p?1:N))};M.last=function(O,N,p){if((N!=null)&&!p){return m.call(O,Math.max(O.length-N,0))}else{return O[O.length-1]}};M.rest=M.tail=function(O,p,N){return m.call(O,(p==null)||N?1:p)};M.compact=function(p){return M.filter(p,function(N){return !!N})};M.flatten=function(N,p){return M.reduce(N,function(O,P){if(M.isArray(P)){return O.concat(p?P:M.flatten(P))}O[O.length]=P;return O},[])};M.without=function(p){return M.difference(p,m.call(arguments,1))};M.uniq=M.unique=function(Q,P,O){var p=O?M.map(Q,O):Q;var N=[];if(Q.length<3){P=true}M.reduce(p,function(R,T,S){if(P?M.last(R)!==T||!R.length:!M.include(R,T)){R.push(T);N.push(Q[S])}return R},[]);return N};M.union=function(){return M.uniq(M.flatten(arguments,true))};M.intersection=M.intersect=function(N){var p=m.call(arguments,1);return M.filter(M.uniq(N),function(O){return M.every(p,function(P){return M.indexOf(P,O)>=0})})};M.difference=function(N){var p=M.flatten(m.call(arguments,1),true);return M.filter(N,function(O){return !M.include(p,O)})};M.zip=function(){var p=m.call(arguments);var P=M.max(M.pluck(p,"length"));var O=new Array(P);for(var N=0;N<P;N++){O[N]=M.pluck(p,""+N)}return O};M.indexOf=function(Q,O,P){if(Q==null){return -1}var N,p;if(P){N=M.sortedIndex(Q,O);return Q[N]===O?N:-1}if(l&&Q.indexOf===l){return Q.indexOf(O)}for(N=0,p=Q.length;N<p;N++){if(N in Q&&Q[N]===O){return N}}return -1};M.lastIndexOf=function(O,N){if(O==null){return -1}if(k&&O.lastIndexOf===k){return O.lastIndexOf(N)}var p=O.length;while(p--){if(p in O&&O[p]===N){return p}}return -1};M.range=function(R,P,Q){if(arguments.length<=1){P=R||0;R=0}Q=arguments[2]||1;var N=Math.max(Math.ceil((P-R)/Q),0);var p=0;var O=new Array(N);while(p<N){O[p++]=R;R+=Q}return O};var G=function(){};M.bind=function d(P,N){var O,p;if(P.bind===F&&F){return F.apply(P,m.call(arguments,1))}if(!M.isFunction(P)){throw new TypeError}p=m.call(arguments,2);return O=function(){if(!(this instanceof O)){return P.apply(N,p.concat(m.call(arguments)))}G.prototype=P.prototype;var R=new G;var Q=P.apply(R,p.concat(m.call(arguments)));if(Object(Q)===Q){return Q}return R}};M.bindAll=function(N){var p=m.call(arguments,1);if(p.length==0){p=M.functions(N)}I(p,function(O){N[O]=M.bind(N[O],N)});return N};M.memoize=function(O,N){var p={};N||(N=M.identity);return function(){var P=N.apply(this,arguments);return M.has(p,P)?p[P]:(p[P]=O.apply(this,arguments))}};M.delay=function(N,O){var p=m.call(arguments,2);return setTimeout(function(){return N.apply(null,p)},O)};M.defer=function(p){return M.delay.apply(M,[p,1].concat(m.call(arguments,1)))};M.throttle=function(O,P){var N,R,S,T,Q,U;var p=M.debounce(function(){Q=T=false},P);return function(){N=this;R=arguments;var V=function(){S=null;if(Q){O.apply(N,R)}p()};if(!S){S=setTimeout(V,P)}if(T){Q=true}else{U=O.apply(N,R)}p();T=true;return U}};M.debounce=function(N,P,p){var O;return function(){var S=this,R=arguments;var Q=function(){O=null;if(!p){N.apply(S,R)}};if(p&&!O){N.apply(S,R)}clearTimeout(O);O=setTimeout(Q,P)}};M.once=function(O){var p=false,N;return function(){if(p){return N}p=true;return N=O.apply(this,arguments)}};M.wrap=function(p,N){return function(){var O=[p].concat(m.call(arguments,0));return N.apply(this,O)}};M.compose=function(){var p=arguments;return function(){var N=arguments;for(var O=p.length-1;O>=0;O--){N=[p[O].apply(this,N)]}return N[0]}};M.after=function(N,p){if(N<=0){return p()}return function(){if(--N<1){return p.apply(this,arguments)}}};M.keys=e||function(O){if(O!==Object(O)){throw new TypeError("Invalid object")}var N=[];for(var p in O){if(M.has(O,p)){N[N.length]=p}}return N};M.values=function(p){return M.map(p,M.identity)};M.functions=M.methods=function(O){var N=[];for(var p in O){if(M.isFunction(O[p])){N.push(p)}}return N.sort()};M.extend=function(p){I(m.call(arguments,1),function(N){for(var O in N){p[O]=N[O]}});return p};M.pick=function(N){var p={};I(M.flatten(m.call(arguments,1)),function(O){if(O in N){p[O]=N[O]}});return p};M.defaults=function(p){I(m.call(arguments,1),function(N){for(var O in N){if(p[O]==null){p[O]=N[O]}}});return p};M.clone=function(p){if(!M.isObject(p)){return p}return M.isArray(p)?p.slice():M.extend({},p)};M.tap=function(N,p){p(N);return N};function J(P,O,N){if(P===O){return P!==0||1/P==1/O}if(P==null||O==null){return P===O}if(P._chain){P=P._wrapped}if(O._chain){O=O._wrapped}if(P.isEqual&&M.isFunction(P.isEqual)){return P.isEqual(O)}if(O.isEqual&&M.isFunction(O.isEqual)){return O.isEqual(P)}var S=c.call(P);if(S!=c.call(O)){return false}switch(S){case"[object String]":return P==String(O);case"[object Number]":return P!=+P?O!=+O:(P==0?1/P==1/O:P==+O);case"[object Date]":case"[object Boolean]":return +P==+O;case"[object RegExp]":return P.source==O.source&&P.global==O.global&&P.multiline==O.multiline&&P.ignoreCase==O.ignoreCase}if(typeof P!="object"||typeof O!="object"){return false}var T=N.length;while(T--){if(N[T]==P){return true}}N.push(P);var R=0,p=true;if(S=="[object Array]"){R=P.length;p=R==O.length;if(p){while(R--){if(!(p=R in P==R in O&&J(P[R],O[R],N))){break}}}}else{if("constructor" in P!="constructor" in O||P.constructor!=O.constructor){return false}for(var Q in P){if(M.has(P,Q)){R++;if(!(p=M.has(O,Q)&&J(P[Q],O[Q],N))){break}}}if(p){for(Q in O){if(M.has(O,Q)&&!(R--)){break}}p=!R}}N.pop();return p}M.isEqual=function(N,p){return J(N,p,[])};M.isEmpty=function(N){if(N==null){return true}if(M.isArray(N)||M.isString(N)){return N.length===0}for(var p in N){if(M.has(N,p)){return false}}return true};M.isElement=function(p){return !!(p&&p.nodeType==1)};M.isArray=s||function(p){return c.call(p)=="[object Array]"};M.isObject=function(p){return p===Object(p)};M.isArguments=function(p){return c.call(p)=="[object Arguments]"};if(!M.isArguments(arguments)){M.isArguments=function(p){return !!(p&&M.has(p,"callee"))}}M.isFunction=function(p){return c.call(p)=="[object Function]"};M.isString=function(p){return c.call(p)=="[object String]"};M.isNumber=function(p){return c.call(p)=="[object Number]"};M.isFinite=function(p){return M.isNumber(p)&&isFinite(p)};M.isNaN=function(p){return p!==p};M.isBoolean=function(p){return p===true||p===false||c.call(p)=="[object Boolean]"};M.isDate=function(p){return c.call(p)=="[object Date]"};M.isRegExp=function(p){return c.call(p)=="[object RegExp]"};M.isNull=function(p){return p===null};M.isUndefined=function(p){return p===void 0};M.has=function(N,p){return h.call(N,p)};M.noConflict=function(){v._=j;return this};M.identity=function(p){return p};M.times=function(P,O,N){for(var p=0;p<P;p++){O.call(N,p)}};M.escape=function(p){return(""+p).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")};M.result=function(p,O){if(p==null){return null}var N=p[O];return M.isFunction(N)?N.call(p):N};M.mixin=function(p){I(M.functions(p),function(N){w(N,M[N]=p[N])})};var x=0;M.uniqueId=function(p){var N=x++;return p?p+N:N};M.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var u=/.^/;var g={"\\":"\\","'":"'",r:"\r",n:"\n",t:"\t",u2028:"\u2028",u2029:"\u2029"};for(var H in g){g[g[H]]=H}var i=/\\|'|\r|\n|\t|\u2028|\u2029/g;var B=/\\(\\|'|r|n|t|u2028|u2029)/g;var K=function(p){return p.replace(B,function(N,O){return g[O]})};M.template=function(R,Q,O){O=M.defaults(O||{},M.templateSettings);var P="__p+='"+R.replace(i,function(S){return"\\"+g[S]}).replace(O.escape||u,function(S,T){return"'+\n_.escape("+K(T)+")+\n'"}).replace(O.interpolate||u,function(S,T){return"'+\n("+K(T)+")+\n'"}).replace(O.evaluate||u,function(S,T){return"';\n"+K(T)+"\n;__p+='"})+"';\n";if(!O.variable){P="with(obj||{}){\n"+P+"}\n"}P="var __p='';var print=function(){__p+=Array.prototype.join.call(arguments, '')};\n"+P+"return __p;\n";var N=new Function(O.variable||"obj","_",P);if(Q){return N(Q,M)}var p=function(S){return N.call(this,S,M)};p.source="function("+(O.variable||"obj")+"){\n"+P+"}";return p};M.chain=function(p){return M(p).chain()};var t=function(p){this._wrapped=p};M.prototype=t.prototype;var r=function(N,p){return p?M(N).chain():N};var w=function(p,N){t.prototype[p]=function(){var O=m.call(arguments);z.call(O,this._wrapped);return r(N.apply(M,O),this._chain)}};M.mixin(M);I(["pop","push","reverse","shift","sort","splice","unshift"],function(p){var N=C[p];t.prototype[p]=function(){var O=this._wrapped;N.apply(O,arguments);var P=O.length;if((p=="shift"||p=="splice")&&P===0){delete O[0]}return r(O,this._chain)}});I(["concat","join","slice"],function(p){var N=C[p];t.prototype[p]=function(){return r(N.apply(this._wrapped,arguments),this._chain)}});t.prototype.chain=function(){this._chain=true;return this};t.prototype.value=function(){return this._wrapped}}).call(this);(function(){var q=this;var o=q.Backbone;var p=Array.prototype.slice;var y=Array.prototype.splice;var c;if(typeof exports!=="undefined"){c=exports}else{c=q.Backbone={}}c.VERSION="0.9.2";var A=q._;if(!A&&(typeof require!=="undefined")){A=require("underscore")}var g=q.jQuery||q.Zepto||q.ender;c.setDomLibrary=function(C){g=C};c.noConflict=function(){q.Backbone=o;return this};c.emulateHTTP=false;c.emulateJSON=false;var a=/\s+/;var n=c.Events={on:function(F,J,E){var D,H,G,C,I;if(!J){return this}F=F.split(a);D=this._callbacks||(this._callbacks={});while(H=F.shift()){I=D[H];G=I?I.tail:{};G.next=C={};G.context=E;G.callback=J;D[H]={tail:C,next:I?I.next:G}}return this},off:function(J,H,D){var C,K,E,G,F,I;if(!(K=this._callbacks)){return}if(!(J||H||D)){delete this._callbacks;return this}J=J?J.split(a):A.keys(K);while(C=J.shift()){E=K[C];delete K[C];if(!E||!(H||D)){continue}G=E.tail;while((E=E.next)!==G){F=E.callback;I=E.context;if((H&&F!==H)||(D&&I!==D)){this.on(C,F,I)}}}return this},trigger:function(F){var J,I,E,D,C,H,G;if(!(E=this._callbacks)){return this}H=E.all;F=F.split(a);G=p.call(arguments,1);while(J=F.shift()){if(I=E[J]){D=I.tail;while((I=I.next)!==D){I.callback.apply(I.context||this,G)}}if(I=H){D=I.tail;C=[J].concat(G);while((I=I.next)!==D){I.callback.apply(I.context||this,C)}}}return this}};n.bind=n.on;n.unbind=n.off;var k=c.Model=function(C,D){var E;C||(C={});if(D&&D.parse){C=this.parse(C)}if(E=d(this,"defaults")){C=A.extend({},E,C)}if(D&&D.collection){this.collection=D.collection}this.attributes={};this._escapedAttributes={};this.cid=A.uniqueId("c");this.changed={};this._silent={};this._pending={};this.set(C,{silent:true});this.changed={};this._silent={};this._pending={};this._previousAttributes=A.clone(this.attributes);this.initialize.apply(this,arguments)};A.extend(k.prototype,n,{changed:null,_silent:null,_pending:null,idAttribute:"id",initialize:function(){},toJSON:function(C){return A.clone(this.attributes)},get:function(C){return this.attributes[C]},escape:function(C){var D;if(D=this._escapedAttributes[C]){return D}var E=this.get(C);return this._escapedAttributes[C]=A.escape(E==null?"":""+E)},has:function(C){return this.get(C)!=null},set:function(J,I,L){var K,G,E;if(A.isObject(J)||J==null){K=J;L=I}else{K={};K[J]=I}L||(L={});if(!K){return this}if(K instanceof k){K=K.attributes}if(L.unset){for(G in K){K[G]=void 0}}if(!this._validate(K,L)){return false}if(this.idAttribute in K){this.id=K[this.idAttribute]}var H=L.changes={};var D=this.attributes;var C=this._escapedAttributes;var F=this._previousAttributes||{};for(G in K){E=K[G];if(!A.isEqual(D[G],E)||(L.unset&&A.has(D,G))){delete C[G];(L.silent?this._silent:H)[G]=true}L.unset?delete D[G]:D[G]=E;if(!A.isEqual(F[G],E)||(A.has(D,G)!=A.has(F,G))){this.changed[G]=E;if(!L.silent){this._pending[G]=true}}else{delete this.changed[G];delete this._pending[G]}}if(!L.silent){this.change(L)}return this},unset:function(C,D){(D||(D={})).unset=true;return this.set(C,null,D)},clear:function(C){(C||(C={})).unset=true;return this.set(A.clone(this.attributes),C)},fetch:function(D){D=D?A.clone(D):{};var C=this;var E=D.success;D.success=function(H,F,G){if(!C.set(C.parse(H,G),D)){return false}if(E){E(C,H)}};D.error=c.wrapError(D.error,C,D);return(this.sync||c.sync).call(this,"read",this,D)},save:function(H,G,L){var I,F;if(A.isObject(H)||H==null){I=H;L=G}else{I={};I[H]=G}L=L?A.clone(L):{};if(L.wait){if(!this._validate(I,L)){return false}F=A.clone(this.attributes)}var D=A.extend({},L,{silent:true});if(I&&!this.set(I,L.wait?D:L)){return false}var E=this;var J=L.success;L.success=function(P,M,O){var N=E.parse(P,O);if(L.wait){delete L.wait;N=A.extend(I||{},N)}if(!E.set(N,L)){return false}if(J){J(E,P)}else{E.trigger("sync",E,P,L)}};L.error=c.wrapError(L.error,E,L);var C=this.isNew()?"create":"update";var K=(this.sync||c.sync).call(this,C,this,L);if(L.wait){this.set(F,D)}return K},destroy:function(D){D=D?A.clone(D):{};var C=this;var G=D.success;var F=function(){C.trigger("destroy",C,C.collection,D)};if(this.isNew()){F();return false}D.success=function(H){if(D.wait){F()}if(G){G(C,H)}else{C.trigger("sync",C,H,D)}};D.error=c.wrapError(D.error,C,D);var E=(this.sync||c.sync).call(this,"delete",this,D);if(!D.wait){F()}return E},url:function(){var C=d(this,"urlRoot")||d(this.collection,"url")||t();if(this.isNew()){return C}return C+(C.charAt(C.length-1)=="/"?"":"/")+encodeURIComponent(this.id)},parse:function(D,C){return D},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},change:function(D){D||(D={});var F=this._changing;this._changing=true;for(var C in this._silent){this._pending[C]=true}var E=A.extend({},D.changes,this._silent);this._silent={};for(var C in E){this.trigger("change:"+C,this,this.get(C),D)}if(F){return this}while(!A.isEmpty(this._pending)){this._pending={};this.trigger("change",this,D);for(var C in this.changed){if(this._pending[C]||this._silent[C]){continue}delete this.changed[C]}this._previousAttributes=A.clone(this.attributes)}this._changing=false;return this},hasChanged:function(C){if(!arguments.length){return !A.isEmpty(this.changed)}return A.has(this.changed,C)},changedAttributes:function(E){if(!E){return this.hasChanged()?A.clone(this.changed):false}var G,F=false,D=this._previousAttributes;for(var C in E){if(A.isEqual(D[C],(G=E[C]))){continue}(F||(F={}))[C]=G}return F},previous:function(C){if(!arguments.length||!this._previousAttributes){return null}return this._previousAttributes[C]},previousAttributes:function(){return A.clone(this._previousAttributes)},isValid:function(){return !this.validate(this.attributes)},_validate:function(E,D){if(D.silent||!this.validate){return true}E=A.extend({},this.attributes,E);var C=this.validate(E,D);if(!C){return true}if(D&&D.error){D.error(this,C,D)}else{this.trigger("error",this,C,D)}return false}});var B=c.Collection=function(D,C){C||(C={});if(C.model){this.model=C.model}if(C.comparator){this.comparator=C.comparator}this._reset();this.initialize.apply(this,arguments);if(D){this.reset(D,{silent:true,parse:C.parse})}};A.extend(B.prototype,n,{model:k,initialize:function(){},toJSON:function(C){return this.map(function(D){return D.toJSON(C)})},add:function(D,M){var I,K,F,J,L,E,G={},C={},H=[];M||(M={});D=A.isArray(D)?D.slice():[D];for(I=0,F=D.length;I<F;I++){if(!(J=D[I]=this._prepareModel(D[I],M))){throw new Error("Can't add an invalid model to a collection")}L=J.cid;E=J.id;if(G[L]||this._byCid[L]||((E!=null)&&(C[E]||this._byId[E]))){H.push(I);continue}G[L]=C[E]=J}I=H.length;while(I--){D.splice(H[I],1)}for(I=0,F=D.length;I<F;I++){(J=D[I]).on("all",this._onModelEvent,this);this._byCid[J.cid]=J;if(J.id!=null){this._byId[J.id]=J}}this.length+=F;K=M.at!=null?M.at:this.models.length;y.apply(this.models,[K,0].concat(D));if(this.comparator){this.sort({silent:true})}if(M.silent){return this}for(I=0,F=this.models.length;I<F;I++){if(!G[(J=this.models[I]).cid]){continue}M.index=I;J.trigger("add",J,this,M)}return this},remove:function(H,F){var G,C,E,D;F||(F={});H=A.isArray(H)?H.slice():[H];for(G=0,C=H.length;G<C;G++){D=this.getByCid(H[G])||this.get(H[G]);if(!D){continue}delete this._byId[D.id];delete this._byCid[D.cid];E=this.indexOf(D);this.models.splice(E,1);this.length--;if(!F.silent){F.index=E;D.trigger("remove",D,this,F)}this._removeReference(D)}return this},push:function(D,C){D=this._prepareModel(D,C);this.add(D,C);return D},pop:function(D){var C=this.at(this.length-1);this.remove(C,D);return C},unshift:function(D,C){D=this._prepareModel(D,C);this.add(D,A.extend({at:0},C));return D},shift:function(D){var C=this.at(0);this.remove(C,D);return C},get:function(C){if(C==null){return void 0}return this._byId[C.id!=null?C.id:C]},getByCid:function(C){return C&&this._byCid[C.cid||C]},at:function(C){return this.models[C]},where:function(C){if(A.isEmpty(C)){return[]}return this.filter(function(D){for(var E in C){if(C[E]!==D.get(E)){return false}}return true})},sort:function(D){D||(D={});if(!this.comparator){throw new Error("Cannot sort a set without a comparator")}var C=A.bind(this.comparator,this);if(this.comparator.length==1){this.models=this.sortBy(C)}else{this.models.sort(C)}if(!D.silent){this.trigger("reset",this,D)}return this},pluck:function(C){return A.map(this.models,function(D){return D.get(C)})},reset:function(F,D){F||(F=[]);D||(D={});for(var E=0,C=this.models.length;E<C;E++){this._removeReference(this.models[E])}this._reset();this.add(F,A.extend({silent:true},D));if(!D.silent){this.trigger("reset",this,D)}return this},fetch:function(C){C=C?A.clone(C):{};if(C.parse===undefined){C.parse=true}var E=this;var D=C.success;C.success=function(H,F,G){E[C.add?"add":"reset"](E.parse(H,G),C);if(D){D(E,H)}};C.error=c.wrapError(C.error,E,C);return(this.sync||c.sync).call(this,"read",this,C)},create:function(D,C){var E=this;C=C?A.clone(C):{};D=this._prepareModel(D,C);if(!D){return false}if(!C.wait){E.add(D,C)}var F=C.success;C.success=function(G,I,H){if(C.wait){E.add(G,C)}if(F){F(G,I)}else{G.trigger("sync",D,I,C)}};D.save(null,C);return D},parse:function(D,C){return D},chain:function(){return A(this.models).chain()},_reset:function(C){this.length=0;this.models=[];this._byId={};this._byCid={}},_prepareModel:function(E,D){D||(D={});if(!(E instanceof k)){var C=E;D.collection=this;E=new this.model(C,D);if(!E._validate(E.attributes,D)){E=false}}else{if(!E.collection){E.collection=this}}return E},_removeReference:function(C){if(this==C.collection){delete C.collection}C.off("all",this._onModelEvent,this)},_onModelEvent:function(E,D,F,C){if((E=="add"||E=="remove")&&F!=this){return}if(E=="destroy"){this.remove(D,C)}if(D&&E==="change:"+D.idAttribute){delete this._byId[D.previous(D.idAttribute)];this._byId[D.id]=D}this.trigger.apply(this,arguments)}});var w=["forEach","each","map","reduce","reduceRight","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","sortBy","sortedIndex","toArray","size","first","initial","rest","last","without","indexOf","shuffle","lastIndexOf","isEmpty","groupBy"];A.each(w,function(C){B.prototype[C]=function(){return A[C].apply(A,[this.models].concat(A.toArray(arguments)))}});var z=c.Router=function(C){C||(C={});if(C.routes){this.routes=C.routes}this._bindRoutes();this.initialize.apply(this,arguments)};var i=/:\w+/g;var x=/\*\w+/g;var e=/[-[\]{}()+?.,\\^$|#\s]/g;A.extend(z.prototype,n,{initialize:function(){},route:function(C,D,E){c.history||(c.history=new b);if(!A.isRegExp(C)){C=this._routeToRegExp(C)}if(!E){E=this[D]}c.history.route(C,A.bind(function(G){var F=this._extractParameters(C,G);E&&E.apply(this,F);this.trigger.apply(this,["route:"+D].concat(F));c.history.trigger("route",this,D,F)},this));return this},navigate:function(D,C){c.history.navigate(D,C)},_bindRoutes:function(){if(!this.routes){return}var D=[];for(var E in this.routes){D.unshift([E,this.routes[E]])}for(var F=0,C=D.length;F<C;F++){this.route(D[F][0],D[F][1],this[D[F][1]])}},_routeToRegExp:function(C){C=C.replace(e,"\\$&").replace(i,"([^/]+)").replace(x,"(.*?)");return new RegExp("^"+C+"$")},_extractParameters:function(C,D){return C.exec(D).slice(1)}});var b=c.History=function(){this.handlers=[];A.bindAll(this,"checkUrl")};var m=/^[#\/]/;var j=/msie [\w.]+/;b.started=false;A.extend(b.prototype,n,{interval:50,getHash:function(E){var D=E?E.location:window.location;var C=D.href.match(/#(.*)$/);return C?C[1]:""},getFragment:function(D,C){if(D==null){if(this._hasPushState||C){D=window.location.pathname;var E=window.location.search;if(E){D+=E}}else{D=this.getHash()}}if(!D.indexOf(this.options.root)){D=D.substr(this.options.root.length)}return D.replace(m,"")},start:function(E){if(b.started){throw new Error("Backbone.history has already been started")}b.started=true;this.options=A.extend({},{root:"/"},this.options,E);this._wantsHashChange=this.options.hashChange!==false;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.options.pushState&&window.history&&window.history.pushState);var D=this.getFragment();var C=document.documentMode;var G=(j.exec(navigator.userAgent.toLowerCase())&&(!C||C<=7));if(G){this.iframe=g('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow;this.navigate(D)}if(this._hasPushState){g(window).bind("popstate",this.checkUrl)}else{if(this._wantsHashChange&&("onhashchange" in window)&&!G){g(window).bind("hashchange",this.checkUrl)}else{if(this._wantsHashChange){this._checkUrlInterval=setInterval(this.checkUrl,this.interval)}}}this.fragment=D;var H=window.location;var F=H.pathname==this.options.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!F){this.fragment=this.getFragment(null,true);window.location.replace(this.options.root+"#"+this.fragment);return true}else{if(this._wantsPushState&&this._hasPushState&&F&&H.hash){this.fragment=this.getHash().replace(m,"");window.history.replaceState({},document.title,H.protocol+"//"+H.host+this.options.root+this.fragment)}}if(!this.options.silent){return this.loadUrl()}},stop:function(){g(window).unbind("popstate",this.checkUrl).unbind("hashchange",this.checkUrl);clearInterval(this._checkUrlInterval);b.started=false},route:function(C,D){this.handlers.unshift({route:C,callback:D})},checkUrl:function(D){var C=this.getFragment();if(C==this.fragment&&this.iframe){C=this.getFragment(this.getHash(this.iframe))}if(C==this.fragment){return false}if(this.iframe){this.navigate(C)}this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(E){var D=this.fragment=this.getFragment(E);var C=A.any(this.handlers,function(F){if(F.route.test(D)){F.callback(D);return true}});return C},navigate:function(D,C){if(!b.started){return false}if(!C||C===true){C={trigger:C}}var E=(D||"").replace(m,"");if(this.fragment==E){return}if(this._hasPushState){if(E.indexOf(this.options.root)!=0){E=this.options.root+E}this.fragment=E;window.history[C.replace?"replaceState":"pushState"]({},document.title,E)}else{if(this._wantsHashChange){this.fragment=E;this._updateHash(window.location,E,C.replace);if(this.iframe&&(E!=this.getFragment(this.getHash(this.iframe)))){if(!C.replace){this.iframe.document.open().close()}this._updateHash(this.iframe.location,E,C.replace)}}else{window.location.assign(this.options.root+D)}}if(C.trigger){this.loadUrl(D)}},_updateHash:function(C,D,E){if(E){C.replace(C.toString().replace(/(javascript:|#).*$/,"")+"#"+D)}else{C.hash=D}}});var s=c.View=function(C){this.cid=A.uniqueId("view");this._configure(C||{});this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents()};var f=/^(\S+)\s*(.*)$/;var u=["model","collection","el","id","attributes","className","tagName"];A.extend(s.prototype,n,{tagName:"div",$:function(C){return this.$el.find(C)},initialize:function(){},render:function(){return this},remove:function(){this.$el.remove();return this},make:function(D,C,F){var E=document.createElement(D);if(C){g(E).attr(C)}if(F){g(E).html(F)}return E},setElement:function(C,D){if(this.$el){this.undelegateEvents()}this.$el=(C instanceof g)?C:g(C);this.el=this.$el[0];if(D!==false){this.delegateEvents()}return this},delegateEvents:function(G){if(!(G||(G=d(this,"events")))){return}this.undelegateEvents();for(var F in G){var H=G[F];if(!A.isFunction(H)){H=this[G[F]]}if(!H){throw new Error('Method "'+G[F]+'" does not exist')}var E=F.match(f);var D=E[1],C=E[2];H=A.bind(H,this);D+=".delegateEvents"+this.cid;if(C===""){this.$el.bind(D,H)}else{this.$el.delegate(C,D,H)}}},undelegateEvents:function(){this.$el.unbind(".delegateEvents"+this.cid)},_configure:function(E){if(this.options){E=A.extend({},this.options,E)}for(var F=0,D=u.length;F<D;F++){var C=u[F];if(E[C]){this[C]=E[C]}}this.options=E},_ensureElement:function(){if(!this.el){var C=d(this,"attributes")||{};if(this.id){C.id=this.id}if(this.className){C["class"]=this.className}this.setElement(this.make(this.tagName,C),false)}else{this.setElement(this.el,false)}}});var v=function(C,D){var E=l(this,C,D);E.extend=this.extend;return E};k.extend=B.extend=z.extend=s.extend=v;var r={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};c.sync=function(G,D,C){var E=r[G];C||(C={});var F={type:E,dataType:"json"};if(!C.url){F.url=d(D,"url")||t()}if(!C.data&&D&&(G=="create"||G=="update")){F.contentType="application/json";F.data=JSON.stringify(D.toJSON())}if(c.emulateJSON){F.contentType="application/x-www-form-urlencoded";F.data=F.data?{model:F.data}:{}}if(c.emulateHTTP){if(E==="PUT"||E==="DELETE"){if(c.emulateJSON){F.data._method=E}F.type="POST";F.beforeSend=function(H){H.setRequestHeader("X-HTTP-Method-Override",E)}}}if(F.type!=="GET"&&!c.emulateJSON){F.processData=false}return g.ajax(A.extend(F,C))};c.wrapError=function(D,E,C){return function(F,G){G=F===E?G:F;if(D){D(E,G,C)}else{E.trigger("error",E,G,C)}}};var h=function(){};var l=function(D,C,E){var F;if(C&&C.hasOwnProperty("constructor")){F=C.constructor}else{F=function(){D.apply(this,arguments)}}A.extend(F,D);h.prototype=D.prototype;F.prototype=new h();if(C){A.extend(F.prototype,C)}if(E){A.extend(F,E)}F.prototype.constructor=F;F.__super__=D.prototype;return F};var d=function(C,D){if(!(C&&C[D])){return null}return A.isFunction(C[D])?C[D]():C[D]};var t=function(){throw new Error('A "url" property or function must be specified')}}).call(this);window.Torso={};(function(a){a.View=Backbone.View.extend({template:_.template(""),initialize:function(b){_.bindAll(this,"setup","render");this.render(b)},render:function(b){this.$el.html(this.template(b));this.setup(b)},setup:function(){}});a.Screen=a.View.extend({_isScreen:true,modal:false,initialize:function(b){_.bindAll(this,"setup","render");this.session=b.session;this.render(b)}});a.Router=Backbone.Router.extend({initialize:function(b){this.app=b.app;this.routes=b.routes||{};this.on("all",function(d){if(d.indexOf("route:"===0)){var c=Array.prototype.slice.call(arguments,1);this.app.navigate(d.substr("route:".length),c)}}.bind(this));Backbone.history.start()}});a.App=Backbone.View.extend({initialize:function(c){_.bindAll(this,"display","clear","navigate");this.session=c.session||new Backbone.Model();this.defaults=c.defaults||{};this.containers=c.containers||{};this.screens=c.screens||{};this.initialized=false;this.lastContainer=undefined;for(var b in this.defaults){this.navigate(this.defaults[b],null,b)}},display:function(c,b){b=b||((c.modal&&this.initialized)?"modal":"main");var d=this.containers[b];if(typeof d!=="undefined"){if(c){var f={container:b,el:d,screen:c};this.trigger("predisplay",f);this.trigger("predisplay:"+b,f);if(b==="main"&&this.container==="modal"){this.clear("modal")}else{if(d.hasClass("populated")){this.clear(b)}d.addClass("populated").append(c.$el)}this.container=b;this.trigger("display",f);this.trigger("display:"+b,f)}else{var f={container:b,el:d};this.trigger("preclear",f);this.trigger("preclear:"+b,f);d.empty();if(d.hasClass("populated")){d.removeClass("populated")}this.trigger("clear",f);this.trigger("clear:"+b,f)}if(b==="main"){this.initialized=true}}else{throw new Error('Invalid container "'+b+'"')}},clear:function(b){this.display(null,b)},navigate:function(c,f,b){var e;if(typeof c==="string"){e=c;c=this.screens[e]}if(typeof c!=="undefined"){var d=new c({session:this.session,args:f});this.display(d,b)}else{throw new Error('No Screen was defined for id "'+e+'"')}}})})(window.Torso);(function(H,o){var L,s="1.6.2",Q=Math.round,R,E={},w="en",D=(typeof module!=="undefined"),n="months|monthsShort|monthsParse|weekdays|weekdaysShort|longDateFormat|calendar|relativeTime|ordinal|meridiem".split("|"),r=/^\/?Date\((\-?\d+)/i,k=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|dddd?|do?|w[o|w]?|YYYY|YY|a|A|hh?|HH?|mm?|ss?|SS?S?|zz?|ZZ?|LT|LL?L?L?)/g,S=/([0-9a-zA-Z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+)/gi,g=/\d\d?/,F=/\d{1,3}/,G=/\d{3}/,y=/\d{4}/,z=/[0-9a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+/i,b=/Z|[\+\-]\d\d:?\d\d/i,p=/T/i,A=/^\s*\d{4}-\d\d-\d\d(T(\d\d(:\d\d(:\d\d(\.\d\d?\d?)?)?)?)?([\+\-]\d\d:?\d\d)?)?/,d="YYYY-MM-DDTHH:mm:ssZ",h=[["HH:mm:ss.S",/T\d\d:\d\d:\d\d\.\d{1,3}/],["HH:mm:ss",/T\d\d:\d\d:\d\d/],["HH:mm",/T\d\d:\d\d/],["HH",/T\d\d/]],u=/([\+\-]|\d\d)/gi,l="Month|Date|Hours|Minutes|Seconds|Milliseconds".split("|"),N={Milliseconds:1,Seconds:1000,Minutes:60000,Hours:3600000,Days:86400000,Months:2592000000,Years:31536000000};function q(U,i){this._d=U;this._isUTC=!!i}function M(i){if(i<0){return Math.ceil(i)}else{return Math.floor(i)}}function T(W){var Y=this._data={},Z=W.years||W.y||0,U=W.months||W.M||0,i=W.weeks||W.w||0,ac=W.days||W.d||0,aa=W.hours||W.h||0,X=W.minutes||W.m||0,ab=W.seconds||W.s||0,V=W.milliseconds||W.ms||0;this._milliseconds=V+ab*1000+X*60000+aa*3600000;this._days=ac+i*7;this._months=U+Z*12;Y.milliseconds=V%1000;ab+=M(V/1000);Y.seconds=ab%60;X+=M(ab/60);Y.minutes=X%60;aa+=M(X/60);Y.hours=aa%24;ac+=M(aa/24);ac+=i*7;Y.days=ac%30;U+=M(ac/30);Y.months=U%12;Z+=M(U/12);Y.years=Z}function P(V,U){var i=V+"";while(i.length<U){i="0"+i}return i}function J(V,X,W){var U=X._milliseconds,Y=X._days,Z=X._months,i;if(U){V._d.setTime(+V+U*W)}if(Y){V.date(V.date()+Y*W)}if(Z){i=V.date();V.date(1).month(V.month()+Z*W).date(Math.min(i,V.daysInMonth()))}}function v(i){return Object.prototype.toString.call(i)==="[object Array]"}function j(i){return new H(i[0],i[1]||0,i[2]||1,i[3]||0,i[4]||0,i[5]||0,i[6]||0)}function C(V,ad){var ac=V.month(),i=V.date(),Y=V.year(),aa=V.day(),af=V.hours(),W=V.minutes(),U=V.seconds(),ab=V.milliseconds(),X=-V.zone(),Z=L.ordinal,ag=L.meridiem;function ae(aj){var ai,ah;switch(aj){case"M":return ac+1;case"Mo":return(ac+1)+Z(ac+1);case"MM":return P(ac+1,2);case"MMM":return L.monthsShort[ac];case"MMMM":return L.months[ac];case"D":return i;case"Do":return i+Z(i);case"DD":return P(i,2);case"DDD":ai=new H(Y,ac,i);ah=new H(Y,0,1);return ~~(((ai-ah)/86400000)+1.5);case"DDDo":ai=ae("DDD");return ai+Z(ai);case"DDDD":return P(ae("DDD"),3);case"d":return aa;case"do":return aa+Z(aa);case"ddd":return L.weekdaysShort[aa];case"dddd":return L.weekdays[aa];case"w":ai=new H(Y,ac,i-aa+5);ah=new H(ai.getFullYear(),0,4);return ~~((ai-ah)/86400000/7+1.5);case"wo":ai=ae("w");return ai+Z(ai);case"ww":return P(ae("w"),2);case"YY":return P(Y%100,2);case"YYYY":return Y;case"a":return ag?ag(af,W,false):(af>11?"pm":"am");case"A":return ag?ag(af,W,true):(af>11?"PM":"AM");case"H":return af;case"HH":return P(af,2);case"h":return af%12||12;case"hh":return P(af%12||12,2);case"m":return W;case"mm":return P(W,2);case"s":return U;case"ss":return P(U,2);case"S":return ~~(ab/100);case"SS":return P(~~(ab/10),2);case"SSS":return P(ab,3);case"Z":return(X<0?"-":"+")+P(~~(Math.abs(X)/60),2)+":"+P(~~(Math.abs(X)%60),2);case"ZZ":return(X<0?"-":"+")+P(~~(10*Math.abs(X)/6),4);case"L":case"LL":case"LLL":case"LLLL":case"LT":return C(V,L.longDateFormat[aj]);default:return aj.replace(/(^\[)|(\\)|\]$/g,"")}}return ad.replace(k,ae)}function f(i){switch(i){case"DDDD":return G;case"YYYY":return y;case"S":case"SS":case"SSS":case"DDD":return F;case"MMM":case"MMMM":case"ddd":case"dddd":case"a":case"A":return z;case"Z":case"ZZ":return b;case"T":return p;case"MM":case"DD":case"dd":case"YY":case"HH":case"hh":case"mm":case"ss":case"M":case"D":case"d":case"H":case"h":case"m":case"s":return g;default:return new RegExp(i.replace("\\",""))}}function e(X,V,U,W){var i;switch(X){case"M":case"MM":U[1]=(V==null)?0:~~V-1;break;case"MMM":case"MMMM":for(i=0;i<12;i++){if(L.monthsParse[i].test(V)){U[1]=i;break}}break;case"D":case"DD":case"DDD":case"DDDD":U[2]=~~V;break;case"YY":V=~~V;U[0]=V+(V>70?1900:2000);break;case"YYYY":U[0]=~~Math.abs(V);break;case"a":case"A":W.isPm=((V+"").toLowerCase()==="pm");break;case"H":case"HH":case"h":case"hh":U[3]=~~V;break;case"m":case"mm":U[4]=~~V;break;case"s":case"ss":U[5]=~~V;break;case"S":case"SS":case"SSS":U[6]=~~(("0."+V)*1000);break;case"Z":case"ZZ":W.isUTC=true;i=(V+"").match(u);if(i&&i[1]){W.tzh=~~i[1]}if(i&&i[2]){W.tzm=~~i[2]}if(i&&i[0]==="+"){W.tzh=-W.tzh;W.tzm=-W.tzm}break}}function B(W,aa){var U=[0,0,1,0,0,0,0],V={tzh:0,tzm:0},Z=aa.match(k),X,Y;for(X=0;X<Z.length;X++){Y=(f(Z[X]).exec(W)||[])[0];W=W.replace(f(Z[X]),"");e(Z[X],Y,U,V)}if(V.isPm&&U[3]<12){U[3]+=12}if(V.isPm===false&&U[3]===12){U[3]=0}U[3]+=V.tzh;U[4]+=V.tzm;return V.isUTC?new H(H.UTC.apply({},U)):j(U)}function I(Y,X){var U=Math.min(Y.length,X.length),V=Math.abs(Y.length-X.length),Z=0,W;for(W=0;W<U;W++){if(~~Y[W]!==~~X[W]){Z++}}return Z+V}function t(Y,aa){var V,ab=Y.match(S)||[],Z,ac=99,X,U,W;for(X=0;X<aa.length;X++){U=B(Y,aa[X]);Z=C(new q(U),aa[X]).match(S)||[];W=I(ab,Z);if(W<ac){ac=W;V=U}}return V}function O(U){var W="YYYY-MM-DDT",V;if(A.exec(U)){for(V=0;V<4;V++){if(h[V][1].exec(U)){W+=h[V][0];break}}return b.exec(U)?B(U,W+" Z"):B(U,W)}return new H(U)}function K(U,W,V,X){var i=L.relativeTime[U];return(typeof i==="function")?i(W||1,!!V,U,X):i.replace(/%d/i,W||1)}function x(V,Y){var Z=Q(Math.abs(V)/1000),X=Q(Z/60),i=Q(X/60),aa=Q(i/24),W=Q(aa/365),U=Z<45&&["s",Z]||X===1&&["m"]||X<45&&["mm",X]||i===1&&["h"]||i<22&&["hh",i]||aa===1&&["d"]||aa<=25&&["dd",aa]||aa<=45&&["M"]||aa<345&&["MM",Q(aa/30)]||W===1&&["y"]||["yy",W];U[2]=Y;U[3]=V>0;return K.apply({},U)}L=function(V,X){if(V===null||V===""){return null}var W,i,U;if(L.isMoment(V)){W=new H(+V._d);U=V._isUTC}else{if(X){if(v(X)){W=t(V,X)}else{W=B(V,X)}}else{i=r.exec(V);W=V===o?new H():i?new H(+i[1]):V instanceof H?V:v(V)?j(V):typeof V==="string"?O(V):new H(V)}}return new q(W,U)};L.utc=function(i,U){if(v(i)){return new q(new H(H.UTC.apply({},i)),true)}return(U&&i)?L(i+" +0000",U+" Z").utc():L(i&&!b.exec(i)?i+"+0000":i).utc()};L.unix=function(i){return L(i*1000)};L.duration=function(i,W){var V=L.isDuration(i),U=(typeof i==="number"),X=(V?i._data:(U?{}:i));if(U){if(W){X[W]=i}else{X.milliseconds=i}}return new T(X)};L.humanizeDuration=function(i,U,V){return L.duration(i,U===true?null:U).humanize(U===true?true:V)};L.version=s;L.defaultFormat=d;L.lang=function(W,U){var V,X,Y=[];if(!W){return w}if(U){for(V=0;V<12;V++){Y[V]=new RegExp("^"+U.months[V]+"|^"+U.monthsShort[V].replace(".",""),"i")}U.monthsParse=U.monthsParse||Y;E[W]=U}if(E[W]){for(V=0;V<n.length;V++){L[n[V]]=E[W][n[V]]||E.en[n[V]]}w=W}else{if(D){X=require("./lang/"+W);L.lang(W,X)}}};L.lang("en",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"dddd, MMMM D YYYY LT"},meridiem:false,calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},ordinal:function(U){var i=U%10;return(~~(U%100/10)===1)?"th":(i===1)?"st":(i===2)?"nd":(i===3)?"rd":"th"}});L.isMoment=function(i){return i instanceof q};L.isDuration=function(i){return i instanceof T};L.fn=q.prototype={clone:function(){return L(this)},valueOf:function(){return +this._d},unix:function(){return Math.floor(+this._d/1000)},toString:function(){return this._d.toString()},toDate:function(){return this._d},utc:function(){this._isUTC=true;return this},local:function(){this._isUTC=false;return this},format:function(i){return C(this,i?i:L.defaultFormat)},add:function(i,V){var U=V?L.duration(+V,i):L.duration(i);J(this,U,1);return this},subtract:function(i,V){var U=V?L.duration(+V,i):L.duration(i);J(this,U,-1);return this},diff:function(aa,V,ac){var i=this._isUTC?L(aa).utc():L(aa).local(),X=(this.zone()-i.zone())*60000,ab=this._d-i._d-X,Z=this.year()-i.year(),Y=this.month()-i.month(),W=this.date()-i.date(),U;if(V==="months"){U=Z*12+Y+W/30}else{if(V==="years"){U=Z+(Y+W/30)/12}else{U=V==="seconds"?ab/1000:V==="minutes"?ab/60000:V==="hours"?ab/3600000:V==="days"?ab/86400000:V==="weeks"?ab/604800000:ab}}return ac?U:Q(U)},from:function(U,i){return L.duration(this.diff(U)).humanize(!i)},fromNow:function(i){return this.from(L(),i)},calendar:function(){var W=this.diff(L().sod(),"days",true),V=L.calendar,U=V.sameElse,i=W<-6?U:W<-1?V.lastWeek:W<0?V.lastDay:W<1?V.sameDay:W<2?V.nextDay:W<7?V.nextWeek:U;return this.format(typeof i==="function"?i.apply(this):i)},isLeapYear:function(){var i=this.year();return(i%4===0&&i%100!==0)||i%400===0},isDST:function(){return(this.zone()<L([this.year()]).zone()||this.zone()<L([this.year(),5]).zone())},day:function(U){var i=this._isUTC?this._d.getUTCDay():this._d.getDay();return U==null?i:this.add({d:U-i})},sod:function(){return L(this).hours(0).minutes(0).seconds(0).milliseconds(0)},eod:function(){return this.sod().add({d:1,ms:-1})},zone:function(){return this._isUTC?0:this._d.getTimezoneOffset()},daysInMonth:function(){return L(this).month(this.month()+1).date(0).date()}};function m(i,U){L.fn[i]=function(V){var W=this._isUTC?"UTC":"";if(V!=null){this._d["set"+W+U](V);return this}else{return this._d["get"+W+U]()}}}for(R=0;R<l.length;R++){m(l[R].toLowerCase(),l[R])}m("year","FullYear");L.duration.fn=T.prototype={weeks:function(){return M(this.days()/7)},valueOf:function(){return this._milliseconds+this._days*86400000+this._months*2592000000},humanize:function(V){var W=+this,i=L.relativeTime,U=x(W,!V);if(V){U=(W<=0?i.past:i.future).replace(/%s/i,U)}return U}};function a(i){L.duration.fn[i]=function(){return this._data[i]}}function c(i,U){L.duration.fn["as"+i]=function(){return +this/U}}for(R in N){if(N.hasOwnProperty(R)){c(R,N[R]);a(R.toLowerCase())}}c("Weeks",604800000);if(D){module.exports=L}if(typeof window!=="undefined"&&typeof ender==="undefined"){window.moment=L}if(typeof define==="function"&&define.amd){define("moment",[],function(){return L})}})(Date);function since(a){return moment.duration(moment(a).diff(Date.now())).humanize()}function truncate(b,c){if(b.length<c){return b}var a=b.substr(0,c-3);a=a.substr(0,a.lastIndexOf(" "));return a+"..."}var apiDomain="";(function(){var o={login:function(v,w){var u=function(){if(!v.find("button").hasClass("disabled")){v.find("button").addClass("disabled").text("Signing in...");w.login(v.find(".user").val(),v.find(".password").val(),null,function(){v.find("button").removeClass("disabled").text("Sign in");v.find("label").html("Invalid login or password.")})}};v.keypress(function(x){if(x.which===13){u();return false}});v.find("button").click(u)},register:function(u,w){var v=function(){if(!u.find("button").hasClass("disabled")){u.find("button").addClass("disabled").text("Signing up...");w.register({name:u.find(".name").val(),email:u.find(".email").val(),password:u.find(".password").val()},function(){window.location="/#/register"},function(x){u.find("button").removeClass("disabled").text("Sign up");u.find("label").html("An error occurred.")})}};u.keypress(function(x){if(x.which===13){v();return false}});u.find("button").click(v)},"register-2":function(u,w){var v=function(){if(!u.find("button").hasClass("disabled")){u.find("button").addClass("disabled").text("Submitting...");$.ajax({type:"PUT",url:apiDomain+"/users/"+w.get("userId"),data:{username:u.find(".username").val()},success:function(){var x=function(y){if(typeof y.get("username")!=="undefined"){window.location=""}w.off("loaded",x)};w.on("loaded",x);w.loadUser()},xhrFields:{withCredentials:true}})}};u.keypress(function(x){if(x.which===13){v();return false}});u.keyup(function(x){$.ajax({url:apiDomain+"/users/exists",data:{username:u.find(".username").val()},type:"PUT",xhrFields:{withCredentials:true},error:function(y){u.find("label").html("");u.find("button").removeClass("disabled")},success:function(y){u.find("label").html("That username is not available.");u.find("button").addClass("disabled")},xhrFields:{withCredentials:true}})});u.find("button").click(v)},actions:function(v,u){v.find(".like").click(function(y){var x=_.clone(u.model.get("stats"));x.likes++;var w=_.clone(u.model.get("likes"));w.push(u.session.get("user").get("person"));u.model.set({stats:x,likes:w});$.ajax({url:apiDomain+"/outfits/"+u.model.get("_id")+"/likes",success:function(z){u.model.fetch()}.bind(this),type:"POST",xhrFields:{withCredentials:true}});y.preventDefault();return false}.bind(this));v.find(".unlike").click(function(y){var x=_.clone(u.model.get("stats"));x.likes--;var w=_.reject(_.clone(u.model.get("likes")),function(z){return z._id===u.session.get("userId")});u.model.set({stats:x,likes:w});$.ajax({url:apiDomain+"/outfits/"+u.model.get("_id")+"/likes",success:function(z){u.model.fetch()}.bind(this),type:"DELETE",xhrFields:{withCredentials:true}});y.preventDefault();return false}.bind(this));v.find(".repost").click(function(x){var w=_.clone(u.model.get("stats"));w.reposts++;var y=_.clone(u.model.get("reposts"));y.push(u.session.get("user").get("person"));u.model.set({stats:w,reposts:y});$.ajax({url:apiDomain+"/outfits/"+u.model.get("_id"),success:function(z){u.model.fetch()}.bind(this),type:"POST",xhrFields:{withCredentials:true}});x.preventDefault();return false});v.find(".reposted").click(function(x){var w=_.clone(u.model.get("stats"));w.reposts--;var y=_.reject(_.clone(u.model.get("reposts")),function(z){return z._id===u.session.get("userId")});u.model.set({stats:w,reposts:y});$.ajax({url:apiDomain+"/outfits/"+u.model.get("_id")+"/reposts",success:function(z){u.model.fetch()}.bind(this),type:"DELETE",xhrFields:{withCredentials:true}});x.preventDefault();return false});v.find(".delete").click(function(w){u.model.destroy();$.ajax({url:apiDomain+"/outfits/"+u.model.get("_id"),type:"DELETE",xhrFields:{withCredentials:true}});w.preventDefault();return false})},"scroll-up":function(u){u.click(function(){$("html, body").animate({scrollTop:"0"},800)})},comment:function(v,u){var w=function(){var x=v.find(".body").val();if(x.length>0){var y=_.clone(u.model.get("comments"));y.push({author:u.session.get("user").get("person"),date:Date.now(),body:x});u.model.set("comments",y);$.ajax({url:apiDomain+"/outfits/"+u.model.get("_id")+"/comments",data:{body:x},success:function(z){u.model.fetch()}.bind(this),type:"POST",xhrFields:{withCredentials:true}});v.find(".body").val("")}};v.find("button").click(w);v.keypress(function(x){if(x.which===13&&!x.shiftKey){w();return false}});v.find(".delete").click(function(y){var x=$(this).parent().attr("data-id");var z=_.reject(_.clone(u.model.get("comments")),function(A){return A._id===x});u.model.set("comments",z);$.ajax({url:apiDomain+"/outfits/"+u.model.get("_id")+"/comments/"+x,success:function(A){u.model.fetch()}.bind(this),type:"DELETE",xhrFields:{withCredentials:true}});y.preventDefault();return false})},post:function(v,u){v.find("button.next").click(function(){if(!$(this).hasClass("disabled")){$(this).addClass("disabled");u.view.forward()}});v.find("button.back").click(function(){if(!$(this).hasClass("disabled")){$(this).addClass("disabled");u.view.back()}});v.find("button.submit").click(function(){if(!$(this).hasClass("disabled")){$(this).addClass("disabled").text("Posting outfit...");u.model.save(null,{success:function(){window.location="/#/"}})}})},"post-0":function(v,u){setTimeout(function(){filepicker.getFile("image/*",{multiple:false,container:"filepicker-iframe",services:[filepicker.SERVICES.COMPUTER,filepicker.SERVICES.WEBCAM,filepicker.SERVICES.FACEBOOK,filepicker.SERVICES.INSTAGRAM],persist:true},function(w){u.model.set("image",w);v.find("button.next").removeClass("disabled");u.view.forward()})},0);v.find("button.reset").click(function(){u.model.set("image",null);u.view.render()})},"post-1":function(v,u){v.find("button.next, button.back").click(function(){u.model.set("caption",v.find("textarea").val())});var w=v.find("button.next");v.find("textarea").keyup(function(x){if($(this).val().length>0){w.removeClass("disabled")}else{w.addClass("disabled")}})},"post-2":function(v,u){var x=new g(u.model.get("pieces"));var y=new t({collection:x});v.find(".items").append(y.$el);var w=function(){u.model.set("pieces",x.toJSON())};x.bind("add",w);x.bind("remove",w);v.find("input.item").keyup(function(A){var z=v.find(".item-list");z.empty();v.find(".item-search .loading").removeClass("invisible");setTimeout(function(B){if($(this).val()===B){$.ajax({url:apiDomain+"/products",data:{query:B},type:"POST",xhrFields:{withCredentials:true}}).success(function(D){v.find(".item-search .loading").addClass("invisible");var C=D.Items.Item;_.each(C,function(G){var E=new k({url:G.DetailPageURL,image:G.MediumImage.URL,title:G.ItemAttributes.Title,brand:G.ItemAttributes.Brand});var F=new m({model:E});z.append(F.$el);F.$el.click(function(H){x.add(E);z.empty();H.preventDefault();return false})})})}}.bind(this),500,$(this).val())})}};var c=function(w,v){var u=w.find('[class^="form-"], [class*="form-"]');u.each(function(y,z){var x=$(z);for(var A in o){if(x.hasClass("form-"+A)){o[A](x,v)}}})};var l=Backbone.Model.extend({initialize:function(){_.bindAll(this,"url")},idAttribute:"_id",collectionPath:"",url:function(){return apiDomain+"/"+this.collectionPath+"/"+(this.id||"")}});var f=l.extend({collectionPath:"users",defaults:{_id:"",date:Date.now()}});var k=Backbone.Model.extend({});var r=l.extend({collectionPath:"outfits",defaults:{caption:""},likedBy:function(v){var u=this.get("likes");return !u.every(function(w){if(w._id===v){return false}return true})},repostedBy:function(v){var u=this.get("reposts");return !u.every(function(w){if(w._id===v){return false}return true})}});var p=Backbone.Model.extend({initialize:function(u){_.bindAll(this,"loggedIn","loadUser","login","register","toJSON");this.loadUser()},loggedIn:function(){return Boolean(this.get("userId"))},loadUser:function(){var u=this;$.ajax({url:apiDomain+"/auth/info",success:function(v){v.person={_id:v._id,name:v.name,username:v.username,avatar:v.avatar};u.set("userId",v._id);u.set("user",new f(v));u.trigger("loaded",u.get("user"));if(!v.username){window.location="/#/register"}},error:function(){u.set("userId",null);u.set("user",null);u.trigger("loaded",null)},xhrFields:{withCredentials:true}})},login:function(u,w,y,v){var x=this;$.ajax(apiDomain+"/auth",{type:"POST",data:{user:u,password:w},success:function(z){if(typeof z.username!=="undefined"){window.location=""}else{window.location="/#/register"}if(y){y(z)}},error:function(z){x.set("userId",null);x.set("user",null);if(v){v(z)}},xhrFields:{withCredentials:true}})},register:function(w,x,u){var v=this;$.ajax(apiDomain+"/users",{type:"POST",data:w,xhrFields:{withCredentials:true}}).success(function(y){y.person={_id:y._id,name:y.name,username:y.username,avatar:y.avatar};v.set("userId",y._id);v.set("user",new f(y));if(x){x(y)}}).error(function(y){if(u){u(y)}})},toJSON:function(){var u=_.clone(this.attributes);u.loggedIn=this.loggedIn;if(u.user){u.user=u.user.toJSON()}return u}});var i=Backbone.Collection.extend({model:r,url:apiDomain+"/outfits"});var g=Backbone.Collection.extend({model:k});var s=Torso.View.extend({tagName:"li",className:"box outfit summary hover-parent",template:_.template($("#template-outfit-summary").html()),initialize:function(u){_.bindAll(this,"setup","render","remove");this.model.on("change",this.render);this.model.on("destroy",this.remove);this.session=u.session;this.render()},setup:function(){c(this.$el,{model:this.model,session:this.session})}});var q=Torso.View.extend({tagName:"li",className:"box user summary hover-parent span4",template:_.template($("#template-user-summary").html()),initialize:function(){_.bindAll(this,"setup","render");this.model.on("change",this.render);this.render()}});var m=Torso.View.extend({tagName:"li",className:"piece span3",template:_.template($("#template-piece").html()),initialize:function(){_.bindAll(this,"setup","render");this.model.on("change",this.render);this.render()}});var t=Torso.View.extend({tagName:"ul",className:"piece-list",initialize:function(){_.bindAll(this,"setup","render");this.collection.on("change",this.render);this.collection.on("add",this.render);this.collection.on("remove",this.render);this.render()},render:function(){this.$el.empty();this.collection.each(function(u){var v=new m({model:u});v.$el.removeClass("span3").addClass("span12");this.$el.append(v.$el)}.bind(this))}});var e=Torso.Screen.extend({className:"box span5 centered",template:_.template($("#template-login").html()),initialize:function(u){_.bindAll(this,"setup","render");this.session=u.session;this.render(u)},setup:function(){c(this.$el,this.session)}});var h=Torso.Screen.extend({className:"container-fluid",template:_.template($("#template-navbar").html()),initialize:function(u){_.bindAll(this,"setup","render");this.session=u.session;this.session.on("change:user",this.render);this.render(u)},setup:function(){this.$el.find(".login").click(function(){return false});c(this.$el,this.session);return this}});var j=Torso.Screen.extend({className:"box span6 centered",template:_.template($("#template-register").html()),initialize:function(u){_.bindAll(this,"setup","render");this.session=u.session;this.session.on("change:user",this.render);this.render(u)},setup:function(){c(this.$el,this.session)}});var b=Torso.Screen.extend({className:"box span6 centered",template:_.template($("#template-link").html()),setup:function(){c(this.$el,this.session)}});var n=Torso.Screen.extend({className:"box centered outfit span6",template:_.template($("#template-outfit").html()),modal:true,initialize:function(u){_.bindAll(this,"setup","render");this.session=u.session;this.model=new r({_id:u.args[0]});this.model.bind("change",this.render);this.model.on("destroy",this.remove);this.model.fetch()},setup:function(){c(this.$el,{session:this.session,model:this.model});this.$el.find('[rel="tooltip"]').tooltip()}});var d=Torso.Screen.extend({className:"",template:_.template($("#template-feed").html()),initialize:function(u){_.bindAll(this,"setup","render","loadNextPage");this.session=u.session;this.page=-1;this.pageSize=12;this.initialized=false;this.collection=new i();this.loadNextPage()},render:function(){if(!this.initialized){this.$el.html(this.template())}this.collection.each(function(w,v){if(v<this.page*this.pageSize){return}var u=new s({model:w,session:this.session});this.$el.find(".outfits").append(u.$el)}.bind(this));this.$el.find("div.more").removeClass("loading").find("span").html("Load more posts");if(!this.initialized){this.initialized=true;this.setup()}},setup:function(){c(this.$el,this.session);$(window).on("scrollBottom",function(v){this.loadNextPage()}.bind(this)).on("scrollDown",function(v){this.$el.find(".scroll-up").removeClass("collapsed-horizontal")}.bind(this)).on("scrollTop",function(v){this.$el.find(".scroll-up").addClass("collapsed-horizontal")}.bind(this));var u=this.$el.find("div.more");u.click(function(v){if(!u.hasClass("loading")){this.loadNextPage()}}.bind(this))},loadNextPage:function(){this.page++;this.collection.fetch({add:true,success:this.render,data:{limit:this.pageSize,skip:this.page*this.pageSize}});this.$el.find("div.more").addClass("loading").find("span").html("Loading more posts...")}});var a=Torso.Screen.extend({className:"box centered span10 post",template:_.template($("#template-post").html()),initialize:function(u){_.bindAll(this,"setup","render","back","forward");this.session=u.session;this.page=-1;this.model=new r({author:this.session.get("user").get("person")});this.forward()},setup:function(){c(this.$el,{session:this.session,model:this.model,view:this})},back:function(){this.page--;this.render()},forward:function(){this.page++;this.render()}});$(function(){filepicker.setKey("A6D_8Iy0zQe2YTFBlSOA5z");var z=false,w=false,A=false,v=250;$(window).scroll(function(C){var B=$(window);if(B.scrollTop()+B.innerHeight()+200>C.target.height){if(!z){z=true;B.trigger("scrollBottom",C)}}else{z=false}if(B.scrollTop()>v){if(!A){A=true;B.trigger("scrollDown",C)}}else{A=false}if(B.scrollTop()<v){if(!w){w=true;B.trigger("scrollTop",C)}}else{w=false}});var y=new Torso.App({session:new p(),containers:{navbar:$("#navbar"),main:$("#main"),modal:$("#overlay")},screens:{login:e,register:j,link:b,outfit:n,feed:d,post:a},defaults:{navbar:h}});var x=0;$(window).scroll(function(B){if(y.container==="main"){x=$(window).scrollTop()}});y.on("display:modal",function(B){$("#main").css({position:"fixed"});$("#overlay").click(function(C){if(C.target==document.getElementById("overlay")){window.history.back()}});$(window).keydown(function(C){if(C.which===27){window.history.back()}})});y.on("display:main",function(B){$("#main").css({position:"static"});$(window).scrollTop(x)});var u=function(){var B=new Torso.Router({app:y,routes:{login:"login",register:"register","link/:service":"link","user/:id":"user","@:id":"user","outfit/:id":"outfit","/":"feed","":"feed",post:"post","*_":"404"}});y.session.off("loaded",u)};y.session.on("loaded",u)})})();