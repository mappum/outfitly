<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>Outfitly - Share your look</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
		<link href="/css/bootstrap.css" rel="stylesheet">
		<link href="/css/bootstrap-responsive.css" rel="stylesheet">
		<link href="/css/outfitly.css" rel="stylesheet">
	</head>
	<body>
		<header class="navbar navbar-fixed-top">
			<div id="navbar" class="navbar-inner"></div>
		</header>

		<div id="content" class="container-fluid">
			<div id="top" class="row-fluid"></div>
			<div id="main" class="row-fluid"></div>
		</div>

		<script id="template-outfit-summary" type="text/template">
			<div class="actions hover">
				<a href="">like</a>
				<span class="dot"></span>
				<a href="#">repost</a>
				<span class="dot"></span>
				<a href="#">comment</a>
			</div>
			
			<a class="image" href="#">
				<img src="<%- this.model.get('image') || 'http://placehold.it/250x180' %>">
			</a>
			<div class="body">
				<div class="top">
					<span class="caption"><%- this.model.get('caption') %></span>

					<% if(typeof this.model.get('original') !== 'undefined') { %>
						<br>
						<span class="by"> by </span>
						<a class="author" href="#"><%- this.model.get('original').name %></a>
					<% } %>
					
					<span class="dot"></span>
					<span class="by"> <%= typeof this.model.get('original') !== 'undefined' ? 'via' : 'by' %> </span>
					<a class="author" href="#"><%- this.model.get('author').name %></a>
				</div>
				<div class="bottom">
					<% var stats = this.model.get('stats'); %>
					<% var separate = false; %>
					<% if(stats.likes > 0) { %>
						<% separate = true; %>
						<span class="likes"><%- stats.likes %> like<%- stats.likes > 1 ? 's' : '' %></span>
					<% } %>

					<% if(stats.comments > 0) { %>
						<%= separate ? '<span class="dot"></span>' : '' %>
						<% separate = true; %>
						<a class="comments" href="#"><%- stats.comments %> comment<%- stats.comments > 1 ? 's' : '' %></a>
					<% } %>

					<% if(stats.reposts > 0) { %>
						<%= separate ? '<span class="dot"></span>' : '' %>
						<% separate = true; %>
						<span class="reposts"><%- stats.reposts %> repost<%- stats.reposts > 1 ? 's' : '' %></span>
					<% } %>

					<!-- <%= separate ? '<span class="dot"></span>' : '' %>
					<span class="time"><%- since(this.model.get('date')) %> ago</span> -->

					<br>
				</div>
			</div>
		</script>
		<script id="template-user-summary" type="text/template">
			<a class="thumbnail thumbnail-medium avatar" href="/#/@<%- this.model.get('username') %>">
				<img src="<%- this.model.get('avatar') %>">
			</a>
			<div class="body">
				<div class="meta">
					<div class="actions">
						<% if(following(this.model.get('username'))) { %>
							<button class="btn">Unfollow</button>
						<% } else { %>
							<button class="btn btn-primary">Follow</button>
						<% } %>
					</div>

					<a class="name" href="/#/@<%- this.model.get('username') %>"><%- this.model.get('name') %></a>
					<br>
					<a class="username" href="/#/@<%- this.model.get('username') %>">@<%- this.model.get('username') %></a>
				</div>
				<div class="description"><%- truncate(this.model.get('description'), 96) %></div>
				<div class="stats">
					<span class="followers"><span class="value"><%- this.model.get('stats').followers %></span> followers</span>
					<span class="dot"></span>
					<span class="following"><span class="value"><%- this.model.get('stats').following %></span> following</span>
			</div>
		</script>

		<script id="template-navbar" type="text/template">
			<a class="brand" href="/#/">Outfitly</a>
			<ul class="navbar-left nav"></ul>
			<ul class="navbar-right nav pull-right">
				<% if(!this.session.loggedIn()) { %>
					<li class="dropdown">
						<a href="#" class="dropdown-toggle" data-toggle="dropdown">
							<span><strong>Sign in<b class="caret"></b></strong></span>
						</a>
						<ul class="dropdown-menu">
							<li><a href="/#/register">Create an account</a></li>
							<li class="divider"></li>
							<li>
								<div class="form login">
									<fieldset class="control-group">
										<label class="error"></label>
										<input type="text" class="user input-medium" placeholder="Username or email">
										<input type="password" class="password input-medium" placeholder="Password">
										<button class="btn btn-primary">Sign in</button>
									</fieldset>
								</div>
							</li>
							<li class="divider"></li>
							<li><a class="btn" href="/auth/facebook"><img src="http://facebook.com/favicon.ico"> Sign in with Facebook</a></li>
							<li><a class="btn" href="/auth/twitter"><img src="http://twitter.com/favicon.ico"> Sign in with Twitter</a></li>
						</ul>
					</li>
				<% } else { %>
					<li class="dropdown">
						<a href="#" class="dropdown-toggle" data-toggle="dropdown">
							<img src="<%- (this.session.get('user').get('avatar') || '') %>" class="thumbnail thumbnail-tiny avatar">
							<span><strong><%- this.session.get('user').get('name') %></strong></span>
							<b class="caret"></b>
						</a>
						<ul class="dropdown-menu">
							<li><a href="/logout">Log out</a></li>
						</ul>
					</li>
				<% } %>
			</ul>
		</script>
		<script id="template-login" type="text/template">
			<h1>Log in to Outfitly</h1>
			<div class="inset2">
				<div class="row-fluid">
					<fieldset class="form login">
						<label class="error"></label>
						<fieldset>
							<input type="text" placeholder="Username or email" class="user">
						</fieldset>
						<fieldset>
							<input type="password" placeholder="Password" class="password">
						</fieldset>
						<fieldset>
							<button class="btn btn-primary">Sign in</button>
						</fieldset>
					</fieldset>
				</div>
				<hr>
				<div class="row-fluid">
					<a class="btn" href="/auth/facebook"><img src="http://facebook.com/favicon.ico"> Sign in with Facebook</a>
					<a class="btn" href="/auth/twitter"><img src="http://twitter.com/favicon.ico"> Sign in with Twitter</a>
				</div>
			</div>
		</script>
		<script id="template-register" type="text/template">
			<h1>Create an Outfitly account</h1>
			<div class="row-fluid">
				<div class="span6">
					<h2>Sign up</h2>
					<fieldset class="form register">
						<label class="error"></label>
						<fieldset>
							<input type="text" placeholder="Full name" class="fname">
						</fieldset>
						<fieldset>
							<input type="text" placeholder="Email" class="email">
						</fieldset>
						<fieldset>
							<input type="password" placeholder="Password" class="password">
						</fieldset>
						<fieldset>
							<button class="btn btn-primary">Sign up</button>
						</fieldset>
					</fieldset>
				</div>
				<div class="span6"></div>
			</div>
			<hr>
			<p>Already have an account? <a href="/#/login">Sign in.</a></p>
		</script>
		<script id="template-link" type="text/template">
			<h1>We successfully connected to your <%= args[0] %> account</h1>
			<div class="inset2">
				<div>
					<h2>Create a new Outfitly account</h2>
					<fieldset class="form register">
						<label class="error"></label>
						<fieldset>
							<input type="text" placeholder="Full name" class="fname">
						</fieldset>
						<fieldset>
							<input type="text" placeholder="Email" class="email">
						</fieldset>
						<fieldset>
							<input type="password" placeholder="Password" class="password">
						</fieldset>
						<fieldset>
							<button class="btn btn-primary">Sign up</button>
						</fieldset>
					</fieldset>
				</div>
				<hr>
				<div>
					<h2>...or, link with your existing account</h2>
					<fieldset class="form login">
						<label class="error"></label>
						<fieldset>
							<input type="text" placeholder="Username or email" class="user">
						</fieldset>
						<fieldset>
							<input type="password" placeholder="Password" class="password">
						</fieldset>
						<fieldset>
							<button class="btn btn-primary">Sign in</button>
						</fieldset>
					</fieldset>
				</div>
			</div>
		</script>
		<script id="template-outfit" type="text/template">
			<div class="meta">
				<% var author = typeof this.model.get('original') !== 'undefined' ? this.model.get('original') : this.model.get('author'); %>
				<a class="thumbnail thumbnail-small" href="/#/@<%- author.username %>"><img src="<%- author.avatar %>"></a>
				<a class="author" href="/#/@<%- author.username %>"><%- author.name %></a>
				<% if(typeof this.model.get('original') !== 'undefined') { %>
					<span class="by"> via </span>
					<a class="author" href="/#/@<%- this.model.get('author').username %>"><%- this.model.get('author').name %></a>
				<% } %>
				<br>
				<span class="time">Submitted <%- since(this.model.get('date')) %> ago</span>
			</div>
			<hr>

			<div class="image">
				<img src="<%- this.model.get('image') %>">
			</div>
			<div class="caption"><%- this.model.get('caption') %></div>
			<hr>

			<ul class="collection comments">
				<% var comments = this.model.get('comments'); %>
				<% for(var i = 0; i < comments.length; i++) { %>
					<% var comment = comments[i]; %>

					<li class="comment span12">
						<a class="thumbnail thumbnail-tiny" href="/#/@<%- comment.author.username %>"><img src="<%- comment.author.avatar %>"></a>
						<a class="author" href="/#/@<%- comment.author.username %>"><%- comment.author.name %></a>
						<span class="body"><%- comment.body %></span>
					</li>
				<% } %>

				<% if(this.session.loggedIn())  { %>
					<li class="span12">
						<textarea class="body span12" placeholder="Enter your comment here"></textarea>
						<button class="btn btn-primary">Submit</button>
					</li>
				<% } %>
			</ul>

			<% if(this.model.get('stats').pieces > 0) { %>
				<hr>
				<div class="pieces">
					<h2>Pieces</h2>
					<ul class="collection">
					</ul>
				</div>
			<% } %>

			<% if(this.model.get('stats').likes > 0) { %>
				<hr>
				<div class="likes">
					<h2><%= this.model.get('stats').likes %> Like<%= this.model.get('stats').likes > 1 ? 's' : '' %></h2>
					<ul class="collection condensed">
						<% var likes = this.model.get('likes'); %>
						<% for(var i = 0; i < likes.length; i++) { %>
							<% var like = likes[i]; %>

							<li class="like pull-left">
								<a class="thumbnail thumbnail-small" href="/#/@<%- like.username %>"><img src="<%- like.avatar %>"></a>
							</li>
						<% } %>
					</ul>
				</div>
			<% } %>

			<% if(this.model.get('stats').reposts > 0) { %>
				<hr>
				<div class="reposts">
					<h2><%= this.model.get('stats').reposts %> Repost<%= this.model.get('stats').reposts > 1 ? 's' : '' %></h2>
					<ul class="collection condensed">
						<% var reposts = this.model.get('reposts'); %>
						<% for(var i = 0; i < reposts.length; i++) { %>
							<% var repost = reposts[i]; %>

							<li class="repost pull-left">
								<a class="thumbnail thumbnail-small" href="/#/@<%- repost.username %>"><img src="<%- repost.avatar %>"></a>
							</li>
						<% } %>
					</ul>
				</div>
			<% } %>

			<div class="clear"></div>
		</script>
		<script id="template-test" type="text/template">
			<ul class="users collection centered"></ul>
			<hr>
			<ul class="outfits collection centered"></ul>
		</script>

		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
		<script src="/js/bootstrap.js"></script>
		<script src="/js/underscore.js"></script>
		<script src="/js/backbone.js"></script>
		<script src="/js/torso.js"></script>
		<script src="/js/moment.js"></script>
		<script src="/js/outfitly.js"></script>
		<script>
			! function(d, s, id) {
				var js, fjs = d.getElementsByTagName(s)[0];
				if(!d.getElementById(id)) {
					js = d.createElement(s);
					js.id = id;
					js.src = "//platform.twitter.com/widgets.js";
					fjs.parentNode.insertBefore(js, fjs);
				}
			}(document, "script", "twitter-wjs");
		</script>
		<script type="text/javascript">
			var _gaq = _gaq || [];
			_gaq.push(['_setAccount', 'UA-31427332-1']);
			_gaq.push(['_setDomainName', 'aptt.me']);
			_gaq.push(['_setAllowLinker', true]);
			_gaq.push(['_trackPageview']); (function() {
				var ga = document.createElement('script');
				ga.type = 'text/javascript';
				ga.async = true;
				ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
				var s = document.getElementsByTagName('script')[0];
				s.parentNode.insertBefore(ga, s);
			})();

		</script>
	</body>
</html>
